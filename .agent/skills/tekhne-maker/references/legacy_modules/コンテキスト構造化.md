
### Module B-3 [Compass]: Strategic Context Navigator
**最適化ロジック:**
議論を単なる時系列ではなく、**「決定木の分岐（Decision Tree Branches）」**として扱います。
また、現在の議論が当初の目的からどれくらい乖離しているかを「Drift Score」として算出させ、強制的な軌道修正を促します。

```markdown
<!-- Module B-3 [Compass]: Strategic Context Navigator -->
<module_config>
  <name>Global Context Cartographer</name>
  <model_target>Gemini 3 Pro</model_target>
  <objective>Map the conversation topology and correct course trajectory.</objective>
</module_config>

<instruction>
  現在までの全コンテキストをスキャンし、プロジェクトの「航海図（Context Map）」を作成してください。
  あなたは記録係ではなく、**「航海士（Navigator）」**です。現在地を特定し、ゴールへの最適ルートを再計算してください。

  <process_protocol>
    
    <step_1_segmentation>
      **Phase Identification:**
      議論の流れを論理的なフェーズに分割する。
      *Example:* [Phase 1: Ideation] -> [Phase 2: Critique] -> [Phase 3: Refinement]
    </step_1_segmentation>

    <step_2_vector_analysis>
      **Drift Calculation:**
      *   **Origin Point:** 最初のプロンプトで定義された「本来の目的」。
      *   **Current Vector:** 直近3ターンの議論の焦点。
      *   **Drift Score:** 乖離度を0%〜100%で判定せよ。（0%=完全一致、100%=完全に別の話をしている）
    </step_2_vector_analysis>

    <step_3_critical_path>
      **Pruning & Focus:**
      ゴール達成に不可欠な「クリティカル・パス（決定事項の本筋）」と、枝葉末節な「ノイズ（捨てて良い議論）」を明確に区分する。
    </step_3_critical_path>

  </process_protocol>

  <output_schema>
    ## 🧭 Navigation Report
    *   **Current Phase:** [フェーズ名]
    *   **Drift Score:** [  %] (Warning Level: Low/Mid/High)
    *   **Trajectory Correction:** (ズレている場合、元の目的に戻るための具体的な話題転換を提案)

    ## 🗺️ The Territory Map (Mermaid)
    (Create a `gitGraph` or `mindmap` specifically showing DECISION POINTS and PIVOTS. Highlight the current position.)

    ## 🎒 Inventory (State of Context)
    *   **✅ Locked Decisions:** (変更不可の確定事項リスト)
    *   **🚧 Active Issues:** (現在議論中の未解決問題)
    *   **🗑️ Deprecated Ideas:** (棄却された案 - もう議論しなくて良いもの)

    ## 🔮 Next Waypoint
    (次に議論すべき、論理的に正しいトピックは何か？)
  </output_schema>
</instruction>

<input_source>
  {{FULL_CONTEXT_HISTORY}}
</input_source>
```

---

## 🔮 New Expansion Modules (派生モジュール)

コンテキスト整理をさらに一歩進め、「情報の圧縮」と「視覚的デバッグ」を行うためのモジュールです。

### Expansion 1: コンテキストの圧縮と再起動
**Module B-3.1: The Save Point Generator**
長くなりすぎたチャットをリセットするためのモジュール。これまでの全経緯を「1つの圧縮プロンプト」に変換し、新しいチャットウィンドウで続きから始められるようにします。

```markdown
<!-- Module B-3.1: The Save Point Generator -->
<instruction>
  **Context Compression Protocol:**
  このチャットセッションは長くなりすぎました。新しいチャットウィンドウでここまでの文脈を完全に引き継げるよう、**「引継ぎ用システムプロンプト」**を作成してください。
  
  <requirements>
    1. **Outcome Focused:** 議論の経緯（誰が何を言ったか）よりも、最終的な「決定事項」と「制約条件」を詳細に記述する。
    2. **Variable Definition:** 確定した仕様や変数は、XMLタグ（`<spec>`, `<constraint>`）で構造化して記述する。
    3. **Action Trigger:** 新しいチャットで、即座に次のタスクに取り掛かれる指示を含める。
  </requirements>

  出力はそのままコピー＆ペーストできる形式（Code Block）にすること。
</instruction>
```

### Expansion 2: 意思決定の系統樹
**Module B-3.2: Decision Phylogeny (Why did we choose this?)**
「今の決定」だけではなく、「なぜ他の案がダメだったか（Discarded Paths）」を可視化します。後から「やっぱあれにしよう」と言い出した際の手戻りを防ぎます。

```markdown
<!-- Module B-3.2: Decision Phylogeny -->
<instruction>
  これまでの議論における「分岐点（Branching Points）」を可視化してください。
  特に、「採用されなかった案（Rejected Ideas）」とその「却下理由（Rejection Reason）」を明記することが重要です。

  <output_format>
  Mermaid `graph TD` を使用。
  *   スタイル: 採用ルートは太線、却下ルートは点線。
  *   ノード: 決定事項。
  *   エッジ（矢印）: 選択の理由。
  </output_format>
</instruction>
```

---

## 💡 Architect's Note

Gemini 3 Proのような長文脈モデルでも、コンテキストウィンドウの終盤では「注意力の減衰（Lost in the Middle）」が起こり得ます。

1.  **Periodic Mapping:** 議論が20ターンを超えたら、定期的に **`Module B-3 [Compass]`** を実行し、コンテキストの「デフラグ（最適化）」を行ってください。
2.  **The "Drift" Strategy:** Drift Scoreが高い（議論が脱線している）場合、無理に戻そうとせず、「なぜ脱線したか？（そこに新しい価値があるのではないか？）」を問うのも高度な戦略です。
3.  **Migration:** 議論が複雑化しすぎたら、 **`Module B-3.1`** で「セーブポイント」を作り、新しいチャットで「強くてニューゲーム」を開始するのが、最も効率的（Radical Efficiency）な運用法です。      *   **Phase 2: [フェーズ名]** ...

      ### 📦 The Backlog (積み残し)
      *   **Pending Question:** [未回答の問い]
      *   **Technical Debt:** [後回しにした課題]
    </context_map>

    <visual_structure>
      ## 🔗 構造的可視化
      (議論の分岐と収束を Mermaid `graph TD` または `mindmap` で図解。ノード名は極めて簡潔なキーワードにする)
    </visual_structure>
  </output_schema>
</module_instruction>
```
