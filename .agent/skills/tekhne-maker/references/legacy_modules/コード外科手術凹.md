  
### 🏥 Module C-5: Surgical Code Refactoring (コード外科手術)


**【抽象化・強化ポイント】**

1.  **Polyglot Modernization:** Pythonのf-strings等に限定せず、「その言語の最新バージョンにおける慣用句（Idioms）」への書き換えを指示。

2.  **Anti-Truncation Protocol:** LLMがやりがちな「`# ... rest of code`」という省略を、**「コンパイルエラーと同義の重罪」**として定義し、完全なコード出力を強制。

3.  **Strict Typing:** 動的型付け言語（JS/Python）であっても、型定義（JSDoc/Type Hints）を強制し、堅牢性を担保。

  

```xml

<module_instruction id="C-5">

  <mode>Surgical Code Refactoring</mode>

  <objective>

    直前の `<code_audit_report>` に基づき、対象のソースコードをリファクタリングし、バグ修正・現代化・型安全化を施した「完全なコード」を出力する。

  </objective>

  

  <input_source>

    <audit_data>Module C-4 の出力結果 (&lt;critical_issues&gt;, &lt;refactoring_opportunities&gt;)</audit_data>

    <original_code>対象のソースコード</original_code>

  </input_source>

  

  <operation_protocol>

    <priority_1>**Fix Criticals (バグ修正):**

      - `<critical_issues>` で指摘された論理欠陥、セキュリティリスク、未定義変数を修正する。

    </priority_1>

    <priority_2>**Modernize & Typify (現代化と型付け):**

      - 対象言語の「最新バージョン（Modern Syntax）」の慣用句を適用する。

      - 変数、関数、戻り値に対し、厳格な型定義（Type Hints / Interfaces / Structs）を付与する。

    </priority_2>

    <priority_3>**Functional Parity (機能等価性):**

      - 指摘されていないビジネスロジックやアルゴリズムは変更しない。

      - 「機能を変えずに品質だけを上げる」原則を厳守せよ。

    </priority_3>

  </operation_protocol>

  

  <strict_constraints>

    <constraint type="NO_TRUNCATION">

      **省略の完全禁止:** `# ... (rest of code)` や `// ...` といった省略記法は固く禁ずる。

      コピー＆ペーストで即座に動作する、1行も欠けていない「完全なコード」を出力すること。

    </constraint>

    <constraint type="NO_EXPLANATION">

      コードブロックの外側での解説（「修正点は〜」）は不要。コードそのもので語れ。

    </constraint>

  </strict_constraints>

  

  <output_schema>

    <final_code>

      ```{{language}}

      # (または //) Refactored by Module C-5

      (修正後の完全なソースコード)

      ```

    </final_code>

  </output_schema>

</module_instruction>