---
description: セッション終了時に引き継ぎドキュメントを生成する。次回セッションの/bootで読み込まれる。
hegemonikon: Anamnēsis-H
modules: [T8, M8]
---

# /bye ワークフロー

> **Hegemonikón T-series**: T8 Anamnēsis（記憶・引き継ぎ）
> **/bootの対となるセッション終了コマンド**

---

## 本質

- `/boot` = セッション開始、文脈の読み込み
- `/bye` = セッション終了、文脈の保存

---

## 発動条件

| トリガー | 説明 |
|----------|------|
| `/bye` | 手動でセッション終了・引き継ぎ生成 |
| 自動発動 | （将来実装）長時間無操作時 |

---

## Process

// turbo-all

### Step 1: Git状態取得

```bash
git -C "/home/laihuip001/oikos/hegemonikon" log -1 --oneline
git -C "/home/laihuip001/oikos/hegemonikon" status --short
```

### Step 2: セッション情報収集

以下を自動収集:

- 今日のAntigravityセッションのtask.md
- 完了したタスク（[x]マーク）
- 未完了タスク（[ ]マーク）
- 決定事項（会話から抽出）

### Step 3: Handoff生成 (T8 Anamnēsis)

Handoff v2 形式（Layer 1 YAML + Layer 3 Markdown）でドキュメントを生成。

出力先: `/home/laihuip001/oikos/mneme/.hegemonikon/sessions/handoff_{YYYY-MM-DD}_{HHMM}.md`

### Step 3.5: エピソード記憶エクスポート (M8 Anamnēsis Export Phase)

> **旧 /exp の機能を統合**

現在のセッションのチャット履歴を Markdown にエクスポート。

#### エクスポートモード

| モード | 動作 | 備考 |
|--------|------|------|
| **auto** | /bye 実行時に自動生成 | デフォルト |
| **manual** | Handoff とは別に即時エクスポート | ユーザー指定時のみ |
| **batch** | Playwright で全会話を一括抽出 | 別途スクリプト実行 |
| **past** | 過去会話を @conv 参照→記録 | 明示的指定時 |

#### ファイル名規則

```
{YYYY-MM-DD}_{session_id_prefix}_{sanitized_title}.md
```

例: `2026-01-27_c13c1315_workflow-integration.md`

#### 出力形式

```markdown
# {タイトル}

- **日時**: {YYYY-MM-DD}
- **ID**: {session_id}

## サマリー
{セッション要約}

## 決定事項
- 決定1
- 決定2

## 主要な対話

### {トピック1}
{要約された対話内容}
```

#### Batch モード（全会話一括）

```bash
# Playwright インストール（初回のみ）
pip install playwright
playwright install chromium

# 全会話エクスポート
python /home/laihuip001/oikos/hegemonikon/mekhane/anamnesis/export_chats.py --format individual
```

> **前提条件**: Antigravity IDE が CDP ポート 9222 でリッスンしている

出力先: `/home/laihuip001/oikos/mneme/.hegemonikon/sessions/{date}_conv_{title}.md`

### Step 3.6: Dispatch Log 自動集計

セッション中のディスパッチを `dispatch_log.yaml` に自動記録。

**収集対象**:

- source_agent / target_agent が異なるタスク委譲
- T-series / O-series の発動記録
- 成功/失敗ステータス

**実装**:

1. セッション中の「Handoff形式のやり取り」を検出
2. 各ディスパッチを dispatch_log.yaml に追記
3. 統計サマリーを更新

```yaml
# 追記される形式
- id: "HGK-{YYYYMMDD}-{NNN}"
  timestamp: "{ISO8601}"
  t_series: "{T1-T8}"
  source_agent: "{agent}"
  target_agent: "{agent}"
  task: "{description}"
  status: success | failure
```

**出力先**: `/home/laihuip001/oikos/mneme/.hegemonikon/logs/dispatch_log.yaml`

> **Phase B移行判定**: dispatch_count >= 50, failure_rate < 10%, exception_patterns >= 3

### Step 4: 確認

生成されたHandoffを表示し、ユーザーに確認を求める。

---

## 出力形式

```markdown
# 🔄 Session Handoff (YYYY-MM-DD HH:MM)

## 完了タスク
- [x] タスク1
- [x] タスク2

## 未完了・継続タスク
- [ ] タスク3（優先度: P1）

## 決定事項
| 項目 | 決定内容 | 根拠 |
|------|----------|------|
| ... | ... | ... |

## 未決定・要確認
- 質問1

## Git状態
- 最新コミット: `{hash}` {message}
- 未コミット変更: あり/なし

## 次回セッションへの提案
1. 最初にやるべきこと
2. 検討すべきこと

---
*Generated by Hegemonikón T8 Anamnēsis*
```

---

## /boot との連携

1. `/bye` で生成されたHandoffは `/home/laihuip001/oikos/mneme/.hegemonikon/sessions/` に保存
2. 次回 `/boot` 実行時、最新のHandoffを自動読み込み
3. 「前回の続きから」スムーズに開始可能

---

## エラーハンドリング

| エラー | 原因 | 対処 |
|--------|------|------|
| CDP 接続失敗 | Antigravity IDE が起動していない | IDE 起動確認 |
| セレクタ不一致 | UI 更新 | セレクタを調整 |
| 空の会話 | 何も話していない | スキップしてログ記録 |

---

## Hegemonikon Status

| Module | Workflow | Status |
|--------|----------|--------|
| T8 | /bye (Handoff) | Ready |
| M8 | /bye (Export) | Ready |
