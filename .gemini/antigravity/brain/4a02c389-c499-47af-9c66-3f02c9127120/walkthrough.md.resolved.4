# Hermēneus Phase 1-4b 完了 Walkthrough

## 概要

CCL (Cognitive Control Language) の **コンパイル→実行→オーケストレーション→検証→形式証明** を行う **Hermēneus** コンパイラの Phase 1-4b を完了。

## アーキテクチャ

```
CCL Input → [Phase 1: Compiler] → LMQL
                ↓
         [Phase 2: Runtime] → LLM Execution
                ↓
         [Phase 3: Orchestration] → Stateful Graph
                ↓
         [Phase 4: Verification] → Multi-Agent Debate → Audit Trail
                ↓
         [Phase 4b: Prover] → Type Check (mypy) / Schema / Formal (Lean4)
```

## 作成ファイル

| Phase | ファイル | 役割 |
|:------|:---------|:-----|
| 1 | [ast.py](file:///home/laihuip001/oikos/hegemonikon/hermeneus/src/ast.py) | AST ノード |
| 1 | [expander.py](file:///home/laihuip001/oikos/hegemonikon/hermeneus/src/expander.py) | 省略形展開 |
| 1 | [parser.py](file:///home/laihuip001/oikos/hegemonikon/hermeneus/src/parser.py) | CCL パーサー |
| 1 | [translator.py](file:///home/laihuip001/oikos/hegemonikon/hermeneus/src/translator.py) | LMQL 変換 |
| 2 | [runtime.py](file:///home/laihuip001/oikos/hegemonikon/hermeneus/src/runtime.py) | 実行エンジン |
| 2 | [constraints.py](file:///home/laihuip001/oikos/hegemonikon/hermeneus/src/constraints.py) | 制約デコード |
| 3 | [graph.py](file:///home/laihuip001/oikos/hegemonikon/hermeneus/src/graph.py) | StateGraph変換 |
| 3 | [checkpointer.py](file:///home/laihuip001/oikos/hegemonikon/hermeneus/src/checkpointer.py) | 状態永続化 |
| 3 | [hitl.py](file:///home/laihuip001/oikos/hegemonikon/hermeneus/src/hitl.py) | HITL制御 |
| 4 | [verifier.py](file:///home/laihuip001/oikos/hegemonikon/hermeneus/src/verifier.py) | Multi-Agent Debate |
| 4 | [audit.py](file:///home/laihuip001/oikos/hegemonikon/hermeneus/src/audit.py) | Audit Trail |
| 4b | [prover.py](file:///home/laihuip001/oikos/hegemonikon/hermeneus/src/prover.py) | Formal Prover |

**合計: ~4,000行**

## テスト結果

```
================== 89 passed, 2 skipped, 2 warnings in 1.72s ===================
```

## 公開 API (v0.4.1)

```python
from hermeneus.src import (
    # コンパイル & 実行
    compile_ccl, execute_ccl,
    
    # 検証
    verify_execution,       # Multi-Agent Debate
    verify_code,            # 型チェック (mypy)
    verify_schema,          # スキーマ検証
    record_verification,    # 監査記録
)

# 1. CCL 実行
result = execute_ccl("/noe+", context="分析対象")

# 2. 型チェック
code_result = verify_code('''
def add(x: int, y: int) -> int:
    return x + y
''')
print(f"Type safe: {code_result.verified}")

# 3. Multi-Agent Debate で検証
consensus = verify_execution(
    ccl="/noe+",
    execution_output=result.output,
    debate_rounds=3
)
```

---

*Completed: 2026-02-01 | v0.4.1*
