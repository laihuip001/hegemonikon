# 調査依頼書（深掘り版）

テーマ: Google Antigravity IDE におけるシンボリックリンクの検出挙動

---

## 0. あなた（調査者）への依頼（最重要）

私は **Google Antigravity IDE のスキル層（`.agent/skills/`）でシンボリックリンクを使用し、実体ファイルを別ディレクトリに配置する構成が機能するか** を検討している。

以下について、**一般論で終わらせず**、2024-2026時点の最新仕様・挙動・制約を**一次情報と再現性のある検証情報**で裏付けてほしい:

1. **Antigravity IDE の `.agent/skills/` ディレクトリ検出メカニズム**
   - シンボリックリンクを辿るか？
   - ファイルシステム監視（inotify等）の対象になるか？

2. **Node.js / Deno ベースのファイルスキャナーにおける symlink 挙動**
   - `fs.readdir` + `followSymlinks` オプションの標準挙動
   - IDE が使用しているであろうファイル探索ライブラリ

3. **実装プランの実現可能性**
   - 下記の構成が技術的に成立するか

```
[実体]
mekhane/ergasterion/tekhne/SKILL.md

[シンボリックリンク]
.agent/skills/utils/tekhne-maker -> ../../../hegemonikon/mekhane/ergasterion/tekhne
```

---

## 1. 調査対象の定義

### 1-1. 製品名・モード名の確認

- **Google Antigravity IDE** (旧称: Project IDX ベースか、独自プロジェクトか)
- **スキル検出機構**: `.agent/skills/` 配下の `SKILL.md` を自動検出する仕組み
- **調査対象バージョン**: 2026年1月時点の最新

### 1-2. 比較対象

- VS Code の類似機能（Extension Host のファイル探索）
- Cursor IDE のスキル/ルール検出機構
- 一般的な Node.js ファイルスキャナー（glob, fast-glob, chokidar）

---

## 2. 調査すべき論点

### A. Antigravity IDE のファイル検出挙動

**A1. 公式ドキュメント/ソースコード（可能であれば）**
- `.agent/` ディレクトリの仕様
- スキル検出ロジックの公開情報

**A2. 実務検証（再現性重視）**
- シンボリックリンクを作成して検出されるか
- 相対パス / 絶対パス の違い
- Linux / macOS / Windows の差異

### B. Node.js / Deno のファイルシステム API

1. `fs.readdirSync` + `withFileTypes: true` の symlink 扱い
2. `fs.realpathSync` による解決
3. `chokidar` (ファイル監視) の `followSymlinks` オプション

### C. 既知の制約・落とし穴

- 循環リンク検出
- 相対パスの解決タイミング
- ファイル監視のイベント伝播

---

## 3. 成果物（この構成で必ず提出）

1. **結論サマリー**（10行以内）
   - symlink は使えるか Yes/No/条件付き
   
2. **技術検証結果**
   - 実際に試した場合のログ/スクリーンショット
   
3. **代替案**（symlink が使えない場合）
   - ハードリンク
   - 設定ファイルによるパス指定
   - ビルドスクリプトによるコピー

4. **根拠リンク**（必須）
   - Antigravity 公式ドキュメント
   - Node.js fs モジュール仕様
   - 実務者の検証記事

---

## 4. 調査ルール（品質担保）

- **新情報優先**: 2024-2026の情報を優先
- **事実/推測分離**: 必ず明確に分離
- **再現可能な検証**: 可能であれば実際に試す

---

## 6. 与件

- **目的**: tekhne-maker を ergasterion 配下に移動しつつ、Antigravity の自動検出を維持する
- **前提条件**: Linux (GCP VM)、Antigravity IDE 2026年版
- **優先する評価軸**: 実現可能性 > 保守性 > パフォーマンス
