# ワークフロー実行結果アーティファクト化

> **目的**: 全ワークフローの実行結果を `plan` や `task.md` のようにファイルとして生成するようにする

---

## 現状分析

### アーティファクト出力対応済み (7件)

| Workflow | 出力ファイル名パターン |
|:---------|:----------------------|
| `/noe` | `<artifact_directory>/noe_<topic>.md` |
| `/bou` | `<artifact_directory>/bou_<topic>.md` |
| `/sop` | `<artifact_directory>/sop_<topic>.md` |
| `/eat` | `<artifact_directory>/eat_<素材名>.md` |
| `/ene` | `<artifact_directory>/ene_<task>.md` |
| `/mek` | `<artifact_directory>/tek_<purpose>.md` |

### 未対応 (約30件)

O-series: `/zet`
S-series: `/s`, `/met`, `/sta`, `/pra`
H-series: `/pro`, `/pis`, `/ore`, `/dox`
P-series: `/kho`, `/hod`, `/tro`, `/tek`
K-series: `/k`, `/euk`, `/chr`, `/tel`, `/sop` (対応済み)
A-series: `/a`, `/dia`, `/pat`, `/gno`, `/epi`
X-series: `/x`, `/ax`
その他: `/u`

---

## 提案: 2段階アプローチ

### Option A: 全ワークフローに個別規則追加 (工数大)

- 30+ ファイルを個別編集
- 各ワークフローの出力形式に合わせたテンプレート設計
- 完全だがメンテナンス負荷大

### Option B: 統一標準 + 実行時自動保存 (推奨)

1. **統一標準ドキュメント作成** (`workflow_artifact_standard.md`)
2. **実行時フック追加** (Python/共通ステップ)
3. 個別ワークフローには軽量参照のみ追加

---

## 推奨: Option B 詳細設計

### 1. 統一標準ドキュメント

**場所**: `/home/laihuip001/oikos/.agent/standards/workflow_artifact_standard.md`

**内容**:
- 出力ディレクトリ規則
- ファイル名規則 (`<workflow>_<topic>_<date>.md`)
- 共通テンプレート (frontmatter + 本文)
- 除外ワークフロー (hub系: `/o`, `/h`, `/s`, `/p`, `/k`, `/a`, `/x`)

### 2. 標準テンプレート

```markdown
---
workflow: "{workflow_name}"
timestamp: "{ISO8601}"
derivative: "{derivative or null}"
session_id: "{conversation_id}"
---

# {Workflow Name} 実行結果

## 入力
{user_input or context}

## 処理結果
{main_output}

## 推奨次ステップ
{x_series_recommendation}

---
*Generated by Hegemonikón*
```

### 3. 実行時保存ルール

**保存先**: Antigravity の artifact directory
```
<appDataDir>/brain/<conversation-id>/<workflow>_<topic>.md
```

**保存タイミング**: ワークフロー完了時

**除外ワークフロー** (Hub/ルーティング専用):
- `/o`, `/h`, `/s`, `/p`, `/k`, `/a`, `/x` (Hub系)
- `/boot`, `/bye` (セッション管理)
- `/u` (対話専用)
- `/dev` (参照専用)

---

## 変更計画

### Phase 1: 標準ドキュメント作成

#### [NEW] [workflow_artifact_standard.md](file:///home/laihuip001/oikos/.agent/standards/workflow_artifact_standard.md)

統一標準を定義。全ワークフローから参照。

---

### Phase 2: 主要ワークフロー更新 (優先度高)

以下のワークフローにArtifact規則セクションを追加:

| Workflow | 必要な変更 |
|:---------|:-----------|
| `/zet` | `## Artifact 出力規則` セクション追加 |
| `/s` | `## Artifact 出力規則` セクション追加 |
| `/dia` | `## Artifact 出力規則` セクション追加 |
| `/a` | `## Artifact 出力規則` セクション追加 |

---

### Phase 3: 残余ワークフロー (優先度中)

H/P/K/A 個別ワークフローにも順次追加。

---

## 検証計画

### 1. 自動テスト

該当なし（ワークフロードキュメントの変更のため）

### 2. 手動検証

1. `/zet` を実行し、artifact が自動生成されることを確認
2. `/s` を実行し、artifact が自動生成されることを確認
3. 生成されたファイルが標準テンプレートに準拠していることを確認

---

## 質問: Creator への確認事項

> [!IMPORTANT]
> 以下について判断をお願いします:

1. **保存先**: Antigravity の brain ディレクトリ vs mneme ディレクトリ、どちらが望ましいですか？
   - Brain: セッション固有、自動削除される可能性
   - Mneme: 永続、検索可能

2. **対象範囲**: 全30+ ワークフローを一気に対応すべきですか？それとも主要5件（`/zet`, `/s`, `/dia`, `/a`, `/ax`）から段階的に？

3. **保存トリガー**: 自動保存 vs 手動確認後保存、どちらが望ましいですか？

---

*v1.0 — Initial design*
