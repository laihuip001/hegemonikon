# CCL 二層構文アーキテクチャ (Dual-Syntax Architecture)

> **CCL**: `/noe A` + `/u+` — Creator フィードバックを統合した設計
> **Date**: 2026-01-31

---

## 1. 核心的洞察

**CCL には２つの「顔」が必要**：

| 層 | 対象 | 特徴 | 例 |
|:---|:-----|:-----|:---|
| **CCL Human** | Creator | 流れる記法、既存構文維持 | `/noe+ >> V[] < 0.2` |
| **CCL Machine** | LLM | 構造化、処理しやすい | `{"type":"conditional",...}` |

```
CCL Human (原本)  →  Compiler  →  CCL Machine (LLM向け)
```

### 1.1 設計原則

- **Human が正本**: Creator が書くものが真の CCL
- **Machine は派生**: LLM 処理のための内部表現
- **既存互換**: 現在の CCL 式は全て有効

---

## 2. CCL Human 構文（既存 + 拡張）

### 2.1 既存構文（変更なし）

```ccl
/noe+           # 深い認識
/bou~zet        # 意志と探求の振動
/s+_/ene        # 設計してから実行
```

### 2.2 拡張構文（自然な追加）

| パターン | 意味 | 例 |
|:---------|:-----|:---|
| `A >> B` | A なら B | `V[] > 0.5 >> /noe+` |
| `A << B` | A まで B | `/s~dia << V[] < 0.2` |
| `@[X,Y]` | X, Y に適用 | `/noe@[O,S,H]` |
| `×N` | N 回反復 | `/s~dia ×3` |

**ポイント**: ブロック `{}` を使わない。既存の演算子パターンの延長。

---

## 3. CCL Machine 構文（LLM 向け）

```json
{
  "program": [
    {
      "type": "conditional",
      "condition": {"var": "V[]", "op": ">", "value": 0.5},
      "then": {"type": "workflow", "id": "noe", "ops": ["+"]}
    }
  ]
}
```

LLM はこの構造化データを受け取り、実行ステップを確実に追跡できる。

---

## 4. Compiler 実装

### 4.1 新規ファイル

| ファイル | 目的 |
|:---------|:-----|
| `mekhane/ccl/compiler.py` | Human → Machine 変換 |
| `mekhane/ccl/human_parser.py` | Human 構文パーサー |
| `mekhane/ccl/machine_schema.py` | Machine 構文の型定義 |

### 4.2 変換フロー

```
Input (Human)  →  Parser  →  AST  →  Compiler  →  Output (Machine)
```

---

## 5. 検証計画

### 5.1 テストケース

| Human | Machine (期待) |
|:------|:---------------|
| `/noe+` | `{"type":"workflow","id":"noe","ops":["+"]}` |
| `V[] > 0.5 >> /noe+` | `{"type":"conditional",...}` |
| `/s~dia ×3` | `{"type":"repeat","count":3,...}` |

### 5.2 既存互換性

- [ccl_usage_examples.md](file:///home/laihuip001/oikos/hegemonikon/docs/ccl_usage_examples.md) の全式がコンパイル可能であることを確認

---

## User Review Required

> [!IMPORTANT]
> **確認事項**
> 
> 1. 拡張構文 (`>>`, `<<`, `@[]`, `×N`) は直感的ですか？
> 2. Human → Machine の変換方向で正しいですか？
> 3. この設計で「実行保証」と「書きやすさ」の両立は可能ですか？

---

*Generated by O1 Noēsis + /u+ Integration (2026-01-31)*
