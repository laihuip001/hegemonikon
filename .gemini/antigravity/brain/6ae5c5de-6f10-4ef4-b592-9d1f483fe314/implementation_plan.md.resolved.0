# CCL セレクタ構文 設計計画

> **Hegemonikón**: S-series (戦略設計) + CCL v5.3 拡張
> **目的**: ワークフロー出力の部分選択を可能にする構文の追加

---

## 問題定義

現在の CCL:
- `/bou+` → 5つの望み全てを生成
- Creator が「1番だけ」「a だけ」と選択したい場合、手動で指定が必要

**要望**: インデックス/セレクタ構文で部分選択を可能に

---

## 設計候補

### 候補 A: ブラケット記法 `[n]`

```
/bou+[1]    → 望み1番のみ
/bou+[a]    → サブカテゴリ a のみ
/noe+[3]    → PHASE 3 のみ
/s+[2,4]    → STAGE 2 と 4 のみ
```

**利点**: 
- 馴染み深い (配列、CSS セレクタ)
- 範囲指定可能 `[1-3]`

**欠点**:
- 入力: `[` `]` が遠い (日本語キーボード)

---

### 候補 B: コロン記法 `:n`

```
/bou+:1     → 望み1番のみ
/bou+:a     → サブカテゴリ a のみ
/noe+:3     → PHASE 3 のみ
```

**利点**: 
- 入力が楽 (Shift+; だけ)
- Python スライス風

**欠点**:
- 範囲指定がやや複雑 `:1-3`

---

### 候補 C: ドット記法 `.n`

```
/bou+.1     → 望み1番のみ
/bou+.a     → サブカテゴリ a のみ
```

**利点**: 
- オブジェクト指向風
- 入力しやすい

**欠点**:
- `/` (下降演算子) と視覚的に混同しやすい

---

### 候補 D: 下付き数字 `₁`

```
/bou+₁     → 望み1番のみ
```

**利点**: 
- 美しい、数学的
- 既存演算子と混同しない

**欠点**:
- 入力困難 (IME 変換必要)
- アスキーのみ環境で不便

---

## 推奨: 候補 A (ブラケット記法)

**理由**:

1. **直感的**: プログラマにも非プログラマにも馴染み深い
2. **表現力**: 範囲 `[1-3]`、複数 `[1,3]`、名前 `[a]` 全てに対応可能
3. **拡張性**: 将来的にフィルタ条件も追加可能 `[priority>80]`
4. **視認性**: `+`, `^` などの演算子と明確に区別できる

---

## 構文仕様 (v5.3 案)

### セレクタ演算子 `[...]`

| 構文 | 意味 | 例 |
|:-----|:-----|:---|
| `[n]` | n番目の項目 | `/bou+[1]` |
| `[n-m]` | n〜m 番目の範囲 | `/noe+[1-3]` |
| `[n,m]` | n と m (複数選択) | `/s+[2,4]` |
| `[a]` | 名前付きセクション | `/bou+[desir]` |
| `[*]` | 全項目 (明示的、デフォルトと同じ) | `/bou+[*]` |

### 評価順序

セレクタは**末尾に置き、直前の演算子適用後にフィルタリング**:

```
/bou+[1]   = Select(Deepen(bou), 1)
/noe^[3]   = Select(Meta(noe), 3)
```

### 複合式での適用

```
/bou+[1]*/zet-   → 望み1番と探求を融合
/s+[0,1]_/ene    → STAGE 0,1 のみ実行後、実行へ
```

---

## 実装計画

### 変更対象

#### [MODIFY] [operators_and_layers.md](file:///home/laihuip001/oikos/.gemini/antigravity/knowledge/cognitive_algebra_system/artifacts/architecture/operators_and_layers.md)

- セクション「1.5 セレクタ演算子」追加
- 構文規則セクションに `[...]` の評価規則を追加
- 実践例に新パターンを追加

#### [MODIFY] [roadmap.md](file:///home/laihuip001/oikos/.gemini/antigravity/knowledge/cognitive_algebra_system/artifacts/implementation/roadmap.md)

- Phase 7: Selector Syntax 追加

#### [NEW] [selector_syntax_spec.md](file:///home/laihuip001/oikos/.gemini/antigravity/knowledge/cognitive_algebra_system/artifacts/implementation/selector_syntax_spec.md)

- 詳細仕様ドキュメント

---

## 検証計画

### 1. 手動検証: 構文テスト

以下の式を実行し、期待通りの部分的出力が得られることを確認:

1. `/bou+[1]` → 望み1番のみが詳細展開される
2. `/noe+[3]` → PHASE 3 のみが実行される
3. `/s+[0,1]` → STAGE 0, 1 のみが実行される

### 2. 互換性テスト

既存の CCL 式が影響を受けないことを確認:

- `/bou+` → 従来通り全項目生成
- `/noe*dia^` → 従来通り動作

---

## User Review Required

> [!IMPORTANT]
> **構文選択の確認**: 候補 A (ブラケット記法 `[n]`) で進めてよいですか？
> 
> **代替案**: 入力のしやすさを最優先するなら、候補 B (コロン記法 `:n`) も有力です。

---

*Generated by Hegemonikón S-series v5.1*
