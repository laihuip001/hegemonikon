# fep_demo.py æ‹¡å¼µè¨ˆç”» v2

## ç›®çš„

æ—¢å­˜ã®éå¯¾è©±çš„ãƒ‡ãƒ¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’**å¯¾è©±å‹ CLI ãƒ„ãƒ¼ãƒ«**ã«æ‹¡å¼µã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ FEP ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å‹•ä½œã‚’ç¢ºèªãƒ»å­¦ç¿’ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

---

## æ‡¸å¿µç‚¹è§£æ¶ˆ (v2 ã§è¿½åŠ )

| æ‡¸å¿µ | è§£æ±ºç­– | å„ªå…ˆåº¦ |
|:-----|:-------|:------:|
| å­¦ç¿’å¯è¦–åŒ–æ›–æ˜§ | `/diff` ã‚³ãƒãƒ³ãƒ‰: Aè¡Œåˆ—ç´¯ç©å¤‰åŒ–é‡è¡¨ç¤º | Must |
| get_entropy æœªå®Ÿè£… | beliefs ã‹ã‚‰è¨ˆç®—ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¿½åŠ  | Must |
| ãƒ˜ãƒ«ãƒ—ãŒãªã„ | `/help` ã‚³ãƒãƒ³ãƒ‰ | Must |
| Ctrl+C ã§ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ | KeyboardInterrupt ãƒãƒ³ãƒ‰ãƒ© | Must |
| ç©ºå…¥åŠ›ã‚¨ãƒ©ãƒ¼ | ç„¡è¦–ã—ã¦ continue | Must |
| å±¥æ­´è¡¨ç¤º | `/history` ã‚³ãƒãƒ³ãƒ‰ | Should |
| å­¦ç¿’ç‡å¤‰æ›´ | `/lr` ã‚³ãƒãƒ³ãƒ‰ | Could |

---

## STAGE 0: Blindspot + Scale

### ç›²ç‚¹ãƒã‚§ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª | ç›²ç‚¹ | å¯¾ç­– |
|:---------|:-----|:-----|
| ğŸ¯ Framing | âœ… å•é¡Œæ˜ç¢º: å¯¾è©±æ©Ÿèƒ½è¿½åŠ  | N/A |
| ğŸ“ Scope | âš ï¸ æ©Ÿèƒ½æ‹¡å¤§ãƒªã‚¹ã‚¯ | æœ€å°é™ã®å¯¾è©±æ©Ÿèƒ½ã«é™å®š |
| ğŸ”— Dependencies | âœ… encoding.py ãŒæ—¢ã« textâ†’obs å¤‰æ›å¯¾å¿œ | æ—¢å­˜æ©Ÿèƒ½ã‚’æ´»ç”¨ |
| ğŸ‘¤ Stakeholders | Creator ã®ã¿ | è‡ªå·±ä½¿ç”¨ãƒ„ãƒ¼ãƒ« |
| â±ï¸ Temporal | çŸ­æœŸçš„ãƒ„ãƒ¼ãƒ« | æ°¸ç¶šçš„è¨­è¨ˆã¯ä¸è¦ |

### ã‚¹ã‚±ãƒ¼ãƒ«åˆ¤å®š

**ğŸ“ Scale: ğŸ”¬ Micro** â€” å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´

---

## STAGE 1: Strategy Selection

### Read-Resolve å®Œäº†

- [x] [fep_demo.py](file:///home/laihuip001/oikos/hegemonikon/scripts/fep_demo.py) èª­è¾¼ (158è¡Œ)
- [x] [encoding.py](file:///home/laihuip001/oikos/hegemonikon/mekhane/fep/encoding.py) èª­è¾¼ (encode_to_flat_index ç¢ºèª)
- [x] Dirichlet å­¦ç¿’æ©Ÿèƒ½ç¢ºèª (update_A_dirichlet)

### Explore/Exploit åˆ¤å®š

| è»¸ | åˆ¤å®š |
|:---|:-----|
| å¤±æ•—ã‚³ã‚¹ãƒˆ | ä½ (é–‹ç™ºãƒ„ãƒ¼ãƒ«) |
| ç’°å¢ƒç¢ºå®Ÿæ€§ | é«˜ (æ—¢å­˜æ©Ÿèƒ½æ´»ç”¨) |
| æ™‚é–“åˆ¶ç´„ | ä½™è£•ã‚ã‚Š |

**åˆ¤å®š: Exploit** â€” æ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ´»ç”¨

### 3ãƒ—ãƒ©ãƒ³

| Plan | æ¦‚è¦ | ãƒªã‚¹ã‚¯ |
|:-----|:-----|:-------|
| A: Conservative | `-i` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å¯¾è©±ãƒ¢ãƒ¼ãƒ‰è¿½åŠ  | æœ€å°é™ |
| B: Robust | å¯¾è©±ãƒ¢ãƒ¼ãƒ‰ + å­¦ç¿’å¯è¦–åŒ– + ä¿å­˜æ©Ÿèƒ½ â† **æ¨å¥¨** |å·¥æ•°ä¸­ |
| C: Aggressive | Rich/Textual TUI | ä¾å­˜å¢— |

**é¸æŠ: Plan B**

---

## STAGE 2: Success Criteria

| è»¸ | Must | Should | Could |
|:---|:-----|:-------|:------|
| æ©Ÿèƒ½æ€§ | å¯¾è©±å…¥åŠ› â†’ FEP æ¨è«– | å­¦ç¿’åŠ¹æœè¡¨ç¤º | å±¥æ­´ä¿å­˜ |
| å“è³ª | ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° | ãƒ˜ãƒ«ãƒ—è¡¨ç¤º | Tab è£œå®Œ |
| æ€§èƒ½ | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ < 1ç§’ | N/A | N/A |

---

## STAGE 3: Blueprint

### Goal Decomposition

```text
æœ€çµ‚ç›®æ¨™: å¯¾è©±å‹ FEP ãƒ‡ãƒ¢ãƒ„ãƒ¼ãƒ«
  â† ã‚µãƒ–1: CLI å¼•æ•° `-i` è¿½åŠ  (argparse)
  â† ã‚µãƒ–2: REPL ãƒ«ãƒ¼ãƒ—å®Ÿè£…
  â† ã‚µãƒ–3: ãƒ†ã‚­ã‚¹ãƒˆ â†’ è¦³å¯Ÿ â†’ æ¨è«– â†’ è¡Œå‹• ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
  â† ã‚µãƒ–4: Dirichlet å­¦ç¿’è¡¨ç¤º
  â† ç¾åœ¨åœ°: éå¯¾è©±çš„ãƒ‡ãƒ¢ã®ã¿
```

### å¤‰æ›´å¯¾è±¡

| ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´æ¦‚è¦ |
|:---------|:---------|
| [scripts/fep_demo.py](file:///home/laihuip001/oikos/hegemonikon/scripts/fep_demo.py) | å¯¾è©±ãƒ¢ãƒ¼ãƒ‰è¿½åŠ ã€REPL ãƒ«ãƒ¼ãƒ—ã€å­¦ç¿’è¡¨ç¤º |

### è¨­è¨ˆè©³ç´°

```python
def interactive_mode():
    """å¯¾è©±å‹ FEP ãƒ‡ãƒ¢"""
    agent = HegemonikÃ³nFEPAgent(use_defaults=True)
    print("FEP Interactive Mode")
    print("å…¥åŠ›: è‡ªç„¶è¨€èªãƒ†ã‚­ã‚¹ãƒˆ â†’ FEP æ¨è«–")
    print("ã‚³ãƒãƒ³ãƒ‰: /quit, /reset, /save, /load, /entropy")
    
    while True:
        user_input = input("\n> ").strip()
        
        if user_input == "/quit":
            break
        elif user_input == "/reset":
            agent = HegemonikÃ³nFEPAgent(use_defaults=True)
            print("âœ… ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒªã‚»ãƒƒãƒˆ")
            continue
        elif user_input == "/save":
            path = agent.save_learned_A()
            print(f"âœ… Aè¡Œåˆ—ä¿å­˜: {path}")
            continue
        elif user_input == "/load":
            if agent.load_learned_A():
                print("âœ… Aè¡Œåˆ—èª­è¾¼")
            else:
                print("âš ï¸ å­¦ç¿’æ¸ˆã¿Aè¡Œåˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
            continue
        elif user_input == "/entropy":
            print(f"ç¾åœ¨ã®ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼: {agent.get_entropy():.3f}")
            continue
        
        # ãƒ†ã‚­ã‚¹ãƒˆ â†’ è¦³å¯Ÿ â†’ æ¨è«–
        obs = encode_to_flat_index(user_input)
        result = agent.infer_states(obs)
        
        # Dirichlet å­¦ç¿’
        agent.update_A_dirichlet(obs)
        
        # ãƒãƒªã‚·ãƒ¼é¸æŠ
        q_pi, _ = agent.infer_policies()
        action = agent.sample_action()
        action_name = "observe" if action == 0 else "act"
        
        # å‡ºåŠ›
        print(f"  obs={obs}, entropy={result['entropy']:.2f}")
        print(f"  çŠ¶æ…‹: {result['map_state_names']}")
        print(f"  æ¨å¥¨è¡Œå‹•: {action_name} ({q_pi[action]:.1%})")
```

---

## STAGE 4: Devil's Advocate

| è¦–ç‚¹ | çµæœ | ç†ç”± |
|:-----|:-----|:-----|
| Feasibility | âœ… PASS | æ—¢å­˜é–¢æ•°ã®çµ„ã¿åˆã‚ã› |
| Necessity | âœ… PASS | å…ˆã»ã©ã®å®Ÿé¨“ã§æ‰‹å‹•ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡ŒãŒç…©é›‘ã ã£ãŸ |
| Alternatives | âœ… PASS | Jupyter ã§ã‚‚å¯èƒ½ã ãŒ CLI ã®æ–¹ãŒè»½é‡ |
| Risks | âœ… PASS | æ—¢å­˜æ©Ÿèƒ½ã¸ã®å½±éŸ¿ãªã— (è¿½åŠ ã®ã¿) |
| Dependencies | âœ… PASS | æ–°è¦ä¾å­˜ãªã— |

### Pre-mortem

1. **å…¥åŠ›ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼** â€” å¯¾ç­–: try/except + ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
2. **ç„¡é™ãƒ«ãƒ¼ãƒ—** â€” å¯¾ç­–: /quit ã‚³ãƒãƒ³ãƒ‰ã€Ctrl+C ãƒãƒ³ãƒ‰ãƒ©

---

## æ¤œè¨¼è¨ˆç”»

1. `python scripts/fep_demo.py -i` ã§å¯¾è©±ãƒ¢ãƒ¼ãƒ‰èµ·å‹•ç¢ºèª
2. ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› â†’ FEP å‡ºåŠ›ç¢ºèª
3. `/save`, `/load` ã‚³ãƒãƒ³ãƒ‰å‹•ä½œç¢ºèª
4. Ctrl+C ã§æ­£å¸¸çµ‚äº†ç¢ºèª
