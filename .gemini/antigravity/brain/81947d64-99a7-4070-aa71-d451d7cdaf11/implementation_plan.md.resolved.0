# Dispatch Log 設計

> **Hegemonikón**: スキル/ワークフロー発動の可視化

---

## 背景

現状の問題:
- スキルが「自動発動」されているか **見えない**
- ワークフロー実行時に内部でスキルが呼ばれているはずだが確認不可
- Phase B 移行条件 (dispatch_count ≥ 50) が 0 のまま

---

## 現況: ワークフロー → スキル参照

| パターン | ワークフロー | 参照方法 |
|:---------|:-------------|:---------|
| **skill_ref 明示** | /syn, /dia, /vet, /sop | YAML frontmatter で skill_ref 指定 |
| **ドキュメント内言及** | /boot, /o, /s, /h, /p, /k, /a | 手順内でパス言及（読み込みは任意） |

> **発見**: skill_ref は「意図」を示すが、実際の発動を保証しない

---

## 提案: Dispatch Log 記録項目

### レベル1: スキル発動 (Primary)

```yaml
skill_dispatch:
  - timestamp: "2026-01-28T14:00:00+09:00"
    skill: "O1 Noēsis"
    trigger: "workflow:/noe"  # or "auto:description_match"
    outcome: "success"
    duration_ms: 1200
```

**記録タイミング**:
- Claude がスキルを明示的に読み込んだ時
- ワークフロー内でスキルを参照した時
- 自然言語からスキルがマッチした時（Antigravity IDE 自動発動）

### レベル2: ワークフロー実行 (Secondary)

```yaml
workflow_dispatch:
  - timestamp: "2026-01-28T14:00:00+09:00"
    workflow: "/noe"
    skills_triggered: ["O1 Noēsis"]
    outcome: "success"
```

### レベル3: その他の記録候補

| 項目 | 目的 | 価値 |
|:-----|:-----|:-----|
| **KI 読み込み** | 知識活用状況の可視化 | 「どのKIが実際に使われているか」 |
| **パターン適用** | patterns.yaml の活用状況 | 「勘」が実際に使われているか |
| **Jules 委託** | 並列タスクの追跡 | Synedrion 活用度 |
| **Handoff 品質** | 再現性の実測 | 次セッション成功率 |
| **Drift 検出** | Boulēsis からの逸脱 | 軌道修正の頻度 |
| **例外パターン** | 想定外の状況 | Phase B 移行条件の1つ |

---

## 実装案

### 案A: 手動記録 (最小実装)

- Claude が意識的に `/dispatch skill:O1` のように記録
- 利点: すぐ始められる
- 欠点: 記録漏れの可能性

### 案B: /bye 時の自動集計

- セッション終了時にその日の発動を振り返り記録
- 利点: セッション単位で確実
- 欠点: リアルタイムではない

### 案C: ワークフロー内埋め込み

- 各ワークフローに「記録ステップ」を追加
- 利点: 漏れなし
- 欠点: ワークフロー肥大化

---

## 質問 (Creator へ)

1. **粒度**: スキル単位 vs ワークフロー単位 vs 両方？
2. **記録タイミング**: リアルタイム vs /bye 集計？
3. **追加記録項目**: 上記「その他」から優先すべきものは？
4. **自動発動の定義**: 
   - Antigravity IDE が description でマッチ → 真の自動発動
   - ワークフロー内でスキルを参照 → 半自動発動
   - どちらを重視？

---

*Generated by Hegemonikón O1 Noēsis*
