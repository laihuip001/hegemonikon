# Implementation Plan: /plan に「読み切ってから動く」機構を追加

## 目的

`/plan` ワークフローに、設計着手前に関連ファイルを**強制的に読み込む**ステップを追加する。これにより、以下を防止する：

1. **情報不足での設計開始** → 手戻り発生
2. **既存パターンの無視** → 車輪の再発明
3. **キャッシュされた古い情報での作業** → 不整合

## 設計原則

> **「探索-活用トレードオフにおいて、/plan フェーズは探索を最大化する」**

`/boot` の Anti-Stale Protocol と同様の思想を、設計フェーズに拡張する。

---

## Proposed Changes

### [MODIFY] [plan.md](file:///home/laihuip001/oikos/.agent/workflows/plan.md)

#### 新設: Step 0.2 コンテキスト強制読込（Read-Before-Act Protocol）

Step 0.1 (モデル適性チェック) と Step 0.5 (不足情報検出) の間に挿入：

```markdown
## Step 0.2: コンテキスト強制読込（Read-Before-Act Protocol）

> **🔍 [T1 Aisthēsis: Active]** — 読み切ってから動く

**目的**: 設計着手前に、関連する全ファイルを読み込み、「すでにある情報」を把握する。

### 必須読込リスト

1. **対象モジュールのファイル構造**
   - `list_dir` で対象ディレクトリを探索
   - 関連ファイル（*関連する .md, .py, .yaml 等）を特定

2. **既存のアーキテクチャドキュメント**
   - `docs/` 配下の関連するアーキテクチャドキュメント
   - `README.md` のアーキテクチャ概要

3. **既存のスキル/ワークフロー**
   - `.agent/skills/` から関連するスキル
   - `.agent/workflows/` から関連するワークフロー

4. **ナレッジアイテム（KI）**
   - Antigravity Knowledge から関連するKIのartifactsを読み込み
   - **重複調査/設計を防止**

### 出力形式

```
[Hegemonikon] Read-Before-Act
  📂 Files Read: [N] files
  📚 KI Referenced: [KI名リスト]
  ⚠️ Missing: [読めなかったが必要そうなファイル]
  
→ Step 0.5 へ進む
```

### チェックポイント

- [ ] 対象モジュールのファイル一覧を取得したか？
- [ ] 関連する既存ドキュメントを読んだか？
- [ ] 関連するKIを参照したか？
- [ ] 読込結果をサマリ出力したか？
```

---

## 変更差分

| 項目 | 変更前 | 変更後 |
|:--|:--|:--|
| Step番号 | 0.1 → 0.5 → 1 | 0.1 → **0.2** → 0.5 → 1 |
| 強制読込 | なし | Step 0.2 で必須化 |
| 出力形式 | なし | `[Hegemonikon] Read-Before-Act` |

---

## リスクと対策

| リスク | 対策 |
|:--|:--|
| 読込量が多すぎて時間がかかる | 「関連ファイルのみ」に限定、最大10ファイルの目安 |
| 読込が形骸化して形式だけになる | チェックポイントで強制確認 |

---

## 検証計画

### 手動検証

1. `/plan` を発動する新しい設計タスクを想定
2. Step 0.2 が正しく発動するかドライラン
3. 出力形式が仕様通りか確認

---

## 承認待ち

> [!IMPORTANT]
> この計画を承認しますか？
> 
> - **承認 (y)**: 実装を開始
> - **修正 (m)**: 計画を修正
> - **却下 (n)**: 計画を中止
