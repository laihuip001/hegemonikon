# Implementation Plan: /plan に「Read-Resolve-Proceed Protocol」を追加

## 目的

`/plan` ワークフローに、**懸念点を全て潰してから設計に着手する**強制機構を追加する。

> **設計原則**: 「懸念が多すぎて進めない」は正しい状態。進むべきでない時に進まないことを保証する。

---

## Proposed Changes

### [MODIFY] [plan.md](file:///home/laihuip001/oikos/.agent/workflows/plan.md)

#### 廃止: Step 0.5（不足情報検出）

- 現行の Step 0.5 は新 Step 0.2 に**発展的統合**
- 「不確実性スコア U」方式を「懸念点リスト」方式に置換

#### 新設: Step 0.2 Read-Resolve-Proceed Protocol

```markdown
## Step 0.2: Read-Resolve-Proceed Protocol

> **🛡️ [Gate: Blocking]** — 懸念点が全て解決するまで次に進めない

### Phase 1: Read（読込）

1. **対象モジュールのファイル構造**を `list_dir` で探索
2. **関連ファイル**（.md, .py, .yaml 等）を `view_file` で読込
3. **既存 KI** から関連アーティファクトを参照
4. **既存ワークフロー/スキル**の関連部分を確認

### Phase 2: Identify（懸念点抽出）

読込結果から、以下の5カテゴリで懸念点をリストアップ:

| カテゴリ | 例 |
|:--|:--|
| (a) 不明な仕様 | 「この要件の詳細が不明」 |
| (b) 不明な技術 | 「このライブラリの使い方がわからない」 |
| (c) 既存コードとの矛盾 | 「既存の実装と異なる方針」 |
| (d) KI/ドキュメントとの不整合 | 「ドキュメントと異なる動作」 |
| (e) 暗黙の前提 | 「この前提が成り立つか確認が必要」 |

### Phase 3: Resolve（解決）

各懸念点を以下の優先順位で解決:

1. ファイル追加読込
2. KI参照
3. Gnōsis検索
4. `/zet` で調査依頼
5. ユーザーに質問

> [!CAUTION]
> **全ての懸念点が [x] になるまで Step 1 に進んではならない**

### 出力形式

\`\`\`
[Hegemonikon] Read-Resolve-Proceed
  📂 Files Read: [N] files
  📚 KI Referenced: [リスト]

  🔍 Concerns Identified: [N]
    - [ ] (a) {懸念1} → 解決方法: {方法}
    - [x] (b) {懸念2} → 解決済み: {結果}
    ...

  ⚠️ Unresolved: [M] items
  → 全解決まで待機 / ユーザーに質問
\`\`\`

### チェックポイント

- [ ] 対象ファイルを読み込んだか？
- [ ] 関連KIを参照したか？
- [ ] 5カテゴリで懸念点を列挙したか？
- [ ] 各懸念点に解決方法を割り当てたか？
- [ ] **全ての懸念点が [x] か？**（ゲート条件）
```

---

## 変更差分

| 項目 | 変更前 | 変更後 |
|:--|:--|:--|
| Step 0.5 | 不足情報検出（U スコア方式） | **廃止**（Step 0.2 に統合） |
| Step 0.2 | なし | **Read-Resolve-Proceed Protocol** |
| ゲート | 条件分岐（U > 0.6 のみ発動） | **ブロッキング**（全懸念解決必須） |

---

## ワークフロー整合性

| ワークフロー | 役割 | 新 /plan との関係 |
|:--|:--|:--|
| `/plan` | 設計前の情報収集・懸念解消 | **本 Protocol の対象** |
| `/noe` | 根本的再考・前提破壊 | スコープ異なる（根本問題 vs 設計調査） |
| `/ene` | 実行 | /plan 完了後に発動 |

---

## 検証計画

1. `/plan` を発動する設計タスクで Step 0.2 が正しく動作するか確認
2. 懸念点が残っている状態で Step 1 に進もうとした時にブロックされるか確認

---

> [!IMPORTANT]
> この計画を承認しますか？
