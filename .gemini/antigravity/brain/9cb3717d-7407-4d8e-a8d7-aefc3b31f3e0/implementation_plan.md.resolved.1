# Jules API × Perspective Matrix Integration

## 目的

480 直交視点マトリクスを Jules API で実行し、構造的に冗長性ゼロのコードレビューを実現。

## 設計

```text
PerspectiveMatrix.all_perspectives()
       ↓
  generate_tasks(source, branch)
       ↓
  JulesClient.batch_execute()
       ↓
  8 batches × 60 = 480 reviews
```

## 変更対象ファイル

### [MODIFY] [jules_client.py](file:///home/laihuip001/oikos/hegemonikon/mekhane/symploke/jules_client.py)

新規メソッド追加:

```python
async def synedrion_review(
    self,
    source: str,
    branch: str = "main",
    domains: list[str] | None = None,  # フィルタ用
    axes: list[str] | None = None,     # フィルタ用
) -> list[JulesResult]:
    """
    Execute Synedrion v2.1 review with 480 orthogonal perspectives.
    
    Args:
        source: Repository source (e.g., "sources/github/owner/repo")
        branch: Branch to review
        domains: Optional list of domains to filter (e.g., ["Security", "Error"])
        axes: Optional list of axes to filter (e.g., ["O1", "A2"])
    
    Returns:
        List of JulesResult objects from all perspectives
    """
    from mekhane.ergasterion.synedrion import PerspectiveMatrix
    
    matrix = PerspectiveMatrix.load()
    perspectives = matrix.all_perspectives()
    
    # Apply filters if specified
    if domains:
        perspectives = [p for p in perspectives if p.domain_id in domains]
    if axes:
        perspectives = [p for p in perspectives if p.axis_id in axes]
    
    # Generate tasks from perspectives
    tasks = [
        {
            "prompt": matrix.generate_prompt(p),
            "source": source,
            "branch": branch,
            "perspective_id": p.id,  # Track which perspective
        }
        for p in perspectives
    ]
    
    logger.info(f"Starting Synedrion review: {len(tasks)} perspectives")
    
    # Execute in batches
    results = await self.batch_execute(tasks)
    
    return results
```

## 依存関係

```mermaid
graph LR
    A[synedrion_review] --> B[PerspectiveMatrix]
    A --> C[batch_execute]
    B --> D[perspectives.yaml]
    C --> E[Jules API]
```

## リスク

| リスク | 対策 |
|:-------|:-----|
| 480並列は時間がかかる | 進捗ログ表示 |
| API エラー | 既存リトライロジック活用 |
| フィルタなしで全実行 | domains/axes パラメータで絞り込み可能 |

## 検証計画

```bash
# 単一視点テスト
python3 -c "
import asyncio
from mekhane.symploke.jules_client import JulesClient

async def test():
    async with JulesClient() as client:
        results = await client.synedrion_review(
            source='sources/github/laihuip001/test-repo',
            domains=['Security'],
            axes=['O1']
        )
        print(f'Results: {len(results)}')

asyncio.run(test())
"

# 全視点テスト (本番)
# 480視点 × ~2分/視点 = ~16時間 (バッチ実行で短縮)
```

## 実装順序

1. `synedrion_review()` メソッドを [jules_client.py](file:///home/laihuip001/oikos/hegemonikon/mekhane/symploke/jules_client.py) に追加
2. 単一視点でテスト実行
3. 少数視点 (20) でバッチテスト
4. 全視点実行 (本番)

---

*Generated by /s v4.0 (2026-01-29)*
