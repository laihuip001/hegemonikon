# n8n/Zapier å®Ÿè£…è¨­è¨ˆæ›¸

> **HegemonikÃ³n è‡ªå¾‹å­¦ç¿’ã‚¤ãƒ³ãƒ•ãƒ©**
> **Version**: 1.0
> **Date**: 2026-01-31

---

## 1. æ¦‚è¦

### 1.1 ç›®çš„

900å€‹ã®æ¬²æœ›ãƒªã‚¹ãƒˆã‹ã‚‰æŠ½å‡ºã—ãŸ12ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®å®Ÿè£…è¨­è¨ˆã€‚
**n8n = AI ã®ç¥çµŒç³»**ã¨ã—ã¦ã€è¨˜æ†¶ãƒ»å­¦ç¿’ãƒ»è‡ªå¾‹ã®åŸºç›¤ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚

### 1.2 å„ªå…ˆã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼

| å„ªå…ˆåº¦ | ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ | ç†ç”± |
|:-------|:-----------|:-----|
| ğŸŸ  P0 | A è¨˜æ†¶ãƒ»æ°¸ç¶š | å…¨æ©Ÿèƒ½ã®åŸºç›¤ |
| ğŸŸ  P0 | E å®‰å…¨ãƒ»ä¿¡é ¼ | åˆæœŸã‹ã‚‰å¿…é ˆ |
| ğŸŸ¡ P1 | B çŸ¥æ€§ãƒ»å­¦ç¿’ | ã‚³ã‚¢ä¾¡å€¤ |
| ğŸŸ¡ P1 | D è‡ªå¾‹ãƒ»èƒ½å‹• | å·®åˆ¥åŒ–è¦ç´  |

---

## 2. ãƒ•ã‚§ãƒ¼ã‚ºè¨ˆç”»

### Phase 0: åŸºç›¤æ§‹ç¯‰ (Day 1-2)

```yaml
ç›®æ¨™: n8n ç¨¼åƒ + æœ€åˆã®ãƒ•ãƒ­ãƒ¼å‹•ä½œç¢ºèª
æˆæœç‰©:
  - n8n Docker ç¨¼åƒ
  - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãƒ•ãƒ­ãƒ¼
  - Slack é€šçŸ¥å‹•ä½œç¢ºèª
```

### Phase 1: ã‚»ãƒƒã‚·ãƒ§ãƒ³æ°¸ç¶šåŒ– (Day 3-7)

```yaml
ç›®æ¨™: /bye å®Ÿè¡Œæ™‚ã®è‡ªå‹•æ°¸ç¶šåŒ–
æˆæœç‰©:
  - Handoff è‡ªå‹•ä¿å­˜ãƒ•ãƒ­ãƒ¼
  - Sophia åŒæœŸãƒ•ãƒ­ãƒ¼
  - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°åŸºç›¤
```

### Phase 2: è‡ªå¾‹å­¦ç¿’ (Week 2)

```yaml
ç›®æ¨™: AI ãŒè‡ªå‹•ã§çŸ¥è­˜ã‚’å¸å
æˆæœç‰©:
  - GnÅsis æ—¥æ¬¡åé›†ãƒ•ãƒ­ãƒ¼
  - è«–æ–‡æ¶ˆåŒ–ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
  - å¤–éƒ¨ã‚½ãƒ¼ã‚¹ç›£è¦–
```

### Phase 3: è‡ªå¾‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ (Week 3-4)

```yaml
ç›®æ¨™: è‡ªå‹•ã‚¿ã‚¹ã‚¯å®Ÿè¡Œãƒ»äºˆæ¸¬
æˆæœç‰©:
  - è‡ªå‹•èª¿æŸ»ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
  - ç•°å¸¸æ¤œçŸ¥ã‚¢ãƒ©ãƒ¼ãƒˆ
  - Creatorä¸åœ¨æ™‚ã®è‡ªå¾‹æ´»å‹•
```

---

## 3. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
/home/laihuip001/oikos/
â”œâ”€â”€ n8n/
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â”œâ”€â”€ 01_health_check.json
â”‚   â”‚   â”œâ”€â”€ 02_bye_persistence.json
â”‚   â”‚   â”œâ”€â”€ 03_gnosis_daily.json
â”‚   â”‚   â””â”€â”€ 04_autonomous_research.json
â”‚   â”œâ”€â”€ credentials/
â”‚   â”‚   â””â”€â”€ .env
â”‚   â””â”€â”€ logs/
â””â”€â”€ hegemonikon/
    â””â”€â”€ mekhane/
        â””â”€â”€ n8n/
            â”œâ”€â”€ webhooks.py      # Webhook å—ä¿¡
            â”œâ”€â”€ triggers.py      # ãƒˆãƒªã‚¬ãƒ¼ç™ºç«
            â””â”€â”€ callbacks.py     # ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
```

---

## 4. n8n ç’°å¢ƒæ§‹ç¯‰

### 4.1 docker-compose.yml

```yaml
version: '3.8'
services:
  n8n:
    image: n8nio/n8n:latest
    container_name: hegemonikon-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=true
      - N8N_BASIC_AUTH_USER=${N8N_USER}
      - N8N_BASIC_AUTH_PASSWORD=${N8N_PASSWORD}
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - TZ=Asia/Tokyo
    volumes:
      - ~/.n8n:/home/node/.n8n
      - /home/laihuip001/oikos:/data/oikos:ro
    restart: unless-stopped
```

### 4.2 èµ·å‹•ã‚³ãƒãƒ³ãƒ‰

```bash
cd /home/laihuip001/oikos/n8n
docker-compose up -d
# ç¢ºèª: http://localhost:5678
```

---

## 5. ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ

### 5.1 WF-01: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

```json
{
  "name": "WF-01 Health Check",
  "nodes": [
    {
      "type": "n8n-nodes-base.scheduleTrigger",
      "parameters": { "rule": { "interval": [{ "field": "hours", "hoursInterval": 1 }] } }
    },
    {
      "type": "n8n-nodes-base.httpRequest",
      "parameters": { "url": "http://localhost:5678/healthz", "method": "GET" }
    },
    {
      "type": "n8n-nodes-base.if",
      "parameters": { "conditions": { "number": [{ "value1": "={{ $json.status }}", "value2": 200 }] } }
    },
    {
      "type": "n8n-nodes-base.slack",
      "parameters": { "channel": "#hegemonikon", "text": "âœ… n8n ç¨¼åƒä¸­" }
    }
  ]
}
```

---

### 5.2 WF-02: ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ°¸ç¶šåŒ–

**ãƒˆãƒªã‚¬ãƒ¼**: Webhook (POST /bye-signal)
**å‡¦ç†**:

```
1. Webhook å—ä¿¡
   â†“
2. ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ãƒ‘ãƒ¼ã‚¹
   â†“
3. Handoff ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
   â†“
4. Sophia åŒæœŸ (sophia_ingest.py)
   â†“
5. Kairos æŠ•å…¥ (kairos_ingest.py)
   â†“
6. FEP æ°¸ç¶šåŒ– (fep_persistence.py)
   â†“
7. Slack é€šçŸ¥
```

**n8n ãƒ•ãƒ­ãƒ¼æ¦‚è¦**:
```json
{
  "name": "WF-02 Bye Persistence",
  "trigger": "webhook",
  "endpoint": "/bye-signal",
  "nodes": [
    "Webhook â†’ Parse â†’ Sophia â†’ Kairos â†’ FEP â†’ Slack"
  ],
  "error_handling": {
    "retry": 3,
    "retry_interval": 60,
    "on_failure": "slack_alert"
  }
}
```

---

### 5.3 WF-03: GnÅsis æ—¥æ¬¡åé›†

**ãƒˆãƒªã‚¬ãƒ¼**: Cron (æ¯æœ 06:00 JST)
**å‡¦ç†**:

```
1. Cron ç™ºç« (06:00 JST)
   â†“
2. é®®åº¦ãƒã‚§ãƒƒã‚¯ (gnosis-cli check-freshness)
   â†“
3. [IF stale] â†’ åé›†å®Ÿè¡Œ (gnosis-cli collect --auto)
   â†“
4. Digestor å®Ÿè¡Œ (å€™è£œé¸å®š)
   â†“
5. MnÄ“mÄ“ æŠ•å…¥ (mneme-cli ingest)
   â†“
6. Slack ã‚µãƒãƒªãƒ¼é€šçŸ¥
```

---

### 5.4 WF-04: è‡ªå¾‹èª¿æŸ»ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

**ãƒˆãƒªã‚¬ãƒ¼**: Webhook ã¾ãŸã¯ Schedule
**å‡¦ç†**:

```
1. èª¿æŸ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡
   â†“
2. Perplexity API å‘¼ã³å‡ºã—
   â†“
3. çµæœã‚’ãƒ‘ãƒ¼ã‚¹
   â†“
4. Sophia ã«ä¿å­˜
   â†“
5. ç¿Œ /boot ã§è‡ªå‹•å‚ç…§
```

---

## 6. Webhook è¨­è¨ˆ

### 6.1 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

| Endpoint | Method | ç”¨é€” |
|:---------|:-------|:-----|
| `/bye-signal` | POST | ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†é€šçŸ¥ |
| `/research-request` | POST | èª¿æŸ»ä¾é ¼ |
| `/alert` | POST | ç·Šæ€¥é€šçŸ¥ |

### 6.2 Antigravity é€£æº

```python
# hegemonikon/mekhane/n8n/triggers.py
import requests

def trigger_bye_signal(session_id: str, handoff_path: str):
    """ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã« n8n ã¸é€šçŸ¥"""
    requests.post(
        "http://localhost:5678/webhook/bye-signal",
        json={
            "session_id": session_id,
            "handoff_path": handoff_path,
            "timestamp": datetime.now().isoformat()
        }
    )
```

---

## 7. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 7.1 ãƒªãƒˆãƒ©ã‚¤ãƒãƒªã‚·ãƒ¼

```yaml
default:
  max_retries: 3
  retry_interval: 60s
  backoff: exponential

critical:
  max_retries: 5
  retry_interval: 30s
  on_failure:
    - slack_alert
    - email_alert
```

### 7.2 ã‚¨ãƒ©ãƒ¼é€šçŸ¥ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```
ğŸš¨ n8n ãƒ•ãƒ­ãƒ¼å¤±æ•—

Workflow: {{ $workflow.name }}
Node: {{ $node.name }}
Error: {{ $json.error.message }}
Time: {{ $now.format("YYYY-MM-DD HH:mm:ss") }}
```

---

## 8. æ¤œè¨¼è¨ˆç”»

### 8.1 Phase 0 æ¤œè¨¼

| é …ç›® | æ–¹æ³• | æˆåŠŸåŸºæº– |
|:-----|:-----|:---------|
| n8n èµ·å‹• | `docker ps` | ã‚³ãƒ³ãƒ†ãƒŠç¨¼åƒ |
| Web UI | `curl localhost:5678` | 200 OK |
| Slack é€šçŸ¥ | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡ |

### 8.2 Phase 1 æ¤œè¨¼

| é …ç›® | æ–¹æ³• | æˆåŠŸåŸºæº– |
|:-----|:-----|:---------|
| /bye Webhook | æ‰‹å‹• POST | å—ä¿¡ç¢ºèª |
| Sophia åŒæœŸ | ãƒ­ã‚°ç¢ºèª | æ­£å¸¸å®Œäº† |
| ã‚¨ãƒ©ãƒ¼é€šçŸ¥ | æ„å›³çš„å¤±æ•— | Slack å—ä¿¡ |

---

## 9. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. [ ] n8n Docker èµ·å‹•
2. [ ] WF-01 ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ä½œæˆ
3. [ ] Slack é€£æºè¨­å®š
4. [ ] WF-02 Bye Persistence ä½œæˆ
5. [ ] Webhook ãƒˆãƒªã‚¬ãƒ¼å®Ÿè£…

---

*Generated by HegemonikÃ³n S2 MekhanÄ“ | 2026-01-31*
