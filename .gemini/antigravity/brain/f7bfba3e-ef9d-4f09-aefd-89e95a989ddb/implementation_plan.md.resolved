# Implementation Plan: pymdp Integration PoC

> **ç›®çš„**: Active Inference (pymdp) ã‚’ HegemonikÃ³n ã«çµ±åˆã—ã€O1 NoÄ“sis ã¨ O2 BoulÄ“sis ã®èªçŸ¥ãƒ—ãƒ­ã‚»ã‚¹ã‚’æ•°å­¦çš„ã«ãƒ¢ãƒ‡ãƒ«åŒ–ã™ã‚‹

---

## User Review Required

> [!IMPORTANT]
> ã“ã® PoC ã¯ HegemonikÃ³n ã®èªçŸ¥åŸºç›¤ã‚’ FEP ã«åŸºã¥ã„ã¦å†å®Ÿè£…ã™ã‚‹ç¬¬ä¸€æ­©ã§ã™ã€‚
> å®Ÿé‹ç”¨ã¸ã®çµ±åˆå‰ã«ã€æ¦‚å¿µå®Ÿè¨¼ã¨ã—ã¦ `/noe` ã‚„ `/bou` ã®åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã¨ä¸¦è¡Œè©•ä¾¡ã‚’è¡Œã†äºˆå®šã§ã™ã€‚

---

## /plan v3.0 çµæœã‚µãƒãƒª

### STAGE 0: Blindspot + Scale

| ã‚«ãƒ†ã‚´ãƒª | ç›²ç‚¹ | è§£æ±ºç­– |
|:---------|:-----|:-------|
| ğŸ¯ Framing | pymdp ã¯é›¢æ•£çŠ¶æ…‹ç©ºé–“å°‚ç”¨ | æœ€åˆã¯é›¢æ•£ãƒ¢ãƒ‡ãƒ«ã«é™å®šã€é€£ç¶šç©ºé–“ã¯å°†æ¥èª²é¡Œ |
| ğŸ“ Scope | å…¨ O-series åŒæ™‚å®Ÿè£…ã¯éå¤§ | O1 + O2 ã«é™å®šã—ãŸ PoC |
| ğŸ”— Dependencies | pymdp ã® venv äº’æ›æ€§ | æ—¢å­˜ .venv ã« pip install |
| ğŸ‘¤ Stakeholders | Creator ã®ã¿ | N/A |
| â±ï¸ Temporal | é•·æœŸçš„ã«ã¯ /ene, /noe ã«çµ±åˆå¿…è¦ | ã¾ãš PoCã€çµ±åˆã¯ Phase 2 |

**Scale**: ğŸ”­ Mesoï¼ˆæ–°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¿½åŠ ã€æ—¢å­˜ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¸ã®è»½å¾®ãªå½±éŸ¿ï¼‰

### STAGE 1: Strategy Selection

**Explore/Exploit**: **Explore å¯„ã‚Š**

- å¤±æ•—ã‚³ã‚¹ãƒˆ: ä½ã„ï¼ˆå®Ÿé¨“çš„ã‚³ãƒ¼ãƒ‰ï¼‰
- ç’°å¢ƒç¢ºå®Ÿæ€§: ä¸­ï¼ˆpymdp ã¯æˆç†Ÿã—ã¦ã„ã‚‹ãŒã€HegemonikÃ³n çµ±åˆã¯æœªçŸ¥ï¼‰
- æ™‚é–“åˆ¶ç´„: é€šå¸¸

**é¸æŠãƒ—ãƒ©ãƒ³**: **B (Robust)** â€” æŠ½è±¡åŒ–å±¤ã‚’è¨­ã‘ã¦å°†æ¥ã®æ‹¡å¼µã«å‚™ãˆã‚‹

### STAGE 2: Success Criteria

| è»¸ | Must | Should | Could |
|:---|:-----|:-------|:------|
| æ©Ÿèƒ½æ€§ | pymdp Agent ãŒçŠ¶æ…‹æ¨è«–ã‚’å®Ÿè¡Œã§ãã‚‹ | O1/O2 æ¦‚å¿µã¨ã®å¯¾å¿œãŒæ˜ç¢º | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½ |
| å“è³ª | å˜ä½“ãƒ†ã‚¹ãƒˆ3ä»¶ä»¥ä¸Š | ä¾‹å¤–å‡¦ç†ãŒæ•´å‚™ã•ã‚Œã¦ã„ã‚‹ | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™ |
| æ€§èƒ½ | æ¨è«–ãŒ1ç§’ä»¥å†…ã«å®Œäº† | N/A | N/A |

### STAGE 3: Blueprint

```
æœ€çµ‚ç›®æ¨™: /noe, /bou ã§ FEP ãƒ™ãƒ¼ã‚¹ã®åˆ¤å®šã‚’å®Ÿè¡Œ
  â†‘
ã‚µãƒ–ã‚´ãƒ¼ãƒ« 1: fep_agent.py ãŒ pymdp Agent ã‚’ãƒ©ãƒƒãƒ—ã—ã¦å‹•ä½œ
  â†‘
ã‚µãƒ–ã‚´ãƒ¼ãƒ« 2: Stoic-FEP å¯¾å¿œè¡¨ã«åŸºã¥ãçŠ¶æ…‹ç©ºé–“è¨­è¨ˆ
  â†‘
ç¾åœ¨åœ°: pymdp æ¦‚å¿µèª¿æŸ»å®Œäº†
```

### STAGE 4: Devil's Advocate

| è¦–ç‚¹ | çµæœ | ç†ç”± |
|:-----|:-----|:-----|
| Feasibility | âœ… PASS | pymdp ã¯æˆç†Ÿãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€Python 3.11 äº’æ› |
| Necessity | âœ… PASS | FEP ã¯ HegemonikÃ³n ã®ç†è«–çš„åŸºç›¤ã€å®Ÿè£…ãŒé…ã‚Œã¦ã„ã‚‹ |
| Alternatives | âœ… PASS | è‡ªå‰å®Ÿè£…ã¯ã‚³ã‚¹ãƒˆé«˜ã€pymdp ãŒæ¨™æº– |
| Risks | âš ï¸ CONDITIONAL | HegemonikÃ³n æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨ã®çµ±åˆãŒå°†æ¥èª²é¡Œ |
| Dependencies | âœ… PASS | pymdp ã®ã¿ã€ä»–ä¾å­˜ãªã— |

**Pre-mortem**:
1. pymdp ã®çŠ¶æ…‹ç©ºé–“è¨­è¨ˆãŒ HegemonikÃ³n æ¦‚å¿µã¨åˆã‚ãªã„ â†’ å¯¾ç­–: æŠ½è±¡åŒ–å±¤ã§å¸å
2. æ€§èƒ½ãŒãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼çµ±åˆã«ä¸ååˆ† â†’ å¯¾ç­–: éåŒæœŸå‡¦ç†ã§åˆ†é›¢

---

## Proposed Changes

### mekhane

#### [NEW] [fep/](file:///home/laihuip001/oikos/hegemonikon/mekhane/fep/)

æ–°è¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: FEP/Active Inference å®Ÿè£…

#### [NEW] [fep/__init__.py](file:///home/laihuip001/oikos/hegemonikon/mekhane/fep/__init__.py)

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆæœŸåŒ–

#### [NEW] [fep/fep_agent.py](file:///home/laihuip001/oikos/hegemonikon/mekhane/fep/fep_agent.py)

pymdp Agent ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹ã€‚ä»¥ä¸‹ã‚’å®Ÿè£…:

```python
class HegemonikÃ³nFEPAgent:
    """Active Inference agent for HegemonikÃ³n cognitive processes."""
    
    def __init__(self, A, B, C, D=None):
        """Initialize with POMDP matrices."""
        
    def infer_states(self, observation) -> dict:
        """O1 NoÄ“sis: Update beliefs based on observation."""
        
    def infer_policies(self) -> tuple:
        """O2 BoulÄ“sis: Select policy minimizing expected free energy."""
        
    def step(self, observation) -> dict:
        """Complete inference-action cycle."""
```

#### [NEW] [fep/state_spaces.py](file:///home/laihuip001/oikos/hegemonikon/mekhane/fep/state_spaces.py)

Stoic-FEP å¯¾å¿œã«åŸºã¥ãçŠ¶æ…‹ç©ºé–“å®šç¾©:

```python
# State factors
PHANTASIA_STATES = ["uncertain", "clear"]  # Impression clarity
ASSENT_STATES = ["withheld", "granted"]    # Belief commitment
HORME_STATES = ["passive", "active"]       # Action disposition

# Observation modalities
OBSERVATION_MODALITIES = {
    "context": ["ambiguous", "clear"],
    "urgency": ["low", "medium", "high"],
}
```

---

### tests

#### [NEW] [tests/test_fep_agent.py](file:///home/laihuip001/oikos/hegemonikon/tests/test_fep_agent.py)

```python
class TestHegemonikÃ³nFEPAgent:
    def test_init_with_valid_matrices(self):
        """Agent initializes with valid A, B, C matrices."""
        
    def test_infer_states_returns_beliefs(self):
        """infer_states returns updated belief distribution."""
        
    def test_infer_policies_returns_efe(self):
        """infer_policies returns policy probabilities and EFE values."""
        
    def test_step_completes_cycle(self):
        """step() performs full inference-action cycle."""
```

---

### Dependencies

#### [MODIFY] [requirements.txt](file:///home/laihuip001/oikos/hegemonikon/requirements.txt)

```diff
+ pymdp>=0.0.7
```

---

## Verification Plan

### Automated Tests

```bash
# 1. pymdp ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
cd /home/laihuip001/oikos/hegemonikon
source .venv/bin/activate
pip install pymdp>=0.0.7
python -c "import pymdp; print(f'pymdp version: {pymdp.__version__}')"

# 2. å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/test_fep_agent.py -v

# 3. çµ±åˆç¢ºèªï¼ˆimport ãƒ†ã‚¹ãƒˆï¼‰
python -c "from mekhane.fep.fep_agent import HegemonikÃ³nFEPAgent; print('Import OK')"
```

### Manual Verification

ãªã—ï¼ˆè‡ªå‹•ãƒ†ã‚¹ãƒˆã§ååˆ†ã‚«ãƒãƒ¼ï¼‰

---

## ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

| ãƒªã‚¹ã‚¯ | å¯¾ç­– |
|:-------|:-----|
| pymdp äº’æ›æ€§å•é¡Œ | Python 3.11 ã§ç¢ºèªæ¸ˆã¿ã€å•é¡Œç™ºç”Ÿæ™‚ã¯ pinned version |
| çŠ¶æ…‹ç©ºé–“è¨­è¨ˆã®è¦‹ç›´ã— | æŠ½è±¡åŒ–å±¤ã§å¤‰æ›´ã‚’å¸åå¯èƒ½ |
| ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼çµ±åˆã®è¤‡é›‘åŒ– | Phase 2 ã§æ®µéšçš„ã«å¯¾å¿œ |

---

*Generated by /plan v3.0 â€” S-Series å®Œå…¨çµ±åˆç‰ˆ*
