# Indexing & Retrieval Specification (v5.x Unified)

This document consolidates the implementation details of the **AnamnÄ“sis v5 series**, focusing on how session data is ingested, indexed, and proactively recalled.

## 1. Unified Indexing Architecture (v5.3)

As of v5.3, all session artifacts are merged into a single optimized vector index (`kairos.pkl`) at `mneme/.hegemonikon/indices/`.

- **Strategy**: "Single Truth, Multiple Granularity".
- **Mechanism**: The `--unified` flag in `kairos_ingest.py` handles concurrent ingestion of high-level handoffs and granular thought streams.
- **Benefits**: Simplifies retrieval logic and uncovers semantic relationships between high-level goals and granular process details.

## 2. Multi-Chunk Dialogue Retrieval (v5.0)

To handle the token limits of embedding models, large conversation logs are processed via **Message-Level Multi-Chunking**.

- **Chunking Logic**:
  - Splits at `## ðŸ¤– Claude` markers to respect turn-taking.
  - Aggregates fragments up to **1500 characters**.
  - **Contextual Priming**: Each chunk is prefixed with the session title to preserve global context.
- **Scale**: Sessions are transformed into semantically searchable fragments.

## 3. Retrieval Optimization (v5.4)

### 3.1 Heuristic Score Adjustment

Proactive weighting prioritizes synthesis over fragments while allowing deep process details to surface if highly relevant.

| Document Type | Boost | Rationale |
| :--- | :--- | :--- |
| **`handoff`** | **+0.08** | High-level synthesis; the "Executive Summary". |
| **`conversation_chunk`** | **+0.00** | Granular process details; the "How". |

### 3.2 Proactive Recall

Automated boot-time memory triggers are generated by extracting top 5 keywords (Katakana/Title Case) from the latest session handoff.

### 3.3 The Anti-Decay Principle

Semantic memory does not use time-decay. Philosophical insights from foundational sessions are treated with the same priority as recent technical fixes if their semantic similarity to the current context is comparable.

## 4. Federated Insight Mining (v5.1 - v5.2)

Automated "Buried Wisdom" extraction scans logs for gnomes, principles, discoveries, and decisions. A quality scoring layer (threshold: 0.4) evaluate candidates based on length, punctuation, and conclusionality to filter out UI noise.

---
*Consolidated: 2026-02-01 | Series: AnamnÄ“sis / Kairos / Intelligence*
