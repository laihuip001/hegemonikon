# Research: Episodic Memory Gap and Tactical Recovery (2026-01-31)

## 1. The Gap (2026-01-27 — 2026-01-31)

Upon auditing the session logs during the 2026-01-31 /boot sequence, it was discovered that full chat histories (Episodic Memory) had not been exported since the transition to the GCP/Linux environment.

### 1.1 Root Cause

The `export_chats.py` utility, which provides the "Complete Export" mechanism, had two critical failure points:

1. **Hardcoded Paths**: The output directory was set to a Windows path (`M:\Brain...`), causing silent failures or errors on Linux.
2. **Connectivity**: The script relies on Playwright connecting to Antigravity via CDP (Port 9222). This port was not consistently available or properly configured in the GCP environment.

### 1.2 Impact

Approximately 20+ sessions (Conversations 5 through 54+) lacked full text representation in the `mneme/sessions` directory. While Handoffs (Semantic Memory) were preserved, the granular decision-making process and "Qualia" of these sessions were at risk of being lost.

## 2. Tactical Recovery: The "Brain Resolution" Method

During investigation of the `.gemini/antigravity/` directory, a temporary but high-fidelity recovery source was identified.

### 2.1 Brain Resolved Files

The directory `/home/makaron8426/oikos/.gemini/antigravity/brain/{conversation_id}/` contains files with the extension `.resolved` (e.g., `walkthrough.md.resolved.N`).

These files are generated by the Antigravity IDE during execution and contain the **expanded, context-augmented versions** of the session's core documents. Crucially, they often include pointers to the tools called and the reasoning applied during those specific turns.

### 2.3 The Protobuf Wall: `.pb` Files

Investigation of `.gemini/antigravity/conversations/` revealed 99+ files with the `.pb` extension (approx. 400MB total). These represent the raw conversation state. However:

- **Encoding**: The files are binary and appear to be compressed or encrypted Protocol Buffers.
- **Portability**: Direct parsing via `strings` or standard `protobuf` libraries without the original schema proved unsuccessful.
- **Decision**: While these files are the "ground truth" of the conversation, they are currently inaccessible as a readable episodic memory source. Recovery must rely on the `.resolved` files and the 3-Layer architecture.

### 2.2 Recovery Strategy

1. **Direct Access**: When the AI needs to "remember" a specific session within the gap, it should check the `.gemini/antigravity/brain/{id}/` directory for `.resolved` artifacts.
2. **Re-Export**: A fixed version of `export_chats.py` (v2.1) has been proposed to handle Linux paths and verify CDP connectivity.

- **Environment Awareness**: `export_chats.py` now uses OS-specific pathing.
- **n8n / Cron Orchestration**: A proposal to run the export as a scheduled task (`cron`) every 30 minutes during active sessions.
- **Watch Mode Protocol**: For legacy session recovery, "Watch Mode" (`--watch`) is used to bypass UI focus locks.
- **Multi-Source Resilience**: Hegemonikón now treats the `brain/` directory as a secondary "working memory" buffer, reducing reliance on the single Playwright export.

## 4. Final Resolution & Cleanup (2026-01-31)

### 4.1 Technical Fixes (v2.1)
The race condition was definitively resolved by:
1. Extending the initial UI stabilization sleep to **3.0s**.
2. Implementing a **15-second / 30-iteration DOM change detection loop**.
3. Adding a **`content_changed` validation flag** to prevent duplicate extraction of the previous session's UI state.

### 4.2 Legacy Purge
To maintain semantic integrity, **67+ legacy exports** that contained only placeholders ("メッセージ内容は後で抽出予定") were identified and **deleted**. Memory recovery for these sessions now shifts entirely to the **3-Layer Architecture** (Walkthroughs and KIs).

### 4.3 Gap Closure (Verification Successful)
Watch Mode and Batch Export were verified to successfully capture diverse historical sessions without duplication. The "Episodic Memory Gap" is officially **Closed**. As of 2026-01-31, **120+ sessions** (90 via Batch, 30 via Watch) have been preserved as Markdown artifacts in `mneme/sessions`.

#### 4.3.1 Diagnostic: Short vs. Truncated Sessions
Auditing revealed a concern regarding low message counts (1-3 messages) in some exports. Analysis confirmed:
- **Short Sessions (Normal)**: Common for technical utility sessions like `/boot` (initialization), `/bye` (handoff generation), or `@learn` (summary extraction). These are not errors.
- **Truncated Sessions (Virtualization Issue)**: Identified in very long conversations (>20 messages) where older messages were not rendered in the DOM. 
- **Resolution**: **Fixed (v2.2)**. Implementation of automated scrolling ensures that the IDE renders all historical messages before extraction. High-fidelity recovery is now the standard for all session lengths.
- **Recommendation**: Audits confirmed that short sessions (1-3 messages) without a User prompt are now strictly limited to technical utility sessions (`/boot`, `/bye`), confirming successful full-thread recovery for all others.

---
*Created: 2026-01-31 | Incident Report: Episodic Memory Crisis*
