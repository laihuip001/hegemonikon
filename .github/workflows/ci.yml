name: CI

on:
  push:
    branches: [master, main]
  pull_request:
    branches: [master, main]

jobs:
  lint:
    name: Lint & Validate
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate YAML files
        run: |
          echo "Checking for YAML syntax errors..."
          find . -name "*.yml" -o -name "*.yaml" | head -20 | xargs -I {} sh -c 'python3 -c "import yaml; yaml.safe_load(open(\"{}\"))" 2>/dev/null || echo "Warning: {} may have issues"'

      - name: Check Markdown files exist
        run: |
          echo "Verifying core documentation..."
          test -f README.md && echo "✓ README.md"
          test -f kernel/doctrine.md && echo "✓ kernel/doctrine.md"
          test -d skills && echo "✓ skills/ directory"

      - name: Count Skills
        run: |
          echo "M-Series Skills:"
          ls -la skills/ | grep "^d" | wc -l
          echo "skills found"

  structure:
    name: Verify Structure
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Verify Hegemonikón Structure
        run: |
          echo "=== Hegemonikón Structure Check ==="
          echo ""
          echo "Kernel Layer:"
          ls kernel/ 2>/dev/null || echo "  (none)"
          echo ""
          echo "Skills Layer:"
          ls skills/ 2>/dev/null || echo "  (none)"
          echo ""
          echo "Docs Layer:"
          ls docs/ 2>/dev/null || echo "  (none)"
          echo ""
          echo "=== Check Complete ==="
