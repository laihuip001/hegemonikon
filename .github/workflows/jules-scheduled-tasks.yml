# Jules Scheduled Tasks for HegemonikÃ³n
#
# tekhne-maker v5.0 ã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—é§†å‹•è¨­è¨ˆã«åŸºã¥ã
# å°‚é–€å®¶ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®é€±æ¬¡å®šæ™‚å®Ÿè¡Œ
#
# ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«:
# - æ¯Žé€±æœˆæ›œ 09:00 JST (00:00 UTC)

name: Jules Specialist Reviews

on:
  schedule:
    # æ¯Žé€±æœˆæ›œ 00:00 UTC (09:00 JST)
    - cron: "0 0 * * 1"
  workflow_dispatch:
    inputs:
      category:
        description: "å®Ÿè¡Œã™ã‚‹ã‚«ãƒ†ã‚´ãƒª (all/cognitive_load/ai_risk/async/theory)"
        required: true
        default: "all"
        type: choice
        options:
          - all
          - cognitive_load
          - ai_risk
          - async
          - theory
      target_file:
        description: "ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«"
        required: false
        default: "mekhane/symploke/jules_client.py"
      dry_run:
        description: "ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ï¼ˆå®Ÿè¡Œã›ãšãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç¢ºèªï¼‰"
        type: boolean
        default: false

env:
  JULES_REPO_SOURCE: "sources/github/${{ github.repository }}"
  JULES_BRANCH: "master"

jobs:
  specialist-review:
    name: "ðŸ” Specialist Review Batch"
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"
      
      - name: Install dependencies
        run: |
          pip install aiohttp
      
      - name: Run Specialist Batch
        env:
          JULIUS_API_KEY_7: ${{ secrets.JULIUS_API_KEY_7 }}
          JULIUS_API_KEY_8: ${{ secrets.JULIUS_API_KEY_8 }}
          JULIUS_API_KEY_9: ${{ secrets.JULIUS_API_KEY_9 }}
        run: |
          cd mekhane/symploke
          
          # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
          CATEGORY="${{ github.event.inputs.category || 'all' }}"
          TARGET="${{ github.event.inputs.target_file || 'mekhane/symploke/jules_client.py' }}"
          DRY_RUN="${{ github.event.inputs.dry_run || 'false' }}"
          
          echo "=== Jules Specialist Review ==="
          echo "Category: $CATEGORY"
          echo "Target: $TARGET"
          echo "Dry Run: $DRY_RUN"
          echo ""
          
          if [ "$DRY_RUN" = "true" ]; then
            python run_specialists.py --category "$CATEGORY" --target "$TARGET" --dry-run
          else
            python run_specialists.py --category "$CATEGORY" --target "$TARGET" --output "../../docs/specialist_run_results.json"
          fi
      
      - name: Upload Results
        if: ${{ github.event.inputs.dry_run != 'true' }}
        uses: actions/upload-artifact@v4
        with:
          name: specialist-results-${{ github.run_number }}
          path: docs/specialist_run_results.json
          retention-days: 30
      
      - name: Summary
        run: |
          echo "## ðŸ” Specialist Review Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          if [ -f docs/specialist_run_results.json ]; then
            echo '```json' >> $GITHUB_STEP_SUMMARY
            cat docs/specialist_run_results.json >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
          else
            echo "çµæžœãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ãƒ¢ãƒ¼ãƒ‰ï¼‰" >> $GITHUB_STEP_SUMMARY
          fi
