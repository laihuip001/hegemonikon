# Jules Daily Specialist Reviews for HegemonikÃ³n
#
# tekhne-maker v5.0 ã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—é§†å‹•è¨­è¨ˆã«åŸºã¥ã
# å°‚é–€å®¶ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®**æ¯Žæ—¥**å®šæ™‚å®Ÿè¡Œ
#
# ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«:
# - æ¯Žæ—¥ 08:00 JST (å‰æ—¥ 23:00 UTC)
# - 9 API ã‚­ãƒ¼ Ã— 80 ã‚¿ã‚¹ã‚¯ = 720 å°‚é–€å®¶/æ—¥
# - /boot ã§çµæžœã‚’çµ±åˆ

name: Jules Daily Specialist Reviews

on:
  schedule:
    # æ¯Žæ—¥ 23:00 UTC (ç¿Œæ—¥ 08:00 JST)
    - cron: "0 23 * * *"
  workflow_dispatch:
    inputs:
      category:
        description: "å®Ÿè¡Œã™ã‚‹ã‚«ãƒ†ã‚´ãƒª (all/cognitive_load/ai_risk/async/theory)"
        required: true
        default: "all"
        type: choice
        options:
          - all
          - cognitive_load
          - ai_risk
          - async
          - theory
      target_file:
        description: "ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«"
        required: false
        default: "mekhane/symploke/jules_client.py"
      max_specialists:
        description: "æœ€å¤§å°‚é–€å®¶æ•° (720/æ—¥ã¾ã§)"
        required: false
        default: "100"
      dry_run:
        description: "ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ï¼ˆå®Ÿè¡Œã›ãšãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç¢ºèªï¼‰"
        type: boolean
        default: false

env:
  JULES_REPO_SOURCE: "sources/github/${{ github.repository }}"
  JULES_BRANCH: "master"

jobs:
  daily-specialist-review:
    name: "ðŸ” Daily Specialist Review (720/day capacity)"
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"
      
      - name: Install dependencies
        run: |
          pip install aiohttp
      
      - name: Run Specialist Batch
        env:
          # 9 API ã‚­ãƒ¼ = 720 ã‚¿ã‚¹ã‚¯/æ—¥
          JULIUS_API_KEY_1: ${{ secrets.JULIUS_API_KEY_1 }}
          JULIUS_API_KEY_2: ${{ secrets.JULIUS_API_KEY_2 }}
          JULIUS_API_KEY_3: ${{ secrets.JULIUS_API_KEY_3 }}
          JULIUS_API_KEY_4: ${{ secrets.JULIUS_API_KEY_4 }}
          JULIUS_API_KEY_5: ${{ secrets.JULIUS_API_KEY_5 }}
          JULIUS_API_KEY_6: ${{ secrets.JULIUS_API_KEY_6 }}
          JULIUS_API_KEY_7: ${{ secrets.JULIUS_API_KEY_7 }}
          JULIUS_API_KEY_8: ${{ secrets.JULIUS_API_KEY_8 }}
          JULIUS_API_KEY_9: ${{ secrets.JULIUS_API_KEY_9 }}
        run: |
          cd mekhane/symploke
          
          # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
          CATEGORY="${{ github.event.inputs.category || 'all' }}"
          TARGET="${{ github.event.inputs.target_file || 'mekhane/symploke/jules_client.py' }}"
          DRY_RUN="${{ github.event.inputs.dry_run || 'false' }}"
          
          echo "=== Jules Daily Specialist Review (720/day) ==="
          echo "Date: $(date -u +%Y-%m-%d)"
          echo "Category: $CATEGORY"
          echo "Target: $TARGET"
          echo "Dry Run: $DRY_RUN"
          echo ""
          
          if [ "$DRY_RUN" = "true" ]; then
            python run_specialists.py --category "$CATEGORY" --target "$TARGET" --dry-run
          else
            python run_specialists.py \
              --category "$CATEGORY" \
              --target "$TARGET" \
              --output "../../docs/specialist_run_$(date -u +%Y%m%d).json"
          fi
      
      - name: Upload Results
        if: ${{ github.event.inputs.dry_run != 'true' }}
        uses: actions/upload-artifact@v4
        with:
          name: specialist-results-${{ github.run_number }}
          path: docs/specialist_run_*.json
          retention-days: 30
      
      - name: Summary
        run: |
          echo "## ðŸ” Daily Specialist Review Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Date:** $(date -u +%Y-%m-%d)" >> $GITHUB_STEP_SUMMARY
          echo "**Capacity:** 9 keys Ã— 80 tasks = 720 specialists/day" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          if ls docs/specialist_run_*.json 1> /dev/null 2>&1; then
            echo '```json' >> $GITHUB_STEP_SUMMARY
            cat docs/specialist_run_*.json | head -100 >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
          else
            echo "çµæžœãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" >> $GITHUB_STEP_SUMMARY
          fi
