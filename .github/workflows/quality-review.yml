# Automated Quality Review for HegemonikÃ³n
#
# Perplexityç ”ç©¶ã€Œè‡ªå‹•å“è³ªãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿæ§‹ã€ã«åŸºã¥ã
# ISO 25010 + 3Må“è³ªç®¡ç†ã®è‡ªå‹•ãƒã‚§ãƒƒã‚¯
#
# ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«: æ¯Žé€±æœˆæ›œ 09:00 JST (Jules ã¨åŒæ™‚åˆ»)

name: Quality Review

on:
  schedule:
    - cron: "0 0 * * 1"  # æ¯Žé€±æœˆæ›œ 00:00 UTC
  pull_request:
    branches: [master, main]
  workflow_dispatch:

jobs:
  code-quality:
    name: "ðŸ” Code Quality (ISO 25010)"
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"
      
      - name: Install tools
        run: |
          pip install ruff bandit vulture pip-audit
      
      # Stage 1: ä¿å®ˆæ€§ (Maintainability)
      - name: "ðŸ“Š Complexity Check (CC â‰¤ 15)"
        run: |
          echo "## Complexity Analysis" >> $GITHUB_STEP_SUMMARY
          ruff check . --select C901 --output-format=text || true
      
      # Stage 2: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ (Security)
      - name: "ðŸ”’ Security Scan (Bandit)"
        run: |
          echo "## Security Scan" >> $GITHUB_STEP_SUMMARY
          bandit -r mekhane/ -f txt -ll || true
      
      # Stage 3: ãƒ ãƒ€æ¤œå‡º (Dead Code)
      - name: "ðŸ§¹ Dead Code (Vulture)"
        run: |
          echo "## Dead Code Analysis" >> $GITHUB_STEP_SUMMARY
          vulture mekhane/ --min-confidence 90 || true
      
      # Stage 4: è„†å¼±æ€§ (Vulnerabilities)
      - name: "âš ï¸ Dependency Audit"
        run: |
          echo "## Dependency Vulnerabilities" >> $GITHUB_STEP_SUMMARY
          pip-audit --progress-spinner=off || true
      
      - name: Summary
        run: |
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "**Framework**: ISO/IEC 25010 + 3M (ãƒ ãƒª/ãƒ ãƒ€/ãƒ ãƒ©)" >> $GITHUB_STEP_SUMMARY
          echo "*Generated by HegemonikÃ³n Quality Review*" >> $GITHUB_STEP_SUMMARY
