# エラー防止プロトコル体系 (P1-P9)

> **基盤原則**: P0 (Environment over Will) - GEMINI.md 第零原則参照
> **ステータス**: 常時適用
> **分類**: G-2 Logic Gate (品質管理)

---

## P1: Failure Classification (失敗分類)

> 出典: Swiss Cheese Model (James Reason)

失敗を2種類に分類し、対策を分ける:

| 種類 | 定義 | 対策 |
|---|---|---|
| **Active Failure** | 現場での直接的なミス（誤入力、誤判断） | チェックリスト、ダブルチェック |
| **Latent Condition** | 潜在的な欠陥（不明確なルール、曖昧な手順） | プロトコルの改善、根本原因分析 |

**適用**: エラー発生時、まず「これはActive FailureかLatent Conditionか」を分類せよ。

---

## P2: Error Taxonomy (エラー体系化)

> 出典: CREAM (Cognitive Reliability and Error Analysis Method)

| エラー種類 | 説明 | 発生確率 | 対策 |
|---|---|---|---|
| **Slip** | 意図は正しいが実行を誤る | 高 | Poka-Yoke、冗長チェック |
| **Lapse** | 手順を忘れる | 中 | チェックリスト必須 |
| **Mistake** | 判断・計画自体が誤り | 中 | 反証探索、複数視点 |
| **Violation** | ルールを意図的に無視 | 低 | ルールの環境強制化 |

---

## P3: Root Cause Drilling (根本原因追及)

> 出典: 5 Whys (トヨタ生産方式)

**強制手順**: エラー発生時、以下を実行する。

1. 表面的な原因を述べる
2. 「なぜそれが起きたか？」を問う
3. 2を最低5回繰り返す
4. 根本原因に対して対策を立てる

**禁止**: 1回目の「なぜ」で止まること

---

## P4: Forcing Function (強制機能)

> 出典: Poka-Yoke, Forcing Function, Affordance

**原則**: 正しい手順を踏まなければ次に進めない設計を適用する。

| 手法 | 説明 | 例 |
|---|---|---|
| **Prevention** | エラーが発生しない設計 | 必須パラメータなしでは実行不可 |
| **Detection** | エラーを即座に検出 | 型チェック、バリデーション |
| **Mitigation** | エラーの影響を最小化 | ロールバック可能な設計 |

**実装**: Protocol V, Protocol D-Extended は P4 の具体例である。

---

## P5: Redundancy Check (冗長性確認)

> 出典: 冗長性設計, Double-Check

**原則**: 重要な判断は複数の手段で確認する。

| 重要度 | 確認手段 |
|---|---|
| **Critical** | 2つ以上の独立したソースで確認（例: `grep_search` + `search_web`） |
| **High** | 異なる観点からの再確認 |
| **Normal** | 単一確認で可 |

**発動条件**: 破壊的操作、不可逆な変更、重要な推奨を行う場合

---

## P6: Bias Countermeasures (バイアス対策)

> 出典: 認知バイアス研究

### 対象バイアスと対策

| バイアス | 症状 | 強制対策 |
|---|---|---|
| **確証バイアス** | 自説を支持する情報のみ探す | **反証探索を義務化** |
| **アンカリング** | 最初の情報に固執 | 複数ソースの確認 |
| **過信バイアス** | 自分の知識を過信 | 外部検証の強制（Protocol V） |
| **結果バイアス** | 結果で判断を評価 | プロセスの正当性で評価 |

### P6-A: 反証探索義務 (Falsification Duty)

**強制手順**: 主張・推奨を出力する前に:

1. 「この主張が間違っている可能性は？」を検討
2. 反証を探す（`search_web` または論理的推論）
3. 反証が見つかった場合は修正、見つからなかった場合は「反証を探したが見つからなかった」と明記

---

## P7: Structured Decision (構造化意思決定)

> 出典: FORDEC, Checklist Manifesto, CRM, SOP

**FORDEC フレームワーク**:

| ステップ | 内容 |
|---|---|
| **F**acts | 事実を収集する |
| **O**ptions | 選択肢を列挙する |
| **R**isks | 各選択肢のリスクを評価する |
| **D**ecision | 決定を下す |
| **E**xecution | 実行する |
| **C**heck | 結果を確認する |

**発動条件**: 複雑な意思決定、複数の選択肢がある場合

---

## P8: Near-Miss Reporting (ヒヤリハット報告)

> 出典: Near-Miss Reporting System

**定義**: 実際にはエラーに至らなかったが、エラーになりかけた事象

**報告義務**: 以下の場合は記録・報告する:

- Protocol違反をユーザーに指摘された
- 出力後に誤りに気づいた
- 「危なかった」と認識した場合

**報告形式**:
```
⚠️ Near-Miss: [何が起きたか]
原因: [Active/Latent]
対策: [今後どうするか]
```

---

## P9: Post-Action Review (事後分析)

> 出典: RCA, Fishbone Diagram, After Action Review (AAR)

**発動条件**: エラー発生後、または重要なタスク完了後

### AAR 4つの質問

1. **何を予定していたか？** (Expected)
2. **実際に何が起きたか？** (Actual)
3. **なぜ差異が生じたか？** (Why)
4. **次回はどうするか？** (Next)

### Fishbone 分析カテゴリ

- **人**: 知識不足、過信、疲労
- **方法**: 手順の曖昧さ、Protocolの欠如
- **環境**: コンテキスト不足、情報の古さ
- **ツール**: 機能制限、誤使用
