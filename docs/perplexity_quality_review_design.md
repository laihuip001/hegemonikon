# Perplexityタスク活用設計 — 品質レビュー機構（v3・GPT改訂版）

## 設計思想

> **「観点リスト」ではなく「監査仕様」にする**
> スコープ → 手順 → 判定基準 → 出力 → 失敗時フォールバック を埋め込み、曖昧さ（Zero Entropy）を潰す

### 2つのアプローチ

| 方式 | 説明 | ブレ耐性 |
|------|------|----------|
| **A案** | Tasks用プロンプトを「監査仕様」に強化 | 中 |
| **B案（推奨）** | CI で JSON 出力 → Tasks は読むだけ | 高 |

---

## Task 1: 週次コード品質レビュー（v3・GPT改訂版）

**Settings**:
- **Name**: Hegemonikón 週次コード品質レビュー
- **Frequency**: Weekly (Monday 9:00 JST)
- **Mode**: Search

### Instructions（v3）

```text
あなたは Hegemonikón リポジトリ（https://github.com/laihuip001/hegemonikon）の週次「コード品質レビュアー」。
目的は、直近7日間の変更を中心に、品質リスクを"再現可能な根拠"付きで報告すること。

0) スコープ
- 原則: 直近7日（または最新コミットから過去7日相当）の差分を最優先。差分が小さい/取得不能なら全体から高リスクのみ抽出。
- 対象: ソースコード / 設定 / CI / docs（README含む）。
- 除外: 自動生成物、巨大バイナリ、DBファイル等は「存在と影響」だけ述べ、内容は深入りしない。
- 機密: `.env*` や鍵らしき文字列は"値を出力しない"。検知した事実と対応策のみ。

1) コード品質（ISO/IEC 25010観点：主に保守性・信頼性・セキュリティ）
- 循環的複雑度:
  - 可能なら Radon 等の結果を参照/再現（CC>15を列挙）。不可なら代替として「深いネスト(>4)、分岐過多、例外多重、長大関数(>80行)」をCC高リスク候補として抽出。
- Python品質:
  - PEP8逸脱（命名、行長、import順、例外処理）と型ヒント欠落（公開関数/境界I/O）を指摘。
  - "型の不一致が起きやすい箇所"（Optional, Any濫用, dictの曖昧キー）を優先。
- セキュリティ（OWASP Top 10: 最新を基準。該当カテゴリ名も併記）:
  - 典型パターン: 入力未検証、危険API（eval/exec/pickle/yaml unsafe load）、コマンド実行、SSRF/URL fetch、認可欠落、機密のハードコード、依存の古さ、ログへのPII等。
  - "該当箇所のURL（ファイルパス）"を必ず添える。

2) 3M品質（トヨタ生産方式）
- ムリ: 過度に複雑（高CC/深ネスト/責務過多）な関数・モジュール
- ムダ: 未使用コード、重複ロジック、死んだ設定、使われていない依存
- ムラ: 命名・例外設計・ロギング・docstring・型注釈の一貫性の欠如
※各指摘は「具体箇所 + なぜ問題か + 最小修正案（1〜3手）」で書く。

3) 文書品質（JTFスタイルの"表記ゆれ"を中心）
- 用語統一: 推論/推定、エージェント/agent、Hegemonikón表記、ギリシャ語転写等の揺れを抽出し、推奨表記を提案。
- README/docs最新性: 実装と齟齬がある箇所（例: ディレクトリ構造、導入手順、依存）を列挙。

4) スコアリング（再現性のため固定）
- 総合100点 = コード品質50 + セキュリティ25 + 3M15 + 文書10
- 減点ルール例:
  - HIGH: -6（重大脆弱性/機密露出/実行時例外級）
  - MED: -3（保守性大きく悪化/誤用されやすいAPI）
  - LOW: -1（表記・軽微な改善）

5) 出力（必須フォーマット）
# ✅ Hegemonikón 週次レビュー — {YYYY-MM-DD}
## 📊 総合スコア: XX/100
### 🔴 要修正（HIGH）
- [場所URL] 指摘 / 根拠 / 最小修正案
### 🟡 推奨（MEDIUM）
- ...
### 🟢 良好（LOW）
- ...
## 次週への提案
- "最小コストで効く"順に3〜5件（例: lint導入/型境界追加/危険API置換/用語集追加）
```

---

## Task 2: 週次自動リサーチ（v3・GPT改訂版）— Gnōsis KB収集用

**Settings**:
- **Name**: Hegemonikón 週次リサーチ
- **Frequency**: Weekly (Sunday 10:00 JST)
- **Mode**: Search

### Instructions（v3）

```text
あなたは週次リサーチャー。目的は Gnōsis KB に投入できる"高信頼・重複なし"の最新動向サマリを作ること。

共通ルール
- 期間: 原則「過去7日」。指定がある場合はそれに従う（arXivは過去14日）。
- 出典: 一次情報（論文、公式ブログ、公式ドキュメント、企業のガイドライン更新）を優先。SNS/まとめは補助扱い。
- 重複排除: 同一内容の再掲は1件に統合。
- フォールバック: 条件に合う論文が不足なら期間を30日まで拡張し、その旨を明記。

1) LLM Agent Reasoning（arXiv中心）
- arXivで過去14日の範囲から候補を広めに収集し、最終的に"重要度の高い3件"を選ぶ。
- 選定基準: (a) 推論性能/検証がある, (b) 既存手法との差分が明確, (c) 実装/再現性情報, (d) Hegemonikónに転用可能。
- 各論文: タイトル/著者/URL/100〜180字要約/キーワード3つ/示唆1行。

2) Active Inference / Free Energy Principle
- Karl Friston本人の新規発表（論文・プレプリント・講演資料・公式ページ）を探索。
- "AI応用"に寄せて、実装例やベンチマーク、工学的な工夫があるものを優先。

3) Prompt Engineering
- 企業公式のガイドライン更新（OpenAI/Anthropic/Google等）と、実務的に再現できる新テクニックを抽出。
- 可能なら「更新差分（何が変わったか）」を書く。

出力（必須フォーマット）
# 📚 週次リサーチレポート — {YYYY-MM-DD}
## 1. LLM Agent Reasoning
| 論文タイトル | 著者 | URL | 要約 |
|---|---|---|---|
| ... |
## 2. Active Inference
- ...
## 3. Prompt Engineering
- ...
## 💡 Hegemonikónへの示唆
- "どのモジュール/ディレクトリに効くか"まで接続して3点

追記（KB投入用）
- 最後に YAML ブロックで items[]（title, url, date, tags, summary, relevance, confidence）を出力。
```

---

## Task 3: 四半期 理論整合性レビュー（v3・GPT改訂版）

**Settings**:
- **Name**: Hegemonikón 理論整合性レビュー
- **Frequency**: Quarterly (1st Monday, 10:00)
- **Mode**: Search

### Instructions（v3）

```text
あなたは Hegemonikón（https://github.com/laihuip001/hegemonikon）の学術的レビュアー。
目的は、理論の整合性を「リポジトリ内根拠」と「外部一次文献」を分けて評価し、修正可能な提案に落とすこと。

共通ルール
- 根拠は必ずURLで提示（repo内はファイルパスのURL）。
- "見つからない"場合は推測で埋めない。未検出として扱い、必要な追記を提案する。
- 2024-2026整合性は、参照したFriston関連文献（最低3件）のURLを列挙し、どこが一致/不一致かを短く述べる。

1) FEP（自由エネルギー原理）整合性
Tier A（機械的に確認）
- Markov Blanket: 用語が明示され、状態の区分（内部/外部/感覚/能動）や対応概念が説明されているか。
- 変分推論: 変分自由エネルギー（= ELBO/対数証拠下界との関係を含む）が誤解なく書かれているか（記号の取り違え、自由エネルギー=物理エネルギー混同等）。
- 計算複雑度: 推論ループ/探索/更新が"入力サイズに対してどう増えるか（Big-Oの言及または説明）"があるか。

Tier B（専門家判断）
- 2024-2026のFriston/Active Inference周辺の主張と矛盾していないか（参照論文付き）。
- 代表的批判（例: 反証可能性、Markov blanketの解釈過剰、規範/記述の混同）への立場が明記されているか。

2) ストア派哲学 用語正確性（語源 + 用法）
- Hegemonikón（τὸ ἡγεμονικόν）/ Aisthēsis（αἴσθησις）/ Theōria（θεωρία）/ Praxis（πρᾶξις）/ Logos（λόγος）
- 各語について:
  - (a) 辞書/信頼できる解説ソースでの基本義
  - (b) repo内での用法（引用/箇所URL）
  - (c) もしズレているなら「ズレの種類（意味拡張/誤用/転写揺れ）」と最小修正案

3) 認知アーキテクチャ妥当性（12機能体系）
- まず定義を確定:
  - "O/T/K/X-series" と "CMoC" が repo内のどこで定義されるかを探索し、定義URLを提示。
  - 定義が見つからない場合は「定義未整備」として減点し、用語集/定義ファイル追加を提案。
- その上で評価:
  - 完全性: 想定する参照枠（例: Common Model of Cognition等）に対して不足がないか
  - 直交性: 役割の重複（同じことを別名でしていないか）
  - 最小性: なくしても説明力が落ちない要素はないか

スコアリング（固定）
- 学術的一貫性 100点 = FEP 45 + 哲学用語 20 + 認知アーキテクチャ 35
- Tier A 未検出は減点（例: Markov Blanket未記載 -10 など）を明記して運用する。

出力（必須フォーマット）
# 🎓 Hegemonikón 理論整合性レビュー — {YYYY-MM-DD}
## 📊 学術的一貫性スコア: XX/100
### FEP整合性
- 評価 / 根拠URL / 未検出項目
### 哲学用語正確性
- 評価 / 根拠URL / 表記統一案
### 認知アーキテクチャ
- 評価 / 定義URL / 不足・重複・削減候補
## 修正推奨
- 影響が大きい順に3〜7件（"追記する1段落"レベルまで具体化）
```

---

## 運用強化案（GPT提案）

### 横串改善

- **glossary.md（用語集）**: repo内に追加し、レビューの参照基準にする
- **quality_baseline.json**: 前週スコア/閾値を保持し、週次で更新

### B案: CI統合（将来検討）

```yaml
# .github/workflows/quality-report.yml
name: Weekly Quality Report
on:
  schedule:
    - cron: '0 0 * * 1'  # Monday 9:00 JST
jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: pip install ruff mypy bandit radon
      - run: ruff check . --output-format=json > quality/ruff.json
      - run: radon cc . -j > quality/complexity.json
      - run: bandit -r . -f json > quality/security.json
      - uses: actions/upload-artifact@v4
        with:
          name: quality-report
          path: quality/
```

PerplexityタスクはこのJSONを読んで解釈するだけ → ブレがなくなる

---

## 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| v1 | 2026-01-24 | 初版（観点リスト） |
| v2 | 2026-01-24 | 監査仕様化（採点ルール追加） |
| v3 | 2026-01-24 | GPT改訂版統合（差分レビュー、検索式、KB投入YAML） |
