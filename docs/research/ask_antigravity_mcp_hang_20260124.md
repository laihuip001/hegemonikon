# 調査依頼書（深掘り版）

テーマ: Antigravity IDE でカスタム MCP サーバーがハングする問題

---

## 0. あなた（調査者）への依頼（最重要）

私は **Antigravity IDE**（Google製 AI統合開発環境）で**カスタム MCP サーバー**を登録して使用しようとしているが、**呼び出し時にハング**して応答が返ってこない問題に直面している。

以下について、**一般論で終わらせず**、2025年10月〜2026年1月時点の最新情報を**一次情報（公式ドキュメント、GitHub Issues、フォーラム）**で裏付けてほしい:

1. Antigravity IDE でカスタム MCP サーバーを登録する正しい方法
2. mcp_config.json の正しい配置場所とフォーマット
3. MCP サーバーがハングする既知の問題と解決策

結論は「できる/できない」の二択ではなく、**具体的な設定手順**と**トラブルシューティング**まで落とし込んで提示してほしい。

---

## 1. 現状の環境

### 1-1. 環境情報

- **IDE**: Google Antigravity IDE（最新版）
- **OS**: Windows 11
- **Python**: 3.13（Microsoft Store版）
- **MCP SDK**: `pip install mcp` でインストール済み

### 1-2. 作成したMCPサーバー

- **ファイル**: `M:/Hegemonikon/mcp/gnosis_mcp_server.py`
- **機能**: 知識ベース検索（search, stats）
- **プロトコル**: stdio（標準入出力）

### 1-3. 設定ファイルの配置

2箇所に `mcp_config.json` を配置済み:
1. `C:\Users\makar\.gemini\antigravity\mcp_config.json`
2. `C:\Users\makar\AppData\Roaming\Antigravity\mcp_config.json`

内容:
```json
{
    "mcpServers": {
        "gnosis": {
            "command": "python",
            "args": ["M:/Hegemonikon/mcp/gnosis_mcp_server.py"]
        }
    }
}
```

---

## 2. テスト結果（重要）

| テスト | 結果 | 詳細 |
|--------|------|------|
| **CLI直接実行** | ✅ 成功 | `python -m mekhane.anamnesis.cli search "transformer"` で結果取得 |
| **MCPサーバー起動** | ✅ 成功 | stderr にログ出力、初期化完了 |
| **手動JSON-RPC疎通** | ✅ 成功 | `initialize`, `tools/list`, `tools/call` すべて応答あり |
| **Antigravity IDEからの呼び出し** | ❌ ハング | `@mcp:gnosis` または `mcp_gnosis_search` ツールでハング |

---

## 3. 調査すべき論点

### A. mcp_config.json の正しい場所

- Antigravity IDE が参照する mcp_config.json の正確なパスは？
- `.gemini/antigravity/` と `%APPDATA%/Antigravity/` のどちらが正しいか？
- 設定変更後の反映方法（IDE再起動で十分か？）

### B. カスタム MCP サーバーの登録方法

- GUI経由での登録手順（パプ君のレポートでは「MCP Servers」パネルがあるとのこと）
- JSON設定での登録手順
- command/args の正しいフォーマット（パス形式、引用符など）

### C. ハングの既知問題

- Windows環境でのstdio問題（ProactorEventLoop vs SelectorEventLoop）
- Python 3.13 との互換性問題
- Antigravity IDE の MCP クライアント実装の既知バグ

### D. デバッグ方法

- Antigravity IDE の MCP ログの確認方法
- MCP 接続のタイムアウト設定
- 代替の接続方式（stdio以外）

---

## 4. 成果物（この構成で必ず提出）

1. **結論サマリー**（問題の原因と解決策）
2. **正しい設定手順**（ステップバイステップ）
3. **トラブルシューティングガイド**
4. **既知の制限事項**
5. **根拠リンク**（必須）:
   - 公式ドキュメント
   - GitHub Issues / Discussions
   - ユーザーフォーラム投稿

---

## 5. 調査ルール

- **新情報優先**: 2025年10月〜2026年1月の情報を優先
- **事実/推測分離**: 必ず明確に分離
- **根拠必須**: 公式ソースを優先

---

## 6. 与件

- **目的**: Antigravity IDE でカスタム MCP サーバー（Gnōsis）を使えるようにする
- **前提条件**: MCPサーバー自体は正常動作、IDEとの接続でハング
- **優先する評価軸**: 実装可能性 > 信頼性

---

*Generated by /ask workflow | 2026-01-24*
