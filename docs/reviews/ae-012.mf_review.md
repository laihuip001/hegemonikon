# 視覚リズムの指揮者 レビュー

## 対象ファイル
`mekhane/anamnesis/gnosis_chat.py`

## 判定
発言（要改善）

## 発見事項
- **密度偏り**: Low (一部のメソッドでややコメント密度が低いが、許容範囲)
- **波形乱れ**: Low (全体的に深浅の変化は適切だが、`interactive`内の`if`分岐がやや平坦な波形を生んでいる)
- **サイズ不均一**: Medium (`interactive`メソッドが約70行と突出しており、他メソッド（20-30行）とのバランスが崩れている)
- **視覚的なリズム**: `KnowledgeIndexer.discover_knowledge_files` (L117-178) において、類似した構造（`if path.exists(): for ...`）が6回繰り返されており、視覚的なリズムが停滞している（スタッター）。これをヘルパー関数に抽出することで、リズムを整え、意図（知識ソースの定義）を明確にできる。

## 修正提案
`discover_knowledge_files` のリファクタリング案:

```python
    @staticmethod
    def _collect_files(base_path: Path, pattern: str, source_type: str, title_fn=None) -> list[dict]:
        """指定パスからファイルを収集するヘルパー."""
        if not base_path.exists():
            return []
        files = []
        for f in sorted(base_path.glob(pattern)):
            title = title_fn(f) if title_fn else f.stem.replace("_", " ").title()
            files.append({
                "path": f,
                "source_type": source_type,
                "title": title,
            })
        return files

    @staticmethod
    def discover_knowledge_files() -> list[dict]:
        """全知識ソースからファイルを発見."""
        files = []

        # Handoff & Session logs
        files.extend(KnowledgeIndexer._collect_files(
            MNEME_SESSIONS, "handoff_*.md", "handoff"
        ))
        files.extend(KnowledgeIndexer._collect_files(
            MNEME_SESSIONS, "2026-*_conv_*.md", "session",
            lambda f: f.stem.split("_", 3)[-1].replace("_", " ") if "_" in f.stem else f.stem
        ))
        # ... (以下同様)
        return files
```

## 重大度
Low
