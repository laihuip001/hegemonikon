# 視覚リズムの指揮者 レビュー

## 対象ファイル
`mekhane/pks/push_dialog.py`

## 判定
発言（要改善）

## 発見事項
- インデントの波形の乱れ (Low): `related` メソッドのネストが深く（最大24スペース）、他のメソッド（最大12スペース）と比較して視覚的なリズムを乱している。

## 修正案
`try` ブロックのスコープを縮小し、ガード節 (`continue`) を使用してネストを浅くする提案:

```python
    def related(self, nugget: KnowledgeNugget, k: int = 5) -> list[KnowledgeNugget]:
        """この nugget に関連する知識を GnosisIndex で検索"""
        try:
            from mekhane.anamnesis.index import GnosisIndex

            index = GnosisIndex()
            query = f"{nugget.title} {nugget.abstract[:100] if nugget.abstract else ''}"
            results = index.search(query, k=k + 1)
        except Exception as e:
            print(f"[PushDialog] Related search error: {e}")
            return []

        # 自分自身を除外
        nuggets = []
        for r in results:
            title = r.get("title", "")
            if title == nugget.title:
                continue

            nuggets.append(
                KnowledgeNugget(
                    title=title,
                    source=r.get("source", "unknown"),
                    relevance_score=1.0 - r.get("_distance", 0.5),
                    abstract=r.get("abstract", ""),
                    push_reason="関連知識",
                )
            )
        return nuggets[:k]
```

## 重大度
Low
