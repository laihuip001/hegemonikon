# 視覚リズムの指揮者 レビュー

## 対象ファイル
`mekhane/api/server.py`

## 判定
発言（要改善）

## 発見事項
- **関数サイズの不均一 (Medium)**: `_register_routers` (約66行) が他の関数 (`create_app` 約25行, `_cleanup_stale_socket` 約15行) に比べて突出して長く、視覚的なバランスを欠いています。
- **インデントの波形の乱れ (Low)**: `_register_routers` 内で `try-except` ブロックが6回連続して繰り返されており、視覚的なリズムが単調（スタッカート）になっています。

## 重大度
Medium

## 修正提案
`_register_routers` 内の繰り返しロジックをデータ駆動型のアプローチに変更することで、視覚的なノイズを低減し、リズムを回復させることを提案します。

```python
# 修正案のイメージ (構成データとロジックの分離)
def _register_routers(app: FastAPI) -> None:
    # ... 固定ルーターの登録 ...

    # 遅延ロードが必要なルーター群
    lazy_routers = [
        ("mekhane.api.routes.gnosis", "Gnōsis"),
        ("mekhane.api.routes.ccl", "CCL"),
        ("mekhane.api.routes.sympatheia", "Sympatheia"),
        ("mekhane.api.routes.pks", "PKS"),
        ("mekhane.api.routes.gnosis_narrator", "Gnōsis Narrator"),
        ("mekhane.api.routes.link_graph", "Link Graph"),
    ]

    for module_path, name in lazy_routers:
        _safe_register(app, module_path, name)

def _safe_register(app: FastAPI, module_path: str, name: str) -> None:
    try:
        module = importlib.import_module(module_path)
        app.include_router(module.router, prefix=API_PREFIX)
        logger.info(f"{name} router registered")
    except Exception as exc:
        logger.warning(f"{name} router skipped: {exc}")
```
