# コード/コメント矛盾検出者 レビュー

## 対象ファイル
`mekhane/pks/push_dialog.py`

## 判定
発言（要改善）

## 発見事項
- **[High] Args不一致 (`PushDialog.why`)**: docstring に `Args` セクションがなく、引数 `nugget` の説明が欠落しています。
- **[High] Returns不一致 (`PushDialog.why`)**: docstring に `Returns` セクションがなく、戻り値 `str` の説明が欠落しています。
- **[High] Args不一致 (`PushDialog.deeper`)**: docstring に `Args` セクションがなく、引数 `nugget`, `question` の説明が欠落しています。
- **[High] Returns不一致 (`PushDialog.deeper`)**: docstring に `Returns` セクションがなく、戻り値 `str` の説明が欠落しています。
- **[High] Args不一致 (`PushDialog.related`)**: docstring に `Args` セクションがなく、引数 `nugget`, `k` の説明が欠落しています。
- **[High] Returns不一致 (`PushDialog.related`)**: docstring に `Returns` セクションがなく、戻り値 `list[KnowledgeNugget]` の説明が欠落しています。
- **[High] Args不一致 (`PushDialog._why_template`)**: docstring に `Args` セクションがなく、引数 `nugget` の説明が欠落しています。
- **[High] Returns不一致 (`PushDialog._why_template`)**: docstring に `Returns` セクションがなく、戻り値 `str` の説明が欠落しています。
- **[Low] 処理乖離 (`PushDialog` class docstring)**: Usage 例に `related()` メソッドの使用例が含まれていません。

## 重大度
High

## 修正提案

以下のように docstring を修正し、`Args` と `Returns` を明記することを提案します。

```python
class PushDialog:
    """Push された知識への対話インターフェース

    Creator が push された nugget に対して:
    - why():     なぜ推薦されたか
    - deeper():  追加質問 (LLM 生成)
    - related(): 関連知識の検索

    Usage:
        dialog = PushDialog()
        print(dialog.why(nugget))
        print(dialog.deeper(nugget, "実装の困難さは？"))
        related_nuggets = dialog.related(nugget)
    """

    # ...

    def why(self, nugget: KnowledgeNugget) -> str:
        """なぜこの知識が push されたか説明

        LLM 可用時: Gemini で自然言語説明を生成
        LLM 不可時: メタデータベースの定型説明

        Args:
            nugget: 対象の知識ナゲット

        Returns:
            推薦理由の説明テキスト
        """
        # ...

    def _why_template(self, nugget: KnowledgeNugget) -> str:
        """テンプレートベースの推薦理由

        Args:
            nugget: 対象の知識ナゲット

        Returns:
            テンプレートに基づく推薦理由テキスト
        """
        # ...

    def deeper(self, nugget: KnowledgeNugget, question: str) -> str:
        """nugget について追加質問

        LLM 可用時: Gemini で回答生成
        LLM 不可時: 定型メッセージ

        Args:
            nugget: 対象の知識ナゲット
            question: ユーザーからの追加質問

        Returns:
            LLM からの回答、または利用不可メッセージ
        """
        # ...

    def related(self, nugget: KnowledgeNugget, k: int = 5) -> list[KnowledgeNugget]:
        """この nugget に関連する知識を GnosisIndex で検索

        Args:
            nugget: 起点となる知識ナゲット
            k: 取得する関連知識の最大数 (デフォルト: 5)

        Returns:
            関連度順にソートされた知識ナゲットのリスト（自身は除外）
        """
        # ...
```
