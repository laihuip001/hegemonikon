# コード/コメント矛盾検出者 レビュー

## 対象ファイル
`mekhane/dendron/checker.py`

## 判定
発言（要改善）

## 発見事項
- **(処理乖離: Medium)** `_check_variables_from_tree`: コメントは「1文字変数を検出する」としているが、実装は `ast.Assign` の単純な代入 (`target` が `ast.Name` の場合) のみを対象としている。`ast.AnnAssign` (型ヒント付き代入: `x: int = 1`) や、`ast.Tuple`/`ast.List` へのアンパック代入 (`x, y = 1, 2`) を検出できていない。
- **(コメントの曖昧さ: Low)** `check_variables_in_file`: docstringの「public 関数の型ヒント有無と 1文字変数を検出する」という記述は、1文字変数の検出も public 関数に限定されるような誤解を招くが、実装はファイル全体（全スコープ）を対象としている。
- **(説明と挙動の乖離: Low)** `_is_code_comment`: docstring に「docstring 内の PROOF を無視するため」とあるが、実装の `line.strip().startswith("#")` だけでは、docstring 内に含まれる `#` で始まる行を区別できず、意図した挙動（docstring 内の無視）を完全には実現できていない。

## 重大度
Medium

## 修正提案
`_check_variables_from_tree` の実装を強化し、コメント（「1文字変数を検出する」）と一致させる修正を提案する。

```python
<<<<<<< SEARCH
            # --- 1文字変数検出 ---
            if isinstance(node, ast.Assign):
                for target in node.targets:
                    if isinstance(target, ast.Name) and len(target.id) == 1:
                        if target.id not in _LOOP_VAR_NAMES:
                            results.append(VariableProof(
                                name=target.id, path=path,
                                line_number=target.lineno, status=ProofStatus.WEAK,
                                check_type="short_name",
                                reason=f"1文字変数 '{target.id}' は可読性が低い",
                            ))
=======
            # --- 1文字変数検出 ---
            # ast.Assign (x = 1), ast.AnnAssign (x: int = 1) をチェック
            targets = []
            if isinstance(node, ast.Assign):
                targets.extend(node.targets)
            elif isinstance(node, ast.AnnAssign):
                targets.append(node.target)

            for target in targets:
                # ast.Name (単純代入)
                if isinstance(target, ast.Name):
                    if len(target.id) == 1 and target.id not in _LOOP_VAR_NAMES:
                        results.append(VariableProof(
                            name=target.id, path=path,
                            line_number=target.lineno, status=ProofStatus.WEAK,
                            check_type="short_name",
                            reason=f"1文字変数 '{target.id}' は可読性が低い",
                        ))
                # アンパック代入 (x, y = 1, 2)
                elif isinstance(target, (ast.Tuple, ast.List)):
                    for elt in target.elts:
                        if isinstance(elt, ast.Name):
                            if len(elt.id) == 1 and elt.id not in _LOOP_VAR_NAMES:
                                results.append(VariableProof(
                                    name=elt.id, path=path,
                                    line_number=elt.lineno, status=ProofStatus.WEAK,
                                    check_type="short_name",
                                    reason=f"1文字変数 '{elt.id}' は可読性が低い",
                                ))
>>>>>>> REPLACE
```
