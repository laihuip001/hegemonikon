# 競合状態検出者 レビュー

## 対象ファイル
`mekhane/symploke/jules_client.py`

## 発見事項
- **セッションIDの消失（ゾンビセッション化）**: `batch_execute` 内の `bounded_execute` メソッドにおいて、`create_and_poll` が `poll_session` フェーズでタイムアウトやエラーを起こした場合、例外処理ブロックで正規の `session.id` が失われ、代わりに `error-{uuid}` が割り当てられる。これにより、呼び出し元はサーバー上で実行中または残留している可能性のあるセッションを追跡・キャンセルできなくなる。
- **リトライの同期（Thundering Herd）**: `with_retry` デコレータの実装にジッター（ランダムな待機時間の揺らぎ）が含まれていない。並列実行中（`MAX_CONCURRENT=60`）にレート制限（429）が発生した場合、複数のタスクが同時にバックオフし、同時に再試行を行うため、再び競合状態を引き起こすリスクが高い。
- **構造化並行処理の欠如**: `asyncio.gather` が使用されており、プロジェクトが推奨する `asyncio.TaskGroup`（Python 3.11+）による構造化並行処理が行われていない。これにより、一部のタスクが失敗した場合のキャンセル伝播や例外ハンドリングが不透明になりやすい。

## 重大度
- High

## 沈黙判定
- 発言（要改善）
