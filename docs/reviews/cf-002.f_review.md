# 暗黙契約違反検出者 レビュー

## 対象ファイル
`hermeneus/src/dispatch.py`

## 判定
発言（要改善）

## 発見事項
- **Critical**: `extract_workflows` 関数が `ForLoop`, `IfCondition`, `WhileLoop`, `Lambda` 等の新しい AST ノードに対応しておらず、内部のワークフロー ID が抽出されない。これは `pipeline.py` 等の利用側でワークフロー特定に失敗する原因となる。
- **High**: `format_ast_tree` 関数が `ForLoop`, `IfCondition`, `WhileLoop`, `Lambda` 等の新しい AST ノードに対応しておらず、汎用的な `type(node).__name__` 表示となり、構造が正しく可視化されない。
- **High**: `OpType` Enum に追加された `DESCEND`, `FUSE`, `OSC`, `SEQ`, `COLIMIT`, `CONVERGE`, `PIPE`, `PARALLEL` 等の値が `format_ast_tree` 内の `ops_map` に反映されていない。
- **Medium**: `Workflow` ノードの `modifiers`, `mode`, `selector` フィールドが `format_ast_tree` で表示されていない。
- **Medium**: `Fusion` ノードの `meta_display` フィールドが `format_ast_tree` で表示されていない。
- **Medium**: `ConvergenceLoop` ノードの `max_iterations` フィールドが `format_ast_tree` で表示されていない。
- **Medium**: `ColimitExpansion` ノードの `operators` フィールドが `format_ast_tree` で表示されていない。

### 修正提案
`extract_workflows` と `format_ast_tree` に以下の対応を追加すべきである：
1. `ForLoop`: `iterations` と `body` を再帰的に処理。
2. `IfCondition`: `condition` と `then_branch`, `else_branch` を再帰的に処理。
3. `WhileLoop`: `condition` と `body` を再帰的に処理。
4. `Lambda`: `body` を再帰的に処理。
5. `Workflow`: `modifiers`, `mode`, `selector` を表示に含める。
6. `OpType`: `ops_map` を全 Enum 値に対応させる。

## 重大度
Critical
