# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/pks/push_dialog.py`

## 判定
発言（要改善）

## 発見事項
- **[High] KnowledgeNugget フィールド未対応 (`related` メソッド)**
  - `KnowledgeNugget` の定義には `url`, `authors` フィールドが存在し、`GnosisIndex.search` の結果にも含まれているが、`PushDialog.related` 内でのインスタンス化時にこれらが無視されている。
  - 修正案: `GnosisIndex` の戻り値から `url`, `authors` を取得し、`KnowledgeNugget` コンストラクタに渡す。

- **[High] KnowledgeNugget フィールド未対応 (`_why_template` メソッド)**
  - `KnowledgeNugget` (v2) に追加された `serendipity_score` フィールドが `_why_template` で表示されないため、推薦理由の説明が不完全になる可能性がある。
  - 修正案: `serendipity_score > 0` の場合にその旨を表示するロジックを追加。

- **[Medium] 定数/ロジックの不整合 (`relevance_score` 計算)**
  - `PushDialog.related` では `1.0 - distance` でスコアを算出しているが、`pks_engine.RelevanceDetector` では `1.0 - (distance / 2.0)` (cosine distance 対応) となっている。ロジックが乖離しており、スコアの尺度が不統一。
  - 修正案: `pks_engine` と同じ計算ロジック (`distance / 2.0`) を適用するか、スコア計算ロジックを共通化する。

## 重大度
High
