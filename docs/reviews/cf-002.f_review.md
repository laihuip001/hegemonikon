# æš—é»™å¥‘ç´„é•åæ¤œå‡ºè€… ãƒ¬ãƒ“ãƒ¥ãƒ¼

## å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
`mekhane/pks/pks_cli.py`

## åˆ¤å®š
ç™ºè¨€ï¼ˆè¦æ”¹å–„ï¼‰

## ç™ºè¦‹äº‹é …
- **ã‚«ãƒ—ã‚»ãƒ«åŒ–é•å (High)**: `cmd_feedback` é–¢æ•°å†…ã§ `engine._feedback.get_stats()` ã‚’å‘¼ã³å‡ºã—ã¦ãŠã‚Šã€`PKSEngine` ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå±æ€§ `_feedback` ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ `PKSEngine` ã®å†…éƒ¨å®Ÿè£…ã¸ã®ä¾å­˜ã§ã‚ã‚Šã€å°†æ¥çš„ãªå®Ÿè£…å¤‰æ›´ã§ç ´æã™ã‚‹ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚
- **å¼•æ•°æ¤œè¨¼ä¸è¶³ (Medium)**: `pks feedback` ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã€`--stats` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒãªã„å ´åˆã§ã‚‚ `args.title` ã‚„ `args.reaction` ãŒå¿…é ˆã¨ã—ã¦æ‰±ã‚ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã“ã‚Œã‚‰ãŒæŒ‡å®šã•ã‚Œãªã„å ´åˆã€`None` ãŒ `engine.record_feedback` ã«æ¸¡ã•ã‚Œã€å‹ãƒ’ãƒ³ãƒˆ (`str`) ã¨ä¸æ•´åˆãŒç”Ÿã˜ã¾ã™ã€‚

## é‡å¤§åº¦
High

## ä¿®æ­£ã‚³ãƒ¼ãƒ‰ææ¡ˆ

### `cmd_feedback` ã®ä¿®æ­£

```python
# PURPOSE: `pks feedback` â€” ãƒ—ãƒƒã‚·ãƒ¥åå¿œã‚’è¨˜éŒ²
def cmd_feedback(args: argparse.Namespace) -> None:
    """ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸçŸ¥è­˜ã¸ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨˜éŒ²"""
    from mekhane.pks.feedback import FeedbackCollector

    if args.stats:
        # çµ±è¨ˆè¡¨ç¤º: Engine ã§ã¯ãªã Collector ã‚’ç›´æ¥ä½¿ç”¨ã—ã¦ã‚«ãƒ—ã‚»ãƒ«åŒ–é•åã‚’å›é¿
        collector = FeedbackCollector()
        stats = collector.get_stats()

        if not stats:
            print("ğŸ“­ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚")
            return

        print("## ğŸ“Š PKS Feedback Stats\n")
        print("| Series | Count | Avg Score | Threshold Adj |")
        print("|:------:|------:|----------:|--------------:|")
        for series, s in sorted(stats.items()):
            adj = s['threshold_adjustment']
            sign = "+" if adj >= 0 else ""
            print(f"| {series} | {s['count']} | {s['avg_score']:.2f} | {sign}{adj:.3f} |")
        return

    # å¼•æ•°æ¤œè¨¼: è¨˜éŒ²æ™‚ã¯å¿…é ˆå¼•æ•°ã‚’ãƒã‚§ãƒƒã‚¯
    if not args.title or not args.reaction:
        print("ã‚¨ãƒ©ãƒ¼: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¨˜éŒ²ã«ã¯ --title (-t) ã¨ --reaction (-r) ãŒå¿…è¦ã§ã™ã€‚")
        return

    # Engine ã®åˆæœŸåŒ–ã¯è¨˜éŒ²æ™‚ã®ã¿è¡Œã†
    from mekhane.pks.pks_engine import PKSEngine
    engine = PKSEngine(
        enable_questions=False,
        enable_serendipity=False,
        enable_feedback=True,
    )

    # åå¿œè¨˜éŒ²
    engine.record_feedback(
        nugget_title=args.title,
        reaction=args.reaction,
        series=args.series or "",
    )
    print(f"âœ… Feedback recorded: '{args.title}' â†’ {args.reaction}")
```
