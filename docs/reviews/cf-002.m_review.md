# 暗黙契約違反検出者 レビュー

## 対象ファイル
`hermeneus/src/dispatch.py`

## 判定
発言（要改善）

## 発見事項
- **(Critical)** `extract_workflows` 関数は AST を再帰的に走査し全てのワークフロー ID を返すべき暗黙の契約があるが、`ForLoop`, `IfCondition`, `WhileLoop`, `Lambda` ノードの分岐処理が欠落している。これにより、制御構文内部のワークフローが検出されず、空リストや不完全なリストが返却される。
- **(High)** `format_ast_tree` 関数は AST の構造化表示を行う契約があるが、`ForLoop`, `IfCondition`, `WhileLoop`, `Lambda`, `MacroRef` ノードの専用フォーマット処理が欠落しており、汎用 `__repr__` にフォールバックしている。これにより可読性が損なわれている。
- **(High)** `OpType` Enum のマッピング (`ops_map`) において、`OpType.DESCEND` (√) 等の新しい演算子が欠落している。これにより、特定の演算子を持つワークフローが不完全に表示される可能性がある。
- **(Medium)** モジュールレベルでの `sys.path.insert` 副作用が存在する。これはライブラリとしてインポートされた際（例: `mekhane.fep.pipeline`）、利用側の環境（`sys.path`）を意図せず変更する契約違反である。

## 重大度
Critical
