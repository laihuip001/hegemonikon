# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/pks/feedback.py`

## 判定
発言（要改善）

## 発見事項
- **暗黙的Enumの不整合リスク (High)**: `PushFeedback` クラスの `reaction` フィールドは文字列型だが、`REACTION_WEIGHTS` のキーとして定義された特定の値 ("used", "dismissed", "deepened", "ignored") しか意味を持たない。コード上で Enum として定義されておらず、不正な文字列（例: "liked"）が渡された場合にエラーにならず、重み `0.0` として静かに処理される（`REACTION_WEIGHTS.get(..., 0.0)`）。これは呼び出し側との暗黙の契約になっており、将来的な値の追加時に同期漏れやバグの原因となる。
- **外部環境への暗黙の依存 (Medium)**: `DEFAULT_PATH` が `Path.home() / "oikos/mneme/.hegemonikon/pks/feedback.json"` とハードコードされており、実行環境（ユーザーのホームディレクトリ構造）に強い仮定を置いている。コンテナ環境やCI環境など、ホームディレクトリが想定と異なる場合に動作が保証されない。環境変数や設定ファイルによる注入が望ましい。
- **データの暗黙契約 (Medium)**: `series` フィールドが検証なしの文字列型である。システム全体で定義されているはずの Series (O/S/H/P/K/A 等) 以外の値も許容してしまうため、タイポや仕様変更（例: シリーズ名の変更）があった場合、データが分断され、`adjust_threshold` が正しく機能しなくなるリスクがある。

## 重大度
High
