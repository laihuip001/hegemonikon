# 暗黙契約違反検出者 レビュー

## 対象ファイル
`hermeneus/src/dispatch.py`

## 判定
発言（要改善）

## 発見事項
- (Critical) `extract_workflows` 関数が `hermeneus/src/ast.py` および `hermeneus/src/parser.py` で定義/生成される CPL v2.0 制御構造 (`ForLoop`, `IfCondition`, `WhileLoop`, `Lambda`) を網羅しておらず、これらの構造内部に含まれるワークフロー ID が抽出漏れを起こす。
- (High) `format_ast_tree` 関数が `ForLoop`, `IfCondition`, `WhileLoop` をインポートしているが、`isinstance` 分岐で処理しておらず、デフォルトの文字列表現 (repr) にフォールバックしている。これによりツリー構造の可視化が崩れる。また、`Lambda` ノードはインポートすらされていない。
- (Medium) `format_ast_tree` 内の `Workflow` 処理で `OpType` のマッピングがハードコードされているが、`ast.py` の `OpType` Enum 定義と同期が保証されていない（列挙値の網羅性チェックがない）。特に `DESCEND` などが欠落している。

## 重大度
Critical
