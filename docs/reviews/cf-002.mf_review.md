# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/pks/pks_cli.py`

## 判定
発言（要改善）

## 発見事項
- **プライベート属性への直接依存**: `cmd_feedback` 関数内で `engine._feedback.get_stats()` を呼び出しており、`PKSEngine` の内部実装詳細（`_feedback` 属性）に暗黙的に依存している。`PKSEngine` が内部構造を変更した場合、`AttributeError` が発生する可能性がある。 (High)
  - 修正案: `PKSEngine` に `get_feedback_stats()` などの公開メソッドを追加し、`pks_cli.py` からはそのメソッドを利用するように変更する。

- **ハードコードされた閾値への依存**: `cmd_feedback` で表示される閾値調整統計 (`threshold_adjustment`) は、`FeedbackCollector.get_stats()` が内部で固定値 `0.65` を基準に算出している値である。CLI 引数 (`--threshold`) で異なる閾値が指定された場合、エンジンが実際に使用する閾値とは異なる基準での調整値が表示され、誤解を招く。 (Medium)
  - 修正案: `FeedbackCollector.get_stats()` にベース閾値を引数として渡せるようにし、`PKSEngine` 経由で現在の設定値を反映させる。

## 重大度
High
