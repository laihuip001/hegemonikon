# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/fep/tests/test_attractor_advisor.py`

## 判定
発言（要改善）

## 発見事項
- **(High)** `Recommendation` データクラスにフィールド `cognitive_types`, `boundary_crossings`, `pw_suggestion`, `knowledge_context` が追加されているが、テスト `test_recommend_clear` 等で検証されておらず、利用側（テスト）がスキーマ変更に対応していない。
- **(Medium)** `SeriesAttractor` の内部ロジック変更（embedding 圧縮により similarity が 0.35-0.55 の範囲に収まる仕様）に対し、テスト `test_clear_convergence` が旧仕様の `top_similarity > 0.6` をアサートしており、定数/仕様の変更が参照側に反映されていない。
- **(Medium)** `AttractorAdvisor.format_for_llm` の出力形式に `[CognitiveType]`, `[Boundary]`, `[Knowledge]` 行が追加されたが、テスト `test_format_for_llm_clear` は `[Attractor:]` のみを検証しており、拡張された契約内容をカバーしていない。
- **(Low)** `test_positive_morphisms` において `AttractorResult` を `workflows` 引数なしでインスタンス化しており、プロダクションコード（常に `workflows` を設定）と異なる「空の」オブジェクト状態を許容している（デフォルト引数に依存した不完全なインスタンス化）。

## 重大度
High
