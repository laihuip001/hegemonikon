# ネスト深度警報者 レビュー

## 対象ファイル
`mekhane/pks/pks_cli.py`

## 判定
発言（要改善）

## 発見事項
- `cmd_suggest` 関数内のループにおいて、`for` -> `if` -> `for` の3段ネストが存在します (Medium)
- `cmd_feedback` 関数内の分岐において、`if` -> `if` -> `for` の3段ネストが存在します (Medium)

## 修正提案

### `cmd_suggest` の平坦化 (ガード節の使用)

```python
<<<<<<< SEARCH
    for i, nugget in enumerate(top_nuggets, 1):
        print(f"\n### [{i}] {nugget.title}")
        print(f"_関連度: {nugget.relevance_score:.2f} | ソース: {nugget.source}_")
        if nugget.suggested_questions:
            print("\n**💡 聞くべき質問:**")
            for q in nugget.suggested_questions:
                print(f"  - {q}")
=======
    for i, nugget in enumerate(top_nuggets, 1):
        print(f"\n### [{i}] {nugget.title}")
        print(f"_関連度: {nugget.relevance_score:.2f} | ソース: {nugget.source}_")

        if not nugget.suggested_questions:
            continue

        print("\n**💡 聞くべき質問:**")
        for q in nugget.suggested_questions:
            print(f"  - {q}")
>>>>>>> REPLACE
```

### `cmd_feedback` の平坦化

```python
<<<<<<< SEARCH
    if args.stats:
        # 統計表示
        if engine._feedback:
            stats = engine._feedback.get_stats()
            if not stats:
                print("📭 フィードバック履歴がありません。")
                return
            print("## 📊 PKS Feedback Stats\n")
            print("| Series | Count | Avg Score | Threshold Adj |")
            print("|:------:|------:|----------:|--------------:|")
            for series, s in sorted(stats.items()):
                adj = s['threshold_adjustment']
                sign = "+" if adj >= 0 else ""
                print(f"| {series} | {s['count']} | {s['avg_score']:.2f} | {sign}{adj:.3f} |")
        return
=======
    if args.stats:
        # 統計表示
        if not engine._feedback:
            return

        stats = engine._feedback.get_stats()
        if not stats:
            print("📭 フィードバック履歴がありません。")
            return

        print("## 📊 PKS Feedback Stats\n")
        print("| Series | Count | Avg Score | Threshold Adj |")
        print("|:------:|------:|----------:|--------------:|")
        for series, s in sorted(stats.items()):
            adj = s['threshold_adjustment']
            sign = "+" if adj >= 0 else ""
            print(f"| {series} | {s['count']} | {s['avg_score']:.2f} | {sign}{adj:.3f} |")
        return
>>>>>>> REPLACE
```

## 重大度
Medium
