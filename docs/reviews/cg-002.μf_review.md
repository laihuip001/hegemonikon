# 認知チャンク分析者 レビュー

## 対象ファイル
`mekhane/anamnesis/export_chats.py`

## 判定
発言（要改善）

## 発見事項

### 1. 行長超過 (Line 77)
**重大度**: Low
**内容**: 1行が100文字を超えている (102文字)
```python
    def __init__(self, output_dir: Path = DEFAULT_OUTPUT_DIR, limit: int = None, cdp_port: int = CDP_PORT):
```
**提案**: 引数を改行して分割する。
```python
    def __init__(
        self,
        output_dir: Path = DEFAULT_OUTPUT_DIR,
        limit: int = None,
        cdp_port: int = CDP_PORT,
    ):
```

### 2. 演算子過多 (Line 168)
**重大度**: Medium
**内容**: 1行に5つの演算/呼び出し (`strip`, `split`, `index`, `strip`, `slice`) が連鎖している。
```python
                    title = title.strip().split("\n")[0].strip()[:100]
```
**提案**: 処理を分割する。
```python
                    title = title.strip()
                    title = title.split("\n")[0]
                    title = title.strip()[:100]
```

### 3. 演算子過多 (Line 607)
**重大度**: Medium
**内容**: リスト内包表記の条件式に5つの演算 (`attr`, `call`, `subscript`, `call`, `in`) が含まれている。
```python
                conversations = [
                    c
                    for c in conversations
                    if self.filter_keyword.lower() in c["title"].lower()
                ]
```
**提案**: 条件式をメソッド化するか、事前に変数を計算する。
```python
                keyword = self.filter_keyword.lower()
                conversations = [
                    c for c in conversations
                    if keyword in c["title"].lower()
                ]
```

### 4. 認知負荷が高いロジック (Line 756)
**重大度**: Medium
**内容**: ジェネレータ式の中に三項演算子と比較演算が含まれており、認知負荷が高い。
```python
        safe_title = "".join(c if ord(c) < 128 else "_" for c in safe_title)
```
**提案**: 補助関数を使用するか、ループを展開する。
```python
        def _sanitize_char(c):
            return c if ord(c) < 128 else "_"

        safe_title = "".join(_sanitize_char(c) for c in safe_title)
```

## 重大度
Medium
