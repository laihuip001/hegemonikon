# 認知チャンク分析者 レビュー

## 対象ファイル
`mekhane/mcp/sympatheia_mcp_server.py`

## 判定
発言（要改善）

## 発見事項

### 1. f-string 内での過度な辞書アクセスとメソッド呼び出し (Line 238)
**Severity**: Medium (演算子過多: 6+)

**現状**:
```python
f"- **File Monitor**: {d['fileMon'].get('scans', 0)} scans, {d['fileMon'].get('changes', 0)} changes",
```

**提案**:
```python
fm = d['fileMon']
scans = fm.get('scans', 0)
changes = fm.get('changes', 0)
f"- **File Monitor**: {scans} scans, {changes} changes",
```

### 2. f-string 内での過度な辞書アクセスとメソッド呼び出し (Line 239)
**Severity**: Medium (演算子過多: 9+)

**現状**:
```python
f"- **Git**: branch={d['git'].get('branch')}, dirty={d['git'].get('dirty')}, {d['git'].get('changes', 0)} changes",
```

**提案**:
```python
git = d['git']
branch = git.get('branch')
dirty = git.get('dirty')
changes = git.get('changes', 0)
f"- **Git**: branch={branch}, dirty={dirty}, {changes} changes",
```

### 3. f-string 内での過度な辞書アクセスとメソッド呼び出し (Line 240)
**Severity**: Medium (演算子過多: 9+)

**現状**:
```python
f"- **WBC**: {d['wbc'].get('weekAlerts', 0)} alerts ({d['wbc'].get('criticals', 0)} critical, {d['wbc'].get('highs', 0)} high)",
```

**提案**:
```python
wbc = d['wbc']
alerts = wbc.get('weekAlerts', 0)
criticals = wbc.get('criticals', 0)
highs = wbc.get('highs', 0)
f"- **WBC**: {alerts} alerts ({criticals} critical, {highs} high)",
```

### 4. f-string 内での過度な辞書アクセスとメソッド呼び出し (Line 241)
**Severity**: Medium (演算子過多: 6+)

**現状**:
```python
f"- **Health**: avg={d['health'].get('avg', 0)}, {d['health'].get('samples', 0)} samples",
```

**提案**:
```python
health = d['health']
avg = health.get('avg', 0)
samples = health.get('samples', 0)
f"- **Health**: avg={avg}, {samples} samples",
```

### 5. ステータス構築時の過度な演算子 (Line 275)
**Severity**: Medium (演算子過多: 6+)

**現状**:
```python
status["heartbeat"] = f"beats={hb.get('beats', '?')}, healthy={hb.get('healthy', '?')}"
```

**提案**:
```python
beats = hb.get('beats', '?')
healthy = hb.get('healthy', '?')
status["heartbeat"] = f"beats={beats}, healthy={healthy}"
```

### 6. ステータス構築時の過度な演算子 (Line 280)
**Severity**: Medium (演算子過多: 7+)

**現状**:
```python
status["wbc"] = f"totalAlerts={wbc.get('totalAlerts', 0)}, active={len(wbc.get('alerts', []))}"
```

**提案**:
```python
total_alerts = wbc.get('totalAlerts', 0)
active_alerts = len(wbc.get('alerts', []))
status["wbc"] = f"totalAlerts={total_alerts}, active={active_alerts}"
```

### 7. ステータス構築時の過度な演算子 (Line 284)
**Severity**: Medium (演算子過多: 6+)

**現状**:
```python
status["git"] = f"dirty={git.get('dirty', '?')}, branch={git.get('branch', '?')}"
```

**提案**:
```python
is_dirty = git.get('dirty', '?')
branch = git.get('branch', '?')
status["git"] = f"dirty={is_dirty}, branch={branch}"
```

### 8. ステータス構築時の過度な演算子 (Line 288)
**Severity**: Medium (演算子過多: 6+)

**現状**:
```python
status["fileMon"] = f"scans={fm.get('scanCount', 0)}, changes={fm.get('changeCount', 0)}"
```

**提案**:
```python
scans = fm.get('scanCount', 0)
changes = fm.get('changeCount', 0)
status["fileMon"] = f"scans={scans}, changes={changes}"
```

### 9. ステータス構築時の過度な演算子 (Line 297)
**Severity**: Medium (演算子過多: 6+)

**現状**:
```python
status["config"] = f"health_high={th.get('health_high')}, stale={th.get('stale_minutes')}min"
```

**提案**:
```python
h_high = th.get('health_high')
stale = th.get('stale_minutes')
status["config"] = f"health_high={h_high}, stale={stale}min"
```

## 重大度
Medium
