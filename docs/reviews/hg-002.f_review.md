# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/fep/tests/test_attractor_advisor.py`

## 判定
発言（要改善）

## 発見事項
- **副作用非明示 (High)**: `test_negative_confidence_modifier` および `test_positive_morphisms` メソッド内で `from mekhane.fep.attractor import _build_diagnosis, AttractorResult` というローカルインポートが行われています。これは関数の依存関係を隠蔽し、モジュールロードの副作用が予測困難なタイミングで発生することを意味します。インポートはトップレベルに移動し、明示的な依存関係として管理すべきです。
- **暗黙状態変更 (Medium)**: `advisor` フィクスチャは `AttractorAdvisor` のデフォルト初期化（閾値 0.15）を使用する一方、`attractor` フィクスチャは `SeriesAttractor` を閾値 0.10 で明示的に初期化しています。同一テストファイル内で使用される `SeriesAttractor` の振る舞いがフィクスチャによって暗黙的に異なるため、テスト結果の予測可能性を損なう可能性があります。共通の設定を持つフィクスチャを使用するか、設定の違いを明示すべきです。
- **副作用非明示 (Medium)**: テストコードが `_build_diagnosis` というプライベート関数（実装詳細）に依存してテストデータを構築しています。これは公開API (`diagnose`) の挙動とは独立した内部状態の合成であり、将来的な内部変更によってテストが破損するリスク（サプライズ）を高めます。可能であれば公開APIを通じてエッジケースを再現するか、テスト用のビルダを分離すべきです。

## 重大度
High
