# 予測誤差審問官 レビュー

## 対象ファイル
`hermeneus/src/dispatch.py`

## 判定
発言（要改善）

## 発見事項
- (High) **モジュールレベルの副作用**: `sys.path.insert` がトップレベルで実行されており、インポートするだけでグローバルな状態（検索パス）が変更される。これはライブラリとして予測不能な副作用である。
- (Medium) **戻り値の型が予測困難**: `dispatch` 関数が汎用的な `dict` を返しており、キー（`success`, `ast`, `plan_template` 等）や値の型がシグネチャから読み取れない。`Dataclass` や `TypedDict` を使用すべき。
- (Medium) **例外の隠蔽**: `dispatch` 内で `Exception` を捕捉し、辞書の `error` キーに格納している。これにより、呼び出し元は例外機構ではなく戻り値の値を検査する必要があり、エラーの種類も不明瞭になる。
- (Low) **依存関係の遅延**: `hermeneus.src.ast` や `parser` のインポートが関数内で行われており、モジュールの依存関係が静的に把握しづらい。

## 重大度
High
