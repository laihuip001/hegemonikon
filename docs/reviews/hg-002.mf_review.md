# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/mcp/sympatheia_mcp_server.py`

## 判定
発言（要改善）

## 発見事項
- **プライベートメソッドへの依存 (High)**
    - `sympatheia_status` ツール内で `sym._read_json` および `sym._load_config` を直接呼び出しています。アンダースコアで始まるメソッドは内部実装詳細であり、これに依存することはカプセル化を破壊し、将来的な変更による破損リスクを高めます。呼び出し元にとって「status取得」という操作が内部構造への深い依存を持つことは予測困難です。
    - *提案*: `mekhane/api/routes/sympatheia.py` 側に `get_system_status()` 等のパブリックメソッドを追加し、必要なデータを構造化して返すように変更してください。

- **副作用のあるゲッターとグローバル状態 (Medium)**
    - `_get_sympatheia()` は名前から単純な取得操作を想起させますが、実際にはモジュールのインポート、`sys.stdout` の一時的なジャック、グローバル変数 `_sympatheia` の書き換えという大きな副作用を伴います。
    - *提案*: サーバー起動時 (`main` または `server` 初期化時) に明示的に依存関係を解決するか、`initialize_sympatheia_module()` のような副作用を明示する名前に変更し、状態管理をクラス内に閉じ込めることを推奨します。

- **モジュールレベルでのグローバルパス変更 (Low)**
    - `sys.path.insert(0, str(_PROJECT_ROOT))` がモジュール直下で実行されています。これにより、このファイルをインポートしただけで他のインポート解決順序に影響が出る可能性があります。これは意図しない副作用です。
    - *提案*: `if __name__ == "__main__":` ブロック内、あるいは `main()` 関数内での実行に留めるか、相対インポートで解決可能な構成にすることを検討してください。

## 重大度
High
