# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/pks/feedback.py`

## 判定
発言（要改善）

## 発見事項

### 1. コンストラクタでの暗黙的なI/O (Side Effect)
- **箇所**: `FeedbackCollector.__init__` 内の `self._load()` 呼び出し
- **問題**: インスタンス化の時点でファイル読み込みが発生しており、コンストラクタの「初期化」という期待を超える副作用がある。ファイルシステムへの依存が隠蔽されている。
- **重大度**: High

### 2. エラーの黙殺 (Silent Failure)
- **箇所**: `FeedbackCollector._load` 内の `except (json.JSONDecodeError, KeyError): pass`
- **問題**: データ破損時に警告もなく空の状態にリセットされる。ユーザーはデータが消えた理由を予測できない（驚き）。
- **重大度**: High

### 3. 戻り値の形状が予測困難 (Unpredictable Return Type)
- **箇所**: `get_stats` の戻り値 `dict[str, dict]`
- **問題**: 内部の辞書のキー（"count", "total_score" 等）が型ヒントから読み取れず、クライアントコードが実装詳細に依存する。
- **重大度**: Medium

### 4. 暗黙の環境依存 (Implicit Dependency)
- **箇所**: `DEFAULT_PATH` の `Path.home()` 依存
- **問題**: クラス定義内で保存先がハードコードされており、テストや環境ごとの切り替えが直感的でない。
- **重大度**: Low

## 修正提案
1. `load()` メソッドを分離し、明示的に呼び出させる（または `__init__` で明示的に `load=True` とする）。
2. `_load` でのエラー時はログを出力するか、破損ファイルのリネーム等の「驚き」を減らす処理を入れる。
3. `Stats` データクラスを定義し、`get_stats` の戻り値を明確にする。

## 重大度
High
