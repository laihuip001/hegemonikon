# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/fep/tests/test_attractor_advisor.py`

## 判定
発言（要改善）

## 発見事項

### 1. 予測不能な副作用（重いモデルロード）
`advisor` および `attractor` フィクスチャが、実際の `SeriesAttractor` を初期化するため、テスト実行時に重い機械学習モデル（Embedder）のロードが発生します。これはユニットテストとして想定される実行速度やリソース消費を大きく逸脱しており、予測不能な副作用（High Severity）となります。

### 2. 暗黙的な外部依存（LanceDB）
`AttractorAdvisor` はデフォルトで `use_gnosis=True` となっており、ローカルファイルシステム上の `gnosis_data/lancedb` への接続を試みます。これにより、テストの成功が外部環境（DBファイルの有無）に暗黙的に依存しており、環境による予測不能な振る舞いを引き起こします（Medium Severity）。

### 3. アサーションのマジックナンバー
`test_clear_convergence` 等のアサーションで `0.6`, `0.08` などの閾値が直接使用されており、これらの値がどのような根拠に基づいているか（モデルの特性など）が関数シグネチャや定数名から読み取れません（Low Severity）。

## 重大度
High

## 修正案
`advisor` フィクスチャで外部依存を無効化し、マジックナンバーを定数化することを推奨します。

```python
<<<<<<< SEARCH
# PURPOSE: advisor の処理
@pytest.fixture(scope="module")
def advisor():
    return AttractorAdvisor()
=======
# PURPOSE: advisor の処理 (副作用回避のため外部DB依存を無効化)
@pytest.fixture(scope="module")
def advisor():
    return AttractorAdvisor(use_gnosis=False)
>>>>>>> REPLACE
```

また、アサーションの閾値についても定数化またはコメントでの補足を検討してください。
