# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/anamnesis/gnosis_chat.py`

## 判定
発言（要改善）

## 発見事項

### High (副作用非明示・例外隠蔽)
- `GnosisChat._retrieve` メソッド内で `except Exception: pass` が多用されており、データベース接続エラーやクエリエラーが完全に隠蔽されています。検索が失敗したのか、単に結果がなかったのか呼び出し元から判別不能です。
- `KnowledgeIndexer.index_knowledge` でも同様に `except Exception: pass` や `continue` が使用されており、ファイル読み込みエラーやDBエラーが静かに無視されます。
- `Reranker.rerank` が入力引数 `results` をインプレースで変更（`_rerank_score` の追加）しつつ、ソート・スライスした新しいリストも返しています。副作用と戻り値の責務が混在しており予測困難です。

### Medium (型予測困難)
- `GnosisChat.ask` の戻り値が `dict` となっていますが、具体的なキー構造（`answer`, `sources`, `retrieval_time` 等）が型ヒントから読み取れません。`TypedDict` や `dataclass` を使用すべきです。
- `KnowledgeIndexer.discover_knowledge_files` の戻り値が `list[dict]` ですが、辞書の構造が不明確です。
- `_retrieve` や `rerank` の戻り値も `list[dict]` であり、リスト内の辞書がどのようなキー（`_source_table`, `title` 等）を持つかコードを読まないと分かりません。

### Medium (暗黙状態変更・依存関係)
- `_load_model` や `_load_index` などのメソッド内で `import torch` や `transformers` を行っています。`__init__` 時点では成功しても、実行時に `ImportError` が発生する可能性があり、初期化時点での予測可能性を下げています。
- `Reranker` クラスも同様にメソッド内で `sentence_transformers` をインポートしています。

## 重大度
High
