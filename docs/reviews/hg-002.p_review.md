# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/anamnesis/export_chats.py`

## 判定
発言（要改善）

## 発見事項

### 副作用非明示 (High)
- `__init__`: インスタンス化時に `output_dir.mkdir` を実行し、ファイルシステムへの書き込みを行っています。
- `export_all`: ブラウザ上の要素をクリック（`conv["element"].click`）し、ページ遷移を引き起こします。これは外部システム（ブラウザ）の状態を大きく変更する副作用です。
- 全体: `print` 文による標準出力への書き込みが多数のメソッドに含まれています。ログ機能を使用すべきです。

### 型予測困難 (Medium)
- `extract_conversation_list`, `scroll_and_collect_messages`, `extract_messages`, `_process_raw_messages`: 戻り値が `List[Dict]` となっており、辞書の内部構造（キーや値の型）が不明確です。`TypedDict` やデータクラスの使用が推奨されます。
- `save_markdown`, `save_json`: ファイルパスを返していますが、戻り値の型ヒントが欠落しています。
- `export_all`, `export_single`, `export_watch`: 戻り値の型ヒントがありません（`None` であるべき）。

### 暗黙状態変更 (Medium)
- `self.chats`: `export_all` などのメソッド内で `append` により状態が変更されますが、これがメソッド名から予測しづらいです。
- `connect`: `self.browser`, `self.page` を設定しますが、接続状態の管理がクラス内部に隠蔽されており、外部から予測しにくい状態変更です。

### 例外の隠蔽 (High)
- `connect`, `extract_conversation_list`, `scroll_and_collect_messages`, `export_all`: `try-except Exception` ブロックで例外を捕捉し、エラーメッセージを `print` して処理を継続または終了しています。呼び出し元はエラー発生を検知できず（あるいは戻り値のチェックが必要）、例外の発生がシグネチャから完全に隠蔽されています。

## 重大度
High
