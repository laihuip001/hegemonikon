# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/pks/pks_cli.py`

## 判定
発言（要改善）

## 発見事項
- **副作用非明示 (High):** モジュールレベルで `sys.path.insert` を実行しており、インポートしただけでグローバルな副作用（システムパス変更）が発生する。これは「インポートは安全」という予測を裏切る。（修正案: `if __name__ == "__main__":` ブロック内か、専用のセットアップ関数に移動すべき）
- **副作用非明示 (High):** `cmd_push` 等のコマンド関数内で `PKSEngine` をローカルインポートしている。依存関係が隠蔽されており、実行時まで `ImportError` が発生しないため、予測可能性が低い。（修正案: インポートをトップレベルに移動し、依存関係を明示する）
- **暗黙状態変更 (Medium):** `cmd_feedback` 内で `engine._feedback` というプライベートメンバにアクセスしている。これは `PKSEngine` の内部実装（`_feedback` の存在と状態）に暗黙的に依存しており、インターフェース契約違反である。（修正案: `PKSEngine` に `get_feedback_stats()` 等の公開メソッドを追加する）
- **副作用非明示 (Medium):** `cmd_feedback` は引数 (`--stats`) によって「読み取り（統計表示）」と「書き込み（反応記録）」という全く異なる副作用を持つ。関数名から振る舞いが一意に予測できない。（修正案: コマンドを分離するか、責任を明確にする）
- **例外発生不明 (Medium):** `PKSEngine` のメソッド呼び出し（外部サービスやDB接続を含む可能性が高い）に対する例外処理がなく、呼び出し元（CLIユーザー）に生の例外が露出する可能性がある。（修正案: `try-except` でラップし、予測可能なエラーメッセージを出力する）

## 重大度
High
