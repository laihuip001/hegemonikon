# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/pks/push_dialog.py`

## 判定
発言（要改善）

## 発見事項
- **[High] 副作用非明示 (related メソッド)**
    - `related` メソッド内で例外発生時に `print()` 文による標準出力への書き込みが行われています。これは関数シグネチャ（`-> list[KnowledgeNugget]`）から予測できない副作用であり、CLIツールや他の出力形式と競合する可能性があります。
    - 提案: `logging` モジュールを使用するか、例外を適切に送出してください。

- **[Medium] 例外の隠蔽 (related メソッド)**
    - `except Exception as e:` で全ての例外を捕捉し、空リストを返しています。これにより、`GnosisIndex` のインポートエラーや接続エラーなどが隠蔽され、呼び出し元は「関連知識がない」のか「システムエラー」なのかを区別できません。
    - 提案: 具体的な例外（`ImportError`など）のみを捕捉するか、エラー時はログ出力と共に明示的なエラー状態を返す設計にすべきです。

- **[Medium] 戻り値の意味的予測困難 (deeper メソッド)**
    - `_llm.available` が True の場合でも、`generate()` が失敗（None/空文字）すると、`_llm.available` が False の場合と同じ「LLMが必要です」というメッセージが返されます。これはエラーの原因（設定不足 vs 生成失敗）について呼び出し元（ユーザー）に誤った予測を与えます。
    - 提案: 生成失敗時は「回答を生成できませんでした」等の別のメッセージを返すように分岐してください。

- **[Low] 暗黙の依存関係 (related メソッド)**
    - `mekhane.anamnesis.index` のインポートがメソッド内に隠蔽されています。この依存関係が満たされていない場合、実行時までエラーが判明しません（かつ、前述の通り例外が握りつぶされます）。

## 重大度
High
