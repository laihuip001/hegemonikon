# 予測誤差審問官 レビュー

## 対象ファイル
`hermeneus/src/dispatch.py`

## 判定
発言（要改善）

## 発見事項

- **(High) `dispatch` 関数の例外処理の非対称性**
  - `parser.parse` は `try-except` で囲まれエラーを辞書で返すが、直後の `format_ast_tree` や `extract_workflows` は `try` ブロック外にある。
  - これらが失敗した場合（例: AST構造不正による `AttributeError` や `RecursionError`）、呼び出し元が期待する「エラー情報を含む辞書」ではなく、未処理の例外が発生する。関数の振る舞いが予測困難になっている。

- **(Medium) `dispatch` 関数の戻り値の型が `dict`**
  - 戻り値が汎用的な `dict` であり、具体的なキー（`success`, `ast`, `tree` 等）が型ヒントから読み取れない。
  - `TypedDict` やデータクラスを使用することで、戻り値の構造を予測可能にすべきである。

- **(Low) 関数内インポートの使用**
  - `format_ast_tree` や `extract_workflows` 内で `hermeneus.src.ast` をインポートしている。
  - 依存関係が関数シグネチャやモジュール先頭から隠蔽されており、モジュールロード時の副作用や依存関係が予測しづらい。

## 重大度
High
