# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/anamnesis/gnosis_chat.py`

## 判定
発言（要改善）

## 発見事項
- **Critical (副作用非明示)**: `Reranker.rerank` メソッドが引数 `results` のリストをインプレースでソートし、かつ内部の辞書に `_rerank_score` キーを追加している。戻り値として新しいリストを返すようなシグネチャ (`-> list[dict]`) でありながら、入力オブジェクトを破壊的に変更するのは呼び出し元にとって予測不能な副作用である。
- **Medium (暗黙状態変更)**: `GnosisChat.ask` メソッドは「問い（ask）」という参照系の名前を持つが、内部で `self.history.add` を呼び出し、インスタンスの状態（会話履歴）を更新している。副作用があることが名前から予測しにくい。
- **Medium (型予測困難)**: `GnosisChat.ask` の戻り値が `dict` となっており、具体的なキー（`answer`, `sources`, `retrieval_time` 等）やその型がシグネチャから予測できない。`TypedDict` やデータクラスの使用が望ましい。
- **Medium (例外予測困難)**: `_retrieve` および `index_knowledge` メソッド内で `try...except Exception: pass` により広範な例外を握りつぶしており、呼び出し元が失敗を検知できない（成功したように見せかける「驚き」が発生する）。

## 重大度
High
