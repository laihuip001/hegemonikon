# CCL式美学者 レビュー

## 対象ファイル
`mekhane/dendron/checker.py`

## 判定
発言（要改善）

## 発見事項
- **ネストが3レベルを超過 (Medium)**: `check`メソッド内のファイル処理ループにおいて、`for path in ...`、`if path.is_file()`、`if (self.check_functions ...)`、`if tree is not None`、`if self.check_functions` と5レベルのネストが発生しています。これは思考の軌跡を不明瞭にし、認知的負荷を高めます。
- **CCL式が60ポイント超過 (Medium)**: クラスの初期化 (`__init__`) における `exempt_patterns` のリスト内包表記や、`FileProof` の戻り値を生成する行が長大（60文字以上）です。一行あたりの情報密度が高すぎ、美しさを損ねています。
- **冗長なCCL式 (Low)**: `all_args` のリスト結合処理 (`list(...) + list(...) + ...`) や、`check`メソッド内の複雑な条件分岐 (`(A or B) and not C`) は、より簡潔な表現に置き換える余地があります。

### 修正コード提案
`check`メソッド内のファイルごとの処理をヘルパーメソッド `_process_single_file` に抽出することで、ネストレベルを低減し、責務を明確化します。

```python
    def _process_single_file(
        self,
        path: Path,
        function_proofs: List[FunctionProof],
        variable_proofs: List[VariableProof]
    ) -> List[FileProof]:
        """単一ファイルのチェック処理 (ネスト解消用)"""
        results = [self.check_file_proof(path)]

        # 追加チェックの要否判定 (早期リターンでネスト削減)
        if not (self.check_functions or self.check_variables):
            return results
        if self.is_exempt(path):
            return results

        try:
            content = path.read_text(encoding="utf-8")
            tree = ast.parse(content, filename=str(path))
        except (SyntaxError, UnicodeDecodeError):
            return results

        # AST解析結果の収集
        if self.check_functions:
            function_proofs.extend(
                self._check_functions_from_tree(path, tree, content)
            )
        if self.check_variables:
            variable_proofs.extend(
                self._check_variables_from_tree(path, tree)
            )

        return results
```

## 重大度
Medium
