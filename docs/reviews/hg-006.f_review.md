# ワークフロー適合審査官 レビュー

## 対象ファイル
`hermeneus/src/dispatch.py`

## 判定
発言（要改善）

## 発見事項
- **隠れワークフロー定義 (.agent/workflows/ 外の定義)**: `dispatch` 関数および `main` 関数内のロジック（Step 0〜Step 3）は、実質的に「CCL実行準備ワークフロー」を構成しているが、`.agent/workflows/` 外の Python コード内にハードコードされている。これは配置違反（Medium）に該当する。
- **ポリシーのコード埋め込み**: 実行計画テンプレート内で `/dia` への言及（反論義務）をハードコードしており、ワークフロー定義ファイル（例: `dia.md` や `m.md`）と責務が重複・混在している。ポリシーはワークフロー定義側で管理されるべきである。（Low）
- **フロントマター欠如**: 体系の骨格となるべきCCLディスパッチ処理に、標準的なワークフロー定義（YAMLフロントマター）が存在しない。（Low）

## 重大度
Medium

## 修正提案

1. **ワークフロー定義の分離**:
   `.agent/workflows/ccl.md` を作成し、CCLディスパッチの責務、バージョン、依存関係（`/dia` 等）を明記する。

2. **コードの純粋化**:
   `hermeneus/src/dispatch.py` から「実行計画テンプレート（ポリシー）」を分離し、AST解析結果のみを返すツールとして再定義する。テンプレート生成はワークフロー層（またはテンプレートエンジン）に委譲する。

```python
# 修正イメージ (hermeneus/src/dispatch.py)
def dispatch(ccl_expr: str) -> dict:
    # ... (パース処理)
    return {
        "success": True,
        "ast": ast,
        "tree": format_ast_tree(ast),
        "workflows": extract_workflows(ast),
        # plan_template は削除または純粋なデータとして返す
    }
```

```yaml
# 新規作成イメージ (.agent/workflows/ccl.md)
---
description: CCL式を解析し実行計画を立案する
hegemonikon: Hermeneus
version: "1.0"
derivatives: [parse, plan, execute]
---
# /ccl

## Step 0: Parse
...
## Step 1: Plan Generation (with /dia policy)
...
```
