# 専門家レビュー: 予測誤差バグ検出者 (TH-001)

## タスク
`mekhane/symploke/jules_client.py` の分析

## 分析観点
自由エネルギー原理 (FEP) に基づく予測誤差、能動的推論の不整合、およびモデルの硬直性の検出。

## 発見事項

### 1. 未知の状態に対する「楽観的すぎる」事前分布 (Parse State Hallucination)
*   **箇所**: `parse_state` 関数
*   **現状**: `ValueError` 発生時（未知のステータス文字列）に `SessionState.IN_PROGRESS` を返す。
*   **FEP分析**:
    *   **予測誤差**: 環境（API）が未知の状態（例: "CANCELLED", "EXPIRED", "PAUSED"）を返した際、エージェントはそれを「処理中（IN_PROGRESS）」であると誤認（幻覚）する。
    *   **結果**: 実際には停止しているプロセスに対し、エージェントは「まだ動いている」という誤ったモデルを維持し続け、`poll_session` でタイムアウトまで無駄な待機（能動的推論の失敗）を行う。
*   **重大度**: **高**
*   **推奨事項**: 未知の状態は `SessionState.UNKNOWN` として扱い、`poll_session` 内で `UNKNOWN` を検知した場合は警告ログを出力するか、あるいは即座に停止（フェイルセーフ）するロジックを追加すべきである。

### 2. 生成時の脆弱な能動的推論 (Brittle Creation Logic)
*   **箇所**: `create_session` メソッド
*   **現状**: `RateLimitError` (429) に対してリトライやバックオフを行わず、即座に例外を送出する。
*   **FEP分析**:
    *   **予測誤差**: `poll_session` はレート制限という「環境の抵抗」に対してバックオフ（行動の修正）を行うが、`create_session` はその柔軟性を持たない。
    *   **結果**: セッション生成時の一時的な高負荷（サプライズ）により、タスク全体が即死する。エージェントの生存戦略として不完全である。
*   **重大度**: **中**
*   **推奨事項**: `poll_session` と同様の指数バックオフ機能を `create_session` にも実装するか、共通のデコレータ/リトライロジックを適用する。

### 3. バッチ実行時の「空虚な」実体生成 (Empty Entity Generation)
*   **箇所**: `batch_execute` メソッド
*   **現状**: 例外発生時、`id=""` を持つ `FAILED` 状態の `JulesSession` を生成して返す。
*   **FEP分析**:
    *   **予測誤差**: 失敗をオブジェクトとしてカプセル化することは良いが、`id=""` は「存在しないセッションへの参照」を作成している。
    *   **結果**: 下流プロセスがこの `id` を用いて再問い合わせやログ記録を行おうとした際、予測不能なエラー（404 Not Found等）を引き起こす二次的なサプライズの源となる。
*   **重大度**: **低**
*   **推奨事項**: `id` がないことを明示的に扱うか、失敗を表す専用の型（または `Optional`）を用いるべきだが、現状のインターフェース維持なら許容範囲。ただし、`id` が空であることをドキュメント化すべき。

## 沈黙判定
発言
