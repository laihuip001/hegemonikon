# 信念状態一貫性評価者 レビュー

## 対象ファイル
`mekhane/symploke/jules_client.py`

## 発見事項
- **セッションライフサイクルの信念不一致**:
  - `__aenter__` では `TCPConnector` を用いた永続的なセッションプーリングを前提としているが、`_request` メソッド内では `_shared_session` や `_owned_session` がない場合に一時的な `ClientSession` を作成・破棄するフォールバックが存在する。これにより、コンテキストマネージャ外での使用時にパフォーマンス（接続再利用）の信念が静かに崩れる設計となっている。

- **エラー処理の二重基準**:
  - `create_session` や `poll_session` などの単体操作メソッドは例外（`RateLimitError`, `TimeoutError`）による制御フローを採用している。
  - 一方、`batch_execute` は全ての例外（`Exception`）を捕捉し、`JulesResult` オブジェクト内のデータとして扱う「データによる制御フロー」を採用している。
  - 同一クラス内でエラーに対する哲学的アプローチが混在しており、利用者に二重の負担を強いている。

- **並行性制御のスコープ曖昧性**:
  - `batch_execute` メソッドは引数として `max_concurrent` を受け取るが、デフォルトの `use_global_semaphore=True` の場合、この引数は無視されインスタンス全体の `_global_semaphore` が使用される。
  - 「並行数はバッチごとに制御可能である」という引数の示唆と、「並行数はクライアント全体で管理されるべきである」という実装の実態が乖離している。

- **データ構造の信念不一致（型安全性）**:
  - `JulesSession` は `dataclass` で厳密に定義されている一方、`batch_execute` や `synedrion_review` で扱われるタスク定義は非構造化された `dict`（Stringly Typed）に依存している。
  - 特に `JulesResult.task` が `dict` のまま保持されるため、入力時の構造的整合性が保証されないまま出力まで伝播する。

- **「沈黙」判定の脆弱な前提**:
  - `synedrion_review` メソッドにおいて、`silent` の判定が `str(r.session)` の文字列表現に "SILENCE" が含まれるかどうかの部分一致検索に依存している。
  - オブジェクトの文字列表現（`__str__` や `__repr__`）はデバッグ用であり、ビジネスロジックの判定基準として用いるべきではない。`JulesSession` の文字列表現が変更された場合、このロジックは静かに破綻する。

- **未知の状態に対する前提**:
  - `poll_session` は `UNKNOWN` 状態を一時的なエラーと見なし、3回連続で検出した場合に例外を投げる。しかし、APIが将来的に新しい（正当な）状態を追加した場合、それを「異常」と誤認して処理を中断するリスクがある。未知の状態を「待機」すべきか「失敗」とすべきかの信念が不明確である。

## 重大度
- Medium

## 沈黙判定
- 発言（要改善）
