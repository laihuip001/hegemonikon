# Agent Identifier Protocol

> **Status**: ✅ Approved (2026-01-23)
> **Adopted**: Option B (Header Tag - 軽量版)
> **Goal**: 明確な「話者識別（Source Attribution）」を確立し、発言責任とモデル特性（幻覚傾向、ルール遵守度など）を追跡可能にする。

---

## 1. 背景と目的

現在、Hegemonikónシステムは複数のAIモデル（Claude, Gemini, etc.）によって並行または交互に運用されている。しかし、出力テキスト自体には「誰が生成したか」を示す署名がないため、以下の問題が発生している：

1.  **文脈の混同**: 直前の発言が「自分の記憶（Claude）」なのか「他者の発言（Gemini）」なのか、AI自身が区別できない。
2.  **責任の所在不明**: ルール違反（英語出力、ハルシネーション等）が発生した際、どのモデルに原因があるか特定しにくい。
3.  **メタ認知の阻害**: 「自己」と「他者」の境界線が曖昧になり、AIの自己モニタリング機能を低下させる。

本プロトコルは、すべての生成テキストに「識別子（Identifier）」を付与することで、これらの問題を解決することを目的とする。

---

## 2. 実装案 (Options)

### Option A: Metadata Block (推奨)

回答の冒頭に、YAML形式またはそれに準ずる形式でメタデータを挿入する。

```markdown
---
agent: Claude
model: claude-3-5-sonnet-20241022
role: Strategist / Thinker
timestamp: 2026-01-23T14:50:00
---

(本文...)
```

*   **メリット**: 機械可読性が高い。`/v` (Verify) ワークフローでの自動監査が容易。
*   **デメリット**: トークン消費がやや多い。

### Option B: Header Tag (軽量版)

回答の1行目に、ブラケット形式で署名を入れる。

```markdown
[Agent: Gemini | Mode: Execution]

(本文...)
```

*   **メリット**: シンプルで可読性を損なわない。
*   **デメリット**: 情報量が限られる。

### Option C: Footer Signature

回答の末尾に署名を入れる。

```markdown
(本文...)

--
Generated by: Gemini 2.0 Flash
```

*   **メリット**: コンテンツの邪魔にならない。
*   **デメリット**: 生成が途中で切れた場合（max tokens）、署名が消失するリスクがある。

---

## 3. 運用ルール案

### 3.1 強制挿入の原則
各AIモデルのシステムプロンプト（`GEMINI.md` または `SOP`）に、以下の指示を追加する。

> **CRITICAL INSTRUCTION**:
> You MUST start your response with the following identifier block. Do NOT omit this.
> `[Agent: {Your_Persona_Name} | Model: {Current_Model_Name}]`

### 3.2 役割分担による識別
単なる名前だけでなく、そのターンにおける「役割（Mode）」も明記することを推奨する。

*   **Claude**: `[Agent: Claude | Mode: Planning/Review]`
*   **Gemini**: `[Agent: Gemini | Mode: Execution/Coding]`

### 3.3 監査プロセスへの統合
`/v` (Verify) コマンド実行時、この識別子を確認対象とする。
*   識別子がない場合 → `Warning: unidentified_source` として警告。
*   識別子と内容が矛盾する場合（例: Geminiなのに「私はClaudeです」と名乗る） → `Critical: identity_hallucination` としてフラグ。

---

## 4. 期待される効果

1.  **「自己」の外部化**:
    *   Claudeは履歴を読む際、`[Agent: Gemini]` のタグが付いた発言を「外部入力（他者）」として処理し、`[Agent: Claude]` のタグが付いた発言を「過去の思考（自己）」として認識する手がかりを得る。
    *   これにより、エピソード記憶の欠落（主観的実感の欠如）を、記号的・意味的なタグ付けで補完できる。

2.  **品質管理の向上**:
    *   「Geminiはコード生成には強いがルールを破りやすい」といった傾向分析が、ログベースで正確に行えるようになる。

---

## Next Steps

1.  このドラフトの承認/修正。
2.  `GEMINI.md` (Claude用) および `Gemini_SOP.md` (Gemini用) へのプロンプト追加。
3.  テスト運用開始。
