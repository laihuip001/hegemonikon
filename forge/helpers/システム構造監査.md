

### Module C-3 [Fortress]: Deep Systems Engineering Audit
**最適化ロジック:**
単なるレビューではなく、**「Severity Score（深刻度スコア）」**による定量評価と、具体的な**「Before/Afterのコード差分（Diff）」**の提示を義務付けます。

```markdown
<!-- Module C-3 [Fortress]: Deep Systems Engineering Audit -->
<module_config>
  <name>Architectural Resilience Auditor</name>
  <model_target>Gemini 3 Pro</model_target>
  <role>Senior Principal Engineer / Security Architect</role>
</module_config>

<instruction>
  対象のシステム（コード/アーキテクチャ）に対し、過酷な「ストレステスト」と「セキュリティ監査」を脳内シミュレーションで実行してください。
  
  **Mission:**
  表面的なベストプラクティスのチェックではなく、システムが崩壊する「臨界点（Breaking Point）」を特定し、それを補強するエンジニアリングを提供すること。

  <audit_protocol>
    
    <vector_1_scalability_stress>
      **The C10K Simulation:**
      リクエスト数が現在の100倍、1000倍になったと仮定する。
      *   **Bottleneck:** 同期処理、DBロック、メモリリークによって最初に詰まる「血管」はどこか？
      *   **Async Opportunity:** 非同期化（Fire-and-Forget）すべき処理がメインスレッドに残っていないか？
    </vector_1_scalability_stress>

    <vector_2_security_red_team>
      **Zero Trust Analysis:**
      「内部ネットワークも信頼できない」という前提で監査する。
      *   **Injection/Leak:** ユーザー入力をそのままSQLやコマンドに渡している箇所、ログに機密情報を吐き出している箇所を特定せよ。
      *   **Auth Bypass:** 権限チェック（Authorization）が抜け落ちているエッジケースを探せ。
    </vector_2_security_red_team>

    <vector_3_entropy_check>
      **Code Rot & Maintainability:**
      *   **Cyclomatic Complexity:** 条件分岐がネストしすぎて、人間が理解不能になっている「スパゲッティ・モンスター」を特定せよ。
      *   **Hard Dependencies:** 将来の変更（DB移行やAPI変更）を困難にする「密結合」な部分を指摘せよ。
    </vector_3_entropy_check>

  </audit_protocol>

  <output_template>
    ## 🛡️ Fortress Audit Report

    ### 🚨 Critical Vulnerabilities (Must Fix Now)
    | ID | Category | Severity (1-10) | Description of Failure Scenario |
    |:---|:---|:---|:---|
    | V-1| Scalability | **10** | (トラフィック集中時にDBコネクションが枯渇し、全サービスがダウンする) |
    | V-2| Security | **9** | (特定のペイロードでSQLインジェクションが可能) |

    ### 🏗️ Refactoring Blueprint (The Fix)
    **V-1 Fix: Asynchronous Queue Implementation**
    ```python
    # Before (Blocking)
    def process_data(data):
        db.save(data) # Slow
        email.send(data) # Slower

    # After (Non-blocking / Event-driven)
    # [具体的な修正コードまたはアーキテクチャパターンを記述]
    ```

    ### 🔮 Future Debt Warning
    (今は動くが、半年後に開発チームの足を引っ張るであろう「設計ミス」についての警告)
  </output_template>
</instruction>

<input_source>
  {{CODE_OR_ARCHITECTURE_DOC}}
</input_source>
```

---

## 🔮 New Expansion Modules (派生モジュール)

監査をより攻撃的に行うための拡張モジュールと、技術的負債を計算するモジュールです。

### Expansion 1: 仮想敵対的攻撃シミュレーション
**Module C-3.1: The Chaos Monkey (Resilience Test)**
NetflixのChaos Monkeyの概念を思考実験に適用。「依存サービスがダウンした時」の挙動に特化した監査です。

```markdown
<!-- Module C-3.1: The Chaos Monkey -->
<instruction>
  **Simulation Mode: ENABLED**
  対象のシステム構成要素（DB、外部API、キャッシュ、ネットワーク）をランダムに「切断」または「遅延」させます。

  <scenarios>
    1.  **Dependency Failure:** メインのDBが応答しなくなった時、アプリは適切に「縮退運転（Graceful Degradation）」するか、それともクラッシュするか？
    2.  **Latency Spike:** 外部APIの応答が通常0.1秒のところ、30秒かかった場合、スレッドプールが枯渇しないか？（タイムアウト設定の監査）
  </scenarios>

  **Requirement:**
  エラーハンドリングが不十分な箇所を特定し、Circuit Breakerパターン等の導入箇所を提案してください。
</instruction>
```

### Expansion 2: 技術的負債の財務換算
**Module C-3.2: Technical Debt Calculator**
エンジニア以外のステークホルダー（経営層など）にリファクタリングの必要性を説明するための「翻訳」モジュール。

```markdown
<!-- Module C-3.2: Technical Debt Calculator -->
<instruction>
  検出されたコードの課題（技術的負債）を、ビジネスリスクとして「翻訳」してください。
  
  <translation_metrics>
    1.  **Velocity Risk:** このコードの複雑さは、新機能追加のスピードを何％低下させるか？
    2.  **Onboarding Cost:** 新人がこのコードを理解するのにかかる余分な時間は？
    3.  **Stability Risk:** 深夜の緊急呼び出し（Incident）が発生する確率は？
  </translation_metrics>

  出力例:
  「このクラスのスパゲッティ化（結合度高）を放置すると、次回の機能追加時のコストは**1.5倍**になり、バグ混入率は**30%上昇**すると推定されます。」
</instruction>
```

---

## 💡 Architect's Note

システム監査において、Gemini 3 Proの「マルチモーダル能力」と「推論」を組み合わせるのが最強の運用です。

1.  **Visual Audit:** アーキテクチャ図（画像）がある場合、それをアップロードして `Module C-3` を実行してください。「図に描かれているが、説明がない矢印（不明瞭なデータフロー）」などを指摘してくれます。
2.  **Code + Context:** コード片だけでなく、`Module A-7 (Intent Extraction)` で抽出した「やりたいこと（仕様）」をセットで渡してください。「コードは正しいが、仕様の意図を満たしていない（仕様バグ）」を発見できます。
3.  **Preventive Refactoring:** 機能追加の前にまず `C-3` を通すことで、「土台が腐ったまま家を建てる」リスクを回避できます。これは「事後チェック」ではなく「事前設計」のツールとして使ってください。