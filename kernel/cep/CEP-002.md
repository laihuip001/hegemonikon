---
cep: 002
title: "WM Variables (Working Memory)"
status: draft
created: 2026-02-05
author: Claude + Creator
ccl_version: "2.0"
---

# CEP-002: WM 変数（作業記憶）

## 動機

CCL v1 では変数は「暗黙の認知状態」とされていた。しかし:

1. **LLM は忘れる** — セッション境界でコンテキストが消失
2. **Token 制限** — 長いセッションで過去の思考が押し出される
3. **検証不能** — 暗黙の状態は Creator から見えない
4. **Chain-of-Thought** — LLM は思考を明示的に書くと精度が上がる

> **洞察**: LLM にとって「書き出す」は「考える」と等価。

---

## 仕様

### 構文

| 構文 | 意味 | 例 |
|:-----|:-----|:---|
| `$name = expr` | WM 変数定義 | `$goal = /bou{extract}` |
| `$name` | WM 変数参照 | `$goal` |
| `$name >> file` | アーティファクト永続化 | `$decision >> log.md` |
| `let $name = expr` | 明示的束縛（スコープ付き） | `let $x = /noe-` |

### 型推論

WM 変数は右辺のワークフローから定理型を継承:

```ccl
$insight = /noe+   # 型: O (Ousia)
$plan = /s+        # 型: S (Schema)
$emotion = /pro    # 型: H (Hormē)
```

### ライフサイクル

```
セッション開始
     ↓
$var = expression   ← 定義
     ↓
$var 参照           ← 使用（何度でも）
     ↓
$var >> artifact    ← オプション: 永続化
     ↓
セッション終了      ← 永続化されなかった $var は消失
```

---

## 使用例

### 思考の外在化

```ccl
# 現在の思考状態を明示
$goal = "CCL に WM 変数を追加する"
$constraints = ["既存構文との互換性", "Doxa との連携"]
$approach = /mek.inve

# 思考を使って意思決定
/dia+{$goal, $constraints}

# 結果を永続化
$decision >> implementation_plan.md
```

### ワークフロー間の情報伝達

```ccl
# 分析結果を変数に格納
$analysis = /noe+{target="問題X"}

# 変数を次のワークフローに渡す
/ene{context=$analysis}
```

---

## WM vs Doxa

| 特性 | WM (`$var`) | Doxa (`/dox`) |
|:-----|:------------|:--------------|
| 寿命 | セッション内 | 永続 |
| スコープ | ローカル | グローバル |
| 用途 | 作業中の一時状態 | 確立された信念 |
| 書き出し先 | `>> file` | Handoff/KI |
| 構造 | 自由形式 | 構造化 |
| 信頼度 | なし | confidence 付き |

### 昇格パターン

WM 変数が十分に検証されたら Doxa に昇格:

```ccl
$insight = /noe+{topic="X"}
/dia+{$insight}           # 検証
$insight >> /dox{conf=0.8}  # 昇格
```

---

## 将来拡張

1. **自動永続化警告** — セッション終了時に未永続化の WM 変数を警告
2. **WM スナップショット** — `$* >> snapshot.md` で全 WM 変数を一括保存
3. **セッション間引き継ぎ** — `$var << file` で前回の WM を読み込み

## パッシブ発動（v1.0）

> **Origin**: 2026-02-05 — 「書け」と言うのではなく「書かないと進めない構造」

### 3機構

| 機構 | トリガー | 実装 |
|:-----|:---------|:-----|
| **B** | WF 実行時 | `workflow_artifact_standard.md` に WM セクション必須化 |
| **C** | 全レスポンス | `GEMINI.md` に WM 必須ルール追加 |
| **D** | task_boundary | TaskSummary を WM として外在化 |

### 機構 D 詳細: task_boundary 連動

```
task_boundary 呼び出し時:
  ↓
TaskSummary = WM の蓄積ログ
  ↓
セッション終了時: Handoff に抽出
```

**Antigravity 側の動作**:

- `task_boundary` 呼び出し時の `TaskSummary` 引数が WM として機能
- これにより、タスク進行中の思考が自動的に外在化される

---

## 参照

- [ccl_language.md](file:///home/makaron8426/oikos/hegemonikon/kernel/ccl_language.md) — CCL 言語仕様
- [CEP-001](file:///home/makaron8426/oikos/hegemonikon/kernel/cep/CEP-001.md) — FEP 変数拡張

---

*CEP-002 — 思考の外在化を可能にする WM 変数仕様*
