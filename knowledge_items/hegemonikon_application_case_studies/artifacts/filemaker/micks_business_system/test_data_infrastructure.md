# MICKS Business System: Test Data Infrastructure

This document defines the requirements for generating and maintaining high-fidelity test data for the MICKS FileMaker system.

## 1. Prefix-Coded UUID Strategy

To minimize existence error during development and verification, all records must use UUID primary keys with hierarchical prefixes. This allows developers to instantly identify the "tier" and "context" of a record in any layout or calculation.

| Layer | Prefix | Example ID | Rationale |
| :--- | :---: | :--- | :--- |
| **Company** | (Standard) | `63534c02-...` | Base layer. |
| **System** | (Standard) | `9dc01f9f-...` | Domain Layer 1. |
| **Major Func** | `d` | `d001-0001-...` | "Dai" (Major). |
| **Middle Func** | `m` | `m001-0001-...` | "Midduru" (Middle). |
| **Minor Func** | `s` | `s001-0001-...` | "Shou" (Minor). |
| **Request** | `r` | `r001-0001-...` | "Request". |

### Constraint: Verbatim Naming

Primary keys must be named **`__pk_{TableName}ID`** and foreign keys must be named **`_fk_{TableName}ID`**.

## 2. Structural Consistency Rules

### 2.1. Scale Requirements (as of 2026-02-06)

For robust search and performance testing, the test sets should follow a balanced distribution:

- **Companies**: 30 records.
- **Systems**: 30 records (Approx. 1 system per company).
- **Major Functions**: 90 records (3 per system).
- **Intermediate Functions**: 270 records (3 per major function).
- **Minor Functions**: 540 records (2 per intermediate function).
- **Requests**: 30 records (Sampled across systems).

### 2.2. FK Consistency

- `システム一覧::_fk_会社一覧ID` must match `会社一覧::__pk_会社一覧ID`.
- `大機能一覧::_fk_システム一覧ID` must match `システム一覧::__pk_システム一覧ID`.
- And so on down the ladder.

## 3. Data Integrity & Character Encoding

### 3.1. UTF-8 with BOM (U-BOM)

All Japanese CSV files must be encoded as **UTF-8 with BOM**.

- **Issue**: Standard UTF-8 causes "Mojibake" (garbled characters) in FileMaker's import engine.
- **Verification**: Use a hex editor or `file` command to ensure the `EF BB BF` header exists.

### 3.2. Keyword Injection for Search Testing

To verify the PatternCount filters (`SCH_...` scripts), data should include overlapping keywords:

- **System Names**: Include common terms like "管理" (Management) or "システム" (System) across different companies.
- **Descriptions**: Include specific project states (MVP, MVP構成, 帳票出力) to verify fuzzy search capabilities.

## 5. Automated Ladder Population (Scripted Expansion)

To rapidly expand test data from the `System` level down to the `Request` level, an automated Python-based generation pattern is utilized.

### 5.1. Domain Mapping Archetypes

Functions are generated based on the `システム名` (System Name) keywords to ensure semantic realism:

| System Keyword | Major Function Archetypes |
| :--- | :--- |
| **顧客** (Customer) | 顧客登録, 顧客検索, 顧客レポート |
| **在庫** (Inventory) | 入荷管理, 出荷管理, 在庫照会 |
| **勤怠** (Attendance) | 出退勤打刻, 勤務集計, 休暇申請 |
| **設備** (Equipment) | 点検スケジュール, 点検記録, 異常報告 |
| **保守** (Maint) | 保守依頼受付, 作業記録, 完了報告 |
| **会計** (Accounting) | 仕訳入力, 元帳照会, 決算処理 |
| **見積** (Estimate) | 見積作成, 見積承認, 見積履歴 |

### 5.2. ID Counter Logic

ID generation follows a strict counter pattern to ensure unique primary keys while maintaining visual tier grouping:

- **Major**: `d{SYS_IDX}-{MAJ_IDX}-0000-0000-{COUNTER}`
- **Middle**: `m{SYS_IDX}-{MAJ_IDX}-{MED_IDX}-0000-{COUNTER}`
- **Minor**: `s{SYS_IDX}-{MAJ_IDX}-{MED_IDX}-{MIN_IDX}-{COUNTER}`

### 5.3. Relationship Sampling (Requests)

Request records are generated by sampling from the pool of `Minor Function` IDs. This ensures that every request in the test set is validly docked to a functional "Anchor" in the hierarchy.
