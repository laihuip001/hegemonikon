# Oikos Environment Setup and Migration

This document outlines the standard procedures for setting up or migrating the Oikos/Hegemonikon environment, adhering to the **"Zero Design"** philosophy of environment independence.

## 1. Repository Synchronization

### Updating from Remote

When pulling updates, verify the default branch name (e.g., `master` instead of `main`).

```bash
cd ~/oikos/hegemonikon
# Check remote branches if unsure
git ls-remote --heads https://github.com/laihuip001/OIKOS

# Pull updates (using master in this case)
git pull https://github.com/laihuip001/OIKOS master
```

### Troubleshooting: Divergent Branches

If `git pull` fails with `fatal: Need to specify how to reconcile divergent branches`, decide how to handle the local changes (Merge vs Rebase).

## 2. Python venv Reconstruction (Hegemonikon)

Used when the virtual environment needs to be rebuilt. On Debian/Ubuntu systems, ensure the appropriate `python3-venv` package is installed.

```bash
# Example for Python 3.13
sudo apt install -y python3.13-venv

cd ~/oikos/hegemonikon
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

### Troubleshooting: Compilation Failures (hnswlib, etc.)

If `pip install` fails with errors like `RuntimeError: Unsupported compiler`, install C++ build tools:
`sudo apt install -y build-essential g++`

If you encounter `fatal error: Python.h`, install the Python development headers:
`sudo apt install -y python3-dev`

### 2.5 Node.js Runtime Reconstruction

For CLI tools (Claude/Codex), Node.js must be present.

```bash
# Setup repository for Node.js 20.x
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs
```

## 3. Bulk Path Replacement (Project-wide)

When moving the project between users, absolute paths in configuration and source files must be updated.

### MCP Config Replacement

```bash
# General search and replace for user home directories
find ~ -name "mcp_config.json" -exec sed -i 's|/home/laihuip001|/home/makaron8426|g' {} +

# Note: On GCP, mcp_config.json may be at ~/.gemini/antigravity/mcp_config.json
# Ensure it is moved and updated to reflect the new absolute paths to the 'oikos' folder.
```

### systematic migration (Phase-based)

- **Phase 1**: Core System Files (`.agent/`)
- **Phase 2**: AI brain Artifacts (`.gemini/`)
- **Phase 3**: General Documentation (`docs/`, `README.md`)

## 4. Post-Migration Troubleshooting: Workflow Recognition

### Issue: "Workflows or Rules not recognized"

After path replacement, the system may fail to recognize workflows or rules if it expects them in absolute global paths (e.g., `~/.agent`) rather than the project-local path.

**Solution**: Use symlinking or ensure the configuration (e.g., `mcp_config.json`) points to the correct project-local directory.

## 5. Memory and Identity Stack Initialization

The Hegemonik√≥n system relies on historical memory and identity files located in `mneme/.hegemonikon/`.

- `identity/values.json`: Core values (L1).
- `identity/persona.yaml`: Persona state (L2, L4).
- `sessions/handoff_*.md`: Episodic memory (L3).

## 6. Antigravity Knowledge Base & History Migration

The Knowledge Items (KIs) and Conversation History generated by Antigravity are stored in `~/.gemini/antigravity/`. These are **not** synced via Git and must be explicitly moved.

### Knowledge Items (KI)

Path: `~/.gemini/antigravity/knowledge/`

- Contains distilled insights.
- Primary source of cognitive continuity.

### Conversation History

Path: `~/.gemini/antigravity/conversations/`

- Contains `.pb` (protobuf) files of previous chats.
- Required to see historical chat logs in the IDE.

### Hidden Tool Configs

Paths like `~/.claude/` or `~/.codex/`.

### Troubleshooting: Permission Denied during SCP

If `gcloud compute scp` fails with `Permission denied`, use SSH to relax permissions on the source:

```bash
gcloud compute ssh $INSTANCE --command="sudo chmod -R 755 ~/.gemini/antigravity/conversations ~/.claude ~/.gemini/antigravity/mcp_config.json"
```

## 7. API Key Initialization

Cognitive processes and tool execution rely on `.env` files. Ensure the root `.env` (managed by `hegemonikon`) contains the primary keys:

```bash
# ~/oikos/hegemonikon/.env
GOOGLE_API_KEY=AIzaSy...
```

## 7. Bridge Migration Pattern (GCP VM-to-VM)

When moving between VMs using a local PC as a bridge, use the "Double scp" pattern.

```bash
# Pull from Source to Local
gcloud compute scp --recurse $GCP_INSTANCE:/home/path/to/source ./local_backup/
# Push from Local to Target
gcloud compute scp --recurse ./local_backup/ $NEW_INSTANCE:/home/path/to/target
```
