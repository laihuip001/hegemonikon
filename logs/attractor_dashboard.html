<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üß† Attractor Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: 'Inter', 'Noto Sans JP', system-ui, sans-serif;
    background: #0a0e17;
    color: #e0e6ed;
    min-height: 100vh;
}
.header {
    background: linear-gradient(135deg, #1a1f35 0%, #0d1321 100%);
    padding: 24px 32px;
    border-bottom: 1px solid rgba(99, 179, 237, 0.15);
}
.header h1 {
    font-size: 1.5rem; font-weight: 600;
    background: linear-gradient(90deg, #63b3ed, #b794f6);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.header .query {
    color: #a0aec0; font-size: 0.95rem; margin-top: 6px;
    font-style: italic;
}
.metrics {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 12px; padding: 20px 32px;
}
.metric-card {
    background: linear-gradient(135deg, #1a2332 0%, #141c2b 100%);
    border: 1px solid rgba(99, 179, 237, 0.1);
    border-radius: 12px; padding: 16px; text-align: center;
}
.metric-value {
    font-size: 1.8rem; font-weight: 700;
    background: linear-gradient(90deg, #63b3ed, #b794f6);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.metric-label { color: #718096; font-size: 0.75rem; margin-top: 4px; text-transform: uppercase; letter-spacing: 0.05em; }
.grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px; padding: 0 32px 32px;
}
.card {
    background: linear-gradient(135deg, #1a2332 0%, #141c2b 100%);
    border: 1px solid rgba(99, 179, 237, 0.1);
    border-radius: 12px; padding: 20px;
}
.card.full { grid-column: 1 / -1; }
.card h3 {
    font-size: 0.9rem; color: #a0aec0; margin-bottom: 14px; font-weight: 500;
}
canvas { width: 100% !important; }
.flow-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
.flow-table th { color: #718096; text-align: left; padding: 6px 8px; border-bottom: 1px solid rgba(255,255,255,0.05); }
.flow-table td { padding: 6px 8px; border-bottom: 1px solid rgba(255,255,255,0.03); }
.flow-table .converged { color: #68d391; }
.inhib-item {
    display: inline-block; margin: 4px;
    background: rgba(252, 129, 129, 0.1);
    border: 1px solid rgba(252, 129, 129, 0.2);
    border-radius: 8px; padding: 4px 10px; font-size: 0.75rem;
}
.inhib-source { color: #63b3ed; font-weight: 600; margin-bottom: 6px; }
.sep-pair {
    display: inline-block; margin: 4px;
    border-radius: 8px; padding: 4px 10px; font-size: 0.75rem;
}
.sep-close { background: rgba(252,129,129,0.1); border: 1px solid rgba(252,129,129,0.2); color: #fc8181; }
.sep-far { background: rgba(104,211,145,0.1); border: 1px solid rgba(104,211,145,0.2); color: #68d391; }
.decomp-seg {
    display: inline-block; margin: 4px;
    background: rgba(99,179,237,0.1);
    border: 1px solid rgba(99,179,237,0.2);
    border-radius: 8px; padding: 4px 10px; font-size: 0.75rem; color: #63b3ed;
}
</style>
</head>
<body>
<div class="header">
    <h1>üß† Attractor Dashboard ‚Äî 24 ÂÆöÁêÜË™çÁü•„Éû„ÉÉ„Éó</h1>
    <div class="query">Query: "Why does this truly exist?"</div>
</div>

<div class="metrics" id="metrics"></div>
<div class="grid" id="charts"></div>

<script>
const D = {"query": "Why does this truly exist?", "theorem_keys": ["O1", "O2", "O3", "O4", "S1", "S2", "S3", "S4", "H1", "H2", "H3", "H4", "P1", "P2", "P3", "P4", "K1", "K2", "K3", "K4", "A1", "A2", "A3", "A4"], "mixture": {"distribution": {"O1": 0.6422949433326721, "O2": 0.02039152756333351, "O3": 0.04836609959602356, "O4": 0.020010722801089287, "S1": 0.006155895069241524, "S2": 0.005048192571848631, "S3": 0.0063300710171461105, "S4": 0.025140982121229172, "H1": 0.020250238478183746, "H2": 0.005312113557010889, "H3": 0.006266213953495026, "H4": 0.023618677631020546, "P1": 0.003871195949614048, "P2": 0.012451320886611938, "P3": 0.009455480612814426, "P4": 0.005692729260772467, "K1": 0.009569047018885612, "K2": 0.002841539680957794, "K3": 0.05167092755436897, "K4": 0.011704306118190289, "A1": 0.004497943911701441, "A2": 0.017476750537753105, "A3": 0.013209158554673195, "A4": 0.028373872861266136}, "entropy": 0.5246999859809875, "dominant_series": "O", "series_distribution": {"O": 0.7311, "S": 0.0427, "H": 0.0554, "P": 0.0315, "K": 0.0758, "A": 0.0636}}, "suggest": [{"theorem": "K3", "name": "Telos (ÁõÆÁöÑ)", "sim": 0.4246}, {"theorem": "O3", "name": "Zƒìtƒìsis (Êé¢Ê±Ç)", "sim": 0.4213}, {"theorem": "A4", "name": "Epistƒìmƒì (Áü•Ë≠ò)", "sim": 0.3946}, {"theorem": "S4", "name": "Praxis (ÂÆüË∑µ)", "sim": 0.3885}, {"theorem": "H4", "name": "Doxa (‰ø°Âøµ)", "sim": 0.3854}, {"theorem": "O1", "name": "Noƒìsis (Ê∑±„ÅÑË™çË≠ò)", "sim": 0.3854}, {"theorem": "O2", "name": "Boulƒìsis (ÊÑèÂøó)", "sim": 0.3781}, {"theorem": "H1", "name": "Propatheia (ÂâçÊÑüÊÉÖ)", "sim": 0.3777}, {"theorem": "O4", "name": "Energeia (Ë°åÁÇ∫)", "sim": 0.3771}, {"theorem": "A2", "name": "Krisis (Âà§ÂÆö)", "sim": 0.3704}, {"theorem": "A3", "name": "Gn≈çmƒì (Ê†ºË®Ä)", "sim": 0.3564}, {"theorem": "P2", "name": "Hodos (ÈÅì)", "sim": 0.3534}, {"theorem": "K4", "name": "Sophia (Áü•ÊÅµ)", "sim": 0.3503}, {"theorem": "K1", "name": "Eukairia (Â•ΩÊ©ü)", "sim": 0.3402}, {"theorem": "P3", "name": "Trokhia (ËªåÈÅì)", "sim": 0.3396}, {"theorem": "S3", "name": "Stathmos (Âü∫Ê∫ñ)", "sim": 0.3196}, {"theorem": "H3", "name": "Orexis (Ê¨≤Ê±Ç)", "sim": 0.3191}, {"theorem": "S1", "name": "Metron (Â∞∫Â∫¶)", "sim": 0.3182}, {"theorem": "P4", "name": "Tekhnƒì (ÊäÄÊ≥ï)", "sim": 0.3143}, {"theorem": "H2", "name": "Pistis (Á¢∫‰ø°)", "sim": 0.3108}, {"theorem": "S2", "name": "Mekhanƒì (ÊñπÊ≥ï)", "sim": 0.3083}, {"theorem": "A1", "name": "Pathos (ÊÉÖÂøµ)", "sim": 0.3025}, {"theorem": "P1", "name": "Kh≈çra (Â†¥)", "sim": 0.295}, {"theorem": "K2", "name": "Chronos (ÊôÇÈñì)", "sim": 0.2795}], "multiview": [{"theorem": "O1", "name": "Noƒìsis (Ê∑±„ÅÑË™çË≠ò)", "sim": 0.538}, {"theorem": "K3", "name": "Telos (ÁõÆÁöÑ)", "sim": 0.4454}, {"theorem": "O3", "name": "Zƒìtƒìsis (Êé¢Ê±Ç)", "sim": 0.4389}, {"theorem": "H4", "name": "Doxa (‰ø°Âøµ)", "sim": 0.4267}, {"theorem": "A4", "name": "Epistƒìmƒì (Áü•Ë≠ò)", "sim": 0.4222}, {"theorem": "O2", "name": "Boulƒìsis (ÊÑèÂøó)", "sim": 0.4085}, {"theorem": "O4", "name": "Energeia (Ë°åÁÇ∫)", "sim": 0.4076}, {"theorem": "S4", "name": "Praxis (ÂÆüË∑µ)", "sim": 0.4034}, {"theorem": "K4", "name": "Sophia (Áü•ÊÅµ)", "sim": 0.4015}, {"theorem": "H1", "name": "Propatheia (ÂâçÊÑüÊÉÖ)", "sim": 0.3962}, {"theorem": "P2", "name": "Hodos (ÈÅì)", "sim": 0.3848}, {"theorem": "A2", "name": "Krisis (Âà§ÂÆö)", "sim": 0.384}, {"theorem": "K1", "name": "Eukairia (Â•ΩÊ©ü)", "sim": 0.3729}, {"theorem": "A3", "name": "Gn≈çmƒì (Ê†ºË®Ä)", "sim": 0.3725}, {"theorem": "P3", "name": "Trokhia (ËªåÈÅì)", "sim": 0.3627}, {"theorem": "H2", "name": "Pistis (Á¢∫‰ø°)", "sim": 0.3623}, {"theorem": "H3", "name": "Orexis (Ê¨≤Ê±Ç)", "sim": 0.3536}, {"theorem": "S3", "name": "Stathmos (Âü∫Ê∫ñ)", "sim": 0.3426}, {"theorem": "S1", "name": "Metron (Â∞∫Â∫¶)", "sim": 0.3404}, {"theorem": "P4", "name": "Tekhnƒì (ÊäÄÊ≥ï)", "sim": 0.3348}, {"theorem": "S2", "name": "Mekhanƒì (ÊñπÊ≥ï)", "sim": 0.33}, {"theorem": "A1", "name": "Pathos (ÊÉÖÂøµ)", "sim": 0.329}, {"theorem": "P1", "name": "Kh≈çra (Â†¥)", "sim": 0.3251}, {"theorem": "K2", "name": "Chronos (ÊôÇÈñì)", "sim": 0.3062}], "flows": {"excite": {"label": "Excitation-Only", "converged": 5, "states": [{"step": 0, "top3": [["O1", 0.060921452939510345], ["K3", 0.04735015705227852], ["O3", 0.04703821986913681]]}, {"step": 1, "top3": [["H4", 0.07300521433353424], ["H1", 0.07275696098804474], ["S4", 0.07235439866781235]]}, {"step": 2, "top3": [["K3", 0.08052635192871094], ["H2", 0.08010578155517578], ["K2", 0.08000297844409943]]}, {"step": 3, "top3": [["K2", 0.08406434953212738], ["K3", 0.0833665058016777], ["H2", 0.0832470953464508]]}, {"step": 4, "top3": [["K2", 0.08536870032548904], ["H2", 0.08426722884178162], ["K3", 0.08423169702291489]]}, {"step": 5, "top3": [["K2", 0.08578251302242279], ["H2", 0.08459919691085815], ["K3", 0.08449173718690872]]}]}, "ei_02": {"label": "E/I (Œ≤=0.2)", "converged": 4, "states": [{"step": 0, "top3": [["O1", 0.10461913794279099], ["K3", 0.05571717396378517], ["O3", 0.05480407178401947]]}, {"step": 1, "top3": [["H4", 0.08488379418849945], ["S4", 0.0834253653883934], ["H1", 0.08266030997037888]]}, {"step": 2, "top3": [["H2", 0.08567526191473007], ["K3", 0.0852503776550293], ["H3", 0.0852014571428299]]}, {"step": 3, "top3": [["K2", 0.08596287667751312], ["K3", 0.08587142825126648], ["H2", 0.08555775880813599]]}, {"step": 4, "top3": [["K2", 0.08652439713478088], ["H2", 0.08616930991411209], ["H3", 0.08545192331075668]]}]}, "ei_04": {"label": "E/I (Œ≤=0.4)", "converged": 4, "states": [{"step": 0, "top3": [["O1", 0.10461913794279099], ["K3", 0.05571717396378517], ["O3", 0.05480407178401947]]}, {"step": 1, "top3": [["H4", 0.0910220593214035], ["S4", 0.09013084322214127], ["H1", 0.08630377054214478]]}, {"step": 2, "top3": [["K3", 0.08780288696289062], ["H2", 0.08601339161396027], ["H3", 0.08544227480888367]]}, {"step": 3, "top3": [["H2", 0.08752311766147614], ["K3", 0.08675014972686768], ["H3", 0.08668004721403122]]}, {"step": 4, "top3": [["H2", 0.08834744989871979], ["K2", 0.08746334165334702], ["H3", 0.08740402013063431]]}]}}, "inhibition": {"K3": [["H1", 0.0538], ["P4", 0.0482], ["S2", 0.0482], ["O1", 0.048], ["P1", 0.0478]], "O3": [["P1", 0.0506], ["H1", 0.0502], ["P4", 0.05], ["S3", 0.0485], ["O4", 0.0475]], "A4": [["P3", 0.0531], ["K2", 0.0522], ["P1", 0.052], ["H1", 0.0511], ["S1", 0.0497]]}, "decomposition": {"divergence": 0.0, "segments": [{"text": "Why does this truly exist?", "top": "O3"}]}, "separation": {"avg": 0.4185, "min": 0.255, "max": 0.5668, "closest": [["O4", "S4", 0.255], ["H3", "A1", 0.2756], ["K4", "A4", 0.2762], ["O3", "K4", 0.2806], ["K1", "K2", 0.2807]], "farthest": [["S2", "H1", 0.5526], ["O4", "H1", 0.5553], ["H1", "P3", 0.5556], ["H1", "P1", 0.5646], ["O1", "P4", 0.5668]]}, "sim_matrix": [[1.0, 0.513, 0.579, 0.471, 0.53, 0.481, 0.486, 0.467, 0.492, 0.502, 0.479, 0.505, 0.484, 0.468, 0.525, 0.433, 0.521, 0.452, 0.566, 0.556, 0.478, 0.505, 0.551, 0.513], [0.513, 1.0, 0.587, 0.647, 0.617, 0.575, 0.557, 0.65, 0.539, 0.578, 0.687, 0.544, 0.549, 0.639, 0.529, 0.592, 0.601, 0.641, 0.674, 0.601, 0.58, 0.622, 0.592, 0.544], [0.579, 0.587, 1.0, 0.554, 0.603, 0.575, 0.545, 0.587, 0.528, 0.629, 0.643, 0.606, 0.525, 0.611, 0.588, 0.531, 0.586, 0.567, 0.642, 0.719, 0.58, 0.598, 0.601, 0.631], [0.471, 0.647, 0.554, 1.0, 0.558, 0.608, 0.614, 0.745, 0.445, 0.551, 0.6, 0.53, 0.508, 0.642, 0.551, 0.595, 0.627, 0.597, 0.609, 0.561, 0.537, 0.613, 0.547, 0.588], [0.53, 0.617, 0.603, 0.558, 1.0, 0.596, 0.639, 0.591, 0.504, 0.689, 0.603, 0.6, 0.706, 0.598, 0.676, 0.572, 0.567, 0.633, 0.61, 0.598, 0.593, 0.631, 0.6, 0.501], [0.481, 0.575, 0.575, 0.608, 0.596, 1.0, 0.573, 0.676, 0.447, 0.552, 0.6, 0.53, 0.54, 0.695, 0.531, 0.675, 0.634, 0.656, 0.564, 0.592, 0.542, 0.583, 0.552, 0.534], [0.486, 0.557, 0.545, 0.614, 0.639, 0.573, 1.0, 0.631, 0.48, 0.645, 0.628, 0.543, 0.592, 0.573, 0.598, 0.598, 0.619, 0.617, 0.62, 0.575, 0.605, 0.674, 0.593, 0.523], [0.467, 0.65, 0.587, 0.745, 0.591, 0.676, 0.631, 1.0, 0.471, 0.573, 0.654, 0.562, 0.542, 0.614, 0.552, 0.667, 0.608, 0.599, 0.64, 0.591, 0.571, 0.621, 0.629, 0.643], [0.492, 0.539, 0.528, 0.445, 0.504, 0.447, 0.48, 0.471, 1.0, 0.558, 0.591, 0.504, 0.435, 0.528, 0.444, 0.457, 0.532, 0.525, 0.513, 0.541, 0.665, 0.521, 0.496, 0.488], [0.502, 0.578, 0.629, 0.551, 0.689, 0.552, 0.645, 0.573, 0.558, 1.0, 0.706, 0.693, 0.551, 0.563, 0.565, 0.55, 0.584, 0.646, 0.66, 0.701, 0.689, 0.674, 0.561, 0.648], [0.479, 0.687, 0.643, 0.6, 0.603, 0.6, 0.628, 0.654, 0.591, 0.706, 1.0, 0.598, 0.526, 0.626, 0.567, 0.522, 0.65, 0.666, 0.645, 0.645, 0.724, 0.658, 0.578, 0.58], [0.505, 0.544, 0.606, 0.53, 0.6, 0.53, 0.543, 0.562, 0.504, 0.693, 0.598, 1.0, 0.509, 0.572, 0.542, 0.527, 0.531, 0.547, 0.604, 0.645, 0.582, 0.618, 0.572, 0.663], [0.484, 0.549, 0.525, 0.508, 0.706, 0.54, 0.592, 0.542, 0.435, 0.551, 0.526, 0.509, 1.0, 0.533, 0.652, 0.52, 0.524, 0.603, 0.568, 0.518, 0.505, 0.542, 0.517, 0.478], [0.468, 0.639, 0.611, 0.642, 0.598, 0.695, 0.573, 0.614, 0.528, 0.563, 0.626, 0.572, 0.533, 1.0, 0.59, 0.628, 0.651, 0.616, 0.588, 0.597, 0.588, 0.572, 0.572, 0.533], [0.525, 0.529, 0.588, 0.551, 0.676, 0.531, 0.598, 0.552, 0.444, 0.565, 0.567, 0.542, 0.652, 0.59, 1.0, 0.539, 0.562, 0.578, 0.597, 0.547, 0.52, 0.568, 0.578, 0.467], [0.433, 0.592, 0.531, 0.595, 0.572, 0.675, 0.598, 0.667, 0.457, 0.55, 0.522, 0.527, 0.52, 0.628, 0.539, 1.0, 0.632, 0.57, 0.564, 0.61, 0.538, 0.596, 0.567, 0.525], [0.521, 0.601, 0.586, 0.627, 0.567, 0.634, 0.619, 0.608, 0.532, 0.584, 0.65, 0.531, 0.524, 0.651, 0.562, 0.632, 1.0, 0.719, 0.628, 0.606, 0.625, 0.64, 0.589, 0.538], [0.452, 0.641, 0.567, 0.597, 0.633, 0.656, 0.617, 0.599, 0.525, 0.646, 0.666, 0.547, 0.603, 0.616, 0.578, 0.57, 0.719, 1.0, 0.607, 0.606, 0.629, 0.649, 0.538, 0.477], [0.566, 0.674, 0.642, 0.609, 0.61, 0.564, 0.62, 0.64, 0.513, 0.66, 0.645, 0.604, 0.568, 0.588, 0.597, 0.564, 0.628, 0.607, 1.0, 0.587, 0.595, 0.688, 0.574, 0.61], [0.556, 0.601, 0.719, 0.561, 0.598, 0.592, 0.575, 0.591, 0.541, 0.701, 0.645, 0.645, 0.518, 0.597, 0.547, 0.61, 0.606, 0.606, 0.587, 1.0, 0.647, 0.668, 0.643, 0.724], [0.478, 0.58, 0.58, 0.537, 0.593, 0.542, 0.605, 0.571, 0.665, 0.689, 0.724, 0.582, 0.505, 0.588, 0.52, 0.538, 0.625, 0.629, 0.595, 0.647, 1.0, 0.659, 0.552, 0.566], [0.505, 0.622, 0.598, 0.613, 0.631, 0.583, 0.674, 0.621, 0.521, 0.674, 0.658, 0.618, 0.542, 0.572, 0.568, 0.596, 0.64, 0.649, 0.688, 0.668, 0.659, 1.0, 0.592, 0.592], [0.551, 0.592, 0.601, 0.547, 0.6, 0.552, 0.593, 0.629, 0.496, 0.561, 0.578, 0.572, 0.517, 0.572, 0.578, 0.567, 0.589, 0.538, 0.574, 0.643, 0.552, 0.592, 1.0, 0.606], [0.513, 0.544, 0.631, 0.588, 0.501, 0.534, 0.523, 0.643, 0.488, 0.648, 0.58, 0.663, 0.478, 0.533, 0.467, 0.525, 0.538, 0.477, 0.61, 0.724, 0.566, 0.592, 0.606, 1.0]]};
const COLORS = {"O": "#e74c3c", "S": "#3498db", "H": "#f39c12", "P": "#2ecc71", "K": "#9b59b6", "A": "#1abc9c"};

// --- Metrics ---
const metricsEl = document.getElementById('metrics');
const metrics = [
    { label: 'Entropy', value: D.mixture.entropy.toFixed(2) },
    { label: 'Dominant', value: D.mixture.dominant_series },
    { label: 'Top-1', value: D.suggest[0].theorem },
    { label: 'MV Top-1', value: D.multiview[0].theorem },
    { label: 'Divergence', value: D.decomposition.divergence.toFixed(2) },
    { label: 'Sep (avg)', value: D.separation.avg.toFixed(3) },
];
metricsEl.innerHTML = metrics.map(m => `
    <div class="metric-card">
        <div class="metric-value">${m.value}</div>
        <div class="metric-label">${m.label}</div>
    </div>`).join('');

// --- Charts Grid ---
const chartsEl = document.getElementById('charts');

// 1. Mixture Bar Chart
chartsEl.innerHTML += `<div class="card"><h3>üî¨ Mixture Distribution (T=0.05)</h3><canvas id="mixChart" height="200"></canvas></div>`;
// 2. Series Pie
chartsEl.innerHTML += `<div class="card"><h3>üìä Series Distribution</h3><canvas id="seriesChart" height="200"></canvas></div>`;
// 3. Flow Comparison Table
chartsEl.innerHTML += `<div class="card full"><h3>üåä Flow Comparison ‚Äî Excitation vs E/I</h3><div id="flowTable"></div></div>`;
// 4. Inhibition Network
chartsEl.innerHTML += `<div class="card"><h3>üö´ Inhibition Network (Q7)</h3><div id="inhibDiv"></div></div>`;
// 5. Separation
chartsEl.innerHTML += `<div class="card"><h3>üìè Basin Separation (Q1)</h3><div id="sepDiv"></div></div>`;
// 6. Decomposition
chartsEl.innerHTML += `<div class="card full"><h3>üîç Segment Decomposition (Q6)</h3><div id="decompDiv"></div></div>`;

// --- Mixture Bar ---
const mixCtx = document.getElementById('mixChart').getContext('2d');
const mixLabels = Object.keys(D.mixture.distribution);
const mixValues = Object.values(D.mixture.distribution);
const mixColors = mixLabels.map(t => COLORS[t[0]] || '#7f8c8d');
new Chart(mixCtx, {
    type: 'bar',
    data: {
        labels: mixLabels,
        datasets: [{ data: mixValues, backgroundColor: mixColors, borderWidth: 0 }]
    },
    options: {
        responsive: true, indexAxis: 'y',
        scales: {
            x: { grid: { color: 'rgba(255,255,255,0.03)' }, ticks: { color: '#718096' } },
            y: { ticks: { color: '#a0aec0', font: { size: 10 } } }
        },
        plugins: { legend: { display: false } }
    }
});

// --- Series Pie ---
const seriesCtx = document.getElementById('seriesChart').getContext('2d');
const seriesLabels = Object.keys(D.mixture.series_distribution);
const seriesValues = Object.values(D.mixture.series_distribution);
new Chart(seriesCtx, {
    type: 'doughnut',
    data: {
        labels: seriesLabels,
        datasets: [{
            data: seriesValues,
            backgroundColor: seriesLabels.map(s => COLORS[s] || '#7f8c8d'),
            borderWidth: 0
        }]
    },
    options: { responsive: true, plugins: { legend: { position: 'bottom', labels: { color: '#a0aec0' } } } }
});

// --- Flow Table ---
const flowDiv = document.getElementById('flowTable');
let html = '<table class="flow-table"><tr><th>Step</th>';
for (const key of ['excite', 'ei_02', 'ei_04']) {
    html += `<th>${D.flows[key].label}</th>`;
}
html += '</tr>';
const maxSteps = Math.max(...Object.values(D.flows).map(f => f.states.length));
for (let i = 0; i < Math.min(maxSteps, 8); i++) {
    html += `<tr><td>${i}</td>`;
    for (const key of ['excite', 'ei_02', 'ei_04']) {
        const st = D.flows[key].states[i];
        if (st) {
            const tops = st.top3.map(([t, v]) => `${t}(${v.toFixed(3)})`).join(' ');
            const cls = D.flows[key].converged === i ? 'converged' : '';
            html += `<td class="${cls}">${tops}</td>`;
        } else {
            html += '<td>‚Äî</td>';
        }
    }
    html += '</tr>';
}
html += '</table>';
flowDiv.innerHTML = html;

// --- Inhibition ---
const inhibDiv = document.getElementById('inhibDiv');
let inhibHtml = '';
for (const [src, pairs] of Object.entries(D.inhibition)) {
    inhibHtml += `<div class="inhib-source">${src} ‚ä£</div>`;
    pairs.forEach(([tgt, str]) => {
        inhibHtml += `<span class="inhib-item">${tgt} (${str.toFixed(3)})</span>`;
    });
    inhibHtml += '<br>';
}
inhibDiv.innerHTML = inhibHtml;

// --- Separation ---
const sepDiv = document.getElementById('sepDiv');
let sepHtml = '<b style="color:#fc8181">Closest:</b><br>';
D.separation.closest.forEach(([t1, t2, d]) => {
    sepHtml += `<span class="sep-pair sep-close">${t1}-${t2}: ${d}</span>`;
});
sepHtml += '<br><br><b style="color:#68d391">Farthest:</b><br>';
D.separation.farthest.forEach(([t1, t2, d]) => {
    sepHtml += `<span class="sep-pair sep-far">${t1}-${t2}: ${d}</span>`;
});
sepDiv.innerHTML = sepHtml;

// --- Decomposition ---
const decompDiv = document.getElementById('decompDiv');
let decompHtml = `<div style="margin-bottom:8px; color:#718096">Divergence: ${D.decomposition.divergence}</div>`;
D.decomposition.segments.forEach(seg => {
    decompHtml += `<span class="decomp-seg">"${seg.text}" ‚Üí ${seg.top}</span>`;
});
decompDiv.innerHTML = decompHtml;
</script>
</body>
</html>