# Dendron Architecture v3.0 — Matrix Structure

> 設計ドキュメント

## 概要

Dendron は **2軸マトリクス構造** を持つ存在証明システム。

## マトリクス構造

### 軸1: Depth Layer (走査の深さ)

| Layer | 対象 | 検証方法 | 状態 |
|:------|:-----|:---------|:-----|
| **L0** | ディレクトリ | PROOF.md の存在 | ✅ 実装済み |
| **L1** | ファイル | PROOF ヘッダー | ✅ 実装済み |
| **L2** | 関数・クラス | `# PURPOSE:` コメント | ✅ v2.6 実装済み |
| **L3** | 変数・字句 | 命名規則 | ❌ 未実装 |

### 軸2: Meta Layer (検証の種類)

| Meta Layer | 説明 | 検証対象 | 状態 |
|:-----------|:-----|:---------|:-----|
| **表層 (Surface)** | 「何があるか」の記述 | PROOF ヘッダー | ✅ 実装済み |
| **構造層 (Structure)** | 「どう繋がるか」の可視化 | import graph | ❌ 未実装 |
| **機能層 (Function)** | 「何が同じか」の検出 | 類似度マトリクス | ❌ 未実装 |
| **実証層 (Verification)** | 「本当に必要か」の証明 | 削除テスト | ❌ 未実装 |

## 完全マトリクス

```
                    表層      構造層      機能層      実証層
                  Surface   Structure   Function   Verification
              ┌─────────┬─────────┬─────────┬─────────┐
    L0 (Dir)  │ ✅       │ ❌       │ ❌       │ ❌       │
              ├─────────┼─────────┼─────────┼─────────┤
    L1 (File) │ ✅       │ ❌       │ ❌       │ ❌       │
              ├─────────┼─────────┼─────────┼─────────┤
    L2 (Func) │ ✅ v2.6  │ ❌       │ ❌       │ ❌       │
              ├─────────┼─────────┼─────────┼─────────┤
    L3 (Var)  │ ❌       │ ❌       │ ❌       │ ❌       │
              └─────────┴─────────┴─────────┴─────────┘
```

**現在のカバレッジ: 3/16 セル (18.75%)**

## L2 Surface 実装詳細 (v2.6)

| 機能 | 説明 | 状態 |
|:-----|:-----|:-----|
| PURPOSE 検出 | `# PURPOSE:` コメントの有無チェック | ✅ |
| 品質検証 | WEAK パターン検出 (WHAT vs WHY) | ✅ |
| CLI サブコマンド | `dendron purpose [PATH] --ci --strict` | ✅ |
| CI 統合 | dendron.yml に L2 ステップ追加 | ✅ |
| 段階的展開 | dendron/ strict + mekhane/ warn | ✅ |

## FEP 対応

| Depth | FEP 層 | 意味 |
|:------|:-------|:-----|
| L0 | Kairos (K) | 文脈・配置 |
| L1 | Ousia/Schema (O/S) | 本質・様態 |
| L2 | Hormē/Perigraphē (H/P) | 動機・境界 |
| L3 | Akribeia (A) | 精密・検証 |

## 抽象化（任意リポジトリ対応）

```
Hegemonikón 固有          →  抽象化 (汎用)
─────────────────────────────────────────
L0: PROOF.md              →  README.md / PURPOSE.md
L1: PROOF ヘッダー        →  ファイル docstring
L2: # PURPOSE: コメント   →  関数・メソッド説明
L3: 命名規則              →  変数・型ヒント
```

## ロードマップ

### Phase 1: 表層完成 ✅

- [x] L0 ディレクトリ PROOF.md
- [x] L1 ファイル PROOF ヘッダー
- [x] L2 関数 `# PURPOSE:` コメント (v2.6)
- [ ] L3 命名規則チェッカー

### Phase 2: 構造層

- [ ] import graph 生成
- [ ] 依存関係可視化
- [ ] 循環依存検出

### Phase 3: 機能層

- [ ] 機能類似度マトリクス
- [ ] 重複コード検出
- [ ] リファクタリング提案

### Phase 4: 実証層

- [ ] L3 削除テスト
- [ ] L2 削除テスト
- [ ] L1 削除テスト
- [ ] 存在証明の「証明」

---

*Origin: 2026-02-01_conv_12_Dendron Project Creation.md*
*Updated: 2026-02-07 (v3.0: L2 Surface 実装反映)*
