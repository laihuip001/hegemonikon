{
    "name": "WF-05: Health Alert â†’ Auto-Recovery",
    "nodes": [
        {
            "parameters": {
                "httpMethod": "POST",
                "path": "health-alert",
                "responseMode": "lastNode",
                "options": {}
            },
            "id": "webhook-health",
            "name": "Health Alert Webhook",
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 1,
            "position": [
                250,
                300
            ],
            "webhookId": "health-alert"
        },
        {
            "parameters": {
                "jsCode": "const https = require('https');\n\nconst data = $input.item.json.body || $input.item.json;\nconst items = data.items || [];\nconst score = data.score || 0;\n\nconst errors = items.filter(i => i.status === 'error');\nconst warns = items.filter(i => i.status === 'warn');\n\nlet severity = 'LOW';\nif (errors.length >= 3 || score < 0.3) severity = 'CRITICAL';\nelse if (errors.length >= 1 || score < 0.5) severity = 'HIGH';\nelse if (warns.length >= 2 || score < 0.7) severity = 'MEDIUM';\n\nconst errorNames = errors.map(e => `${e.name}: ${(e.detail || '').slice(0,40)}`).join(', ');\nconst warnNames = warns.map(w => `${w.name}: ${(w.detail || '').slice(0,40)}`).join(', ');\nconst ts = data.timestamp || new Date().toISOString();\n\nconst result = {\n  severity, score,\n  errorCount: errors.length, warnCount: warns.length,\n  errorNames: errorNames || '(none)',\n  warnNames: warnNames || '(none)',\n  timestamp: ts\n};\n\nif (severity === 'CRITICAL' || severity === 'HIGH') {\n  const webhookUrl = process.env.SLACK_WEBHOOK_URL || '';\n  if (webhookUrl) {\n    const icon = severity === 'CRITICAL' ? 'ğŸš¨' : 'ğŸ”´';\n    const scoreBar = 'â–ˆ'.repeat(Math.round(score * 10)) + 'â–‘'.repeat(10 - Math.round(score * 10));\n    const payload = JSON.stringify({\n      blocks: [\n        { type: 'header', text: { type: 'plain_text', text: icon + ' HGK Health: ' + severity, emoji: true } },\n        { type: 'section', fields: [\n          { type: 'mrkdwn', text: '*Score:*\\n' + (score * 100).toFixed(0) + '% [' + scoreBar + ']' },\n          { type: 'mrkdwn', text: '*Errors (' + errors.length + '):*\\n' + (errorNames || 'none') }\n        ]},\n        { type: 'context', elements: [\n          { type: 'mrkdwn', text: 'Warns: ' + (warnNames || 'none') + ' | _WF-05_' }\n        ]}\n      ]\n    });\n    try {\n      const urlObj = new URL(webhookUrl);\n      const slackResult = await new Promise((resolve) => {\n        const req = https.request({\n          hostname: urlObj.hostname, path: urlObj.pathname, method: 'POST',\n          headers: { 'Content-Type': 'application/json', 'Content-Length': Buffer.byteLength(payload) },\n          timeout: 10000\n        }, (res) => { let b=''; res.on('data',c=>b+=c); res.on('end',()=>resolve('sent')); });\n        req.on('error', () => resolve('error'));\n        req.on('timeout', () => { req.destroy(); resolve('timeout'); });\n        req.write(payload); req.end();\n      });\n      result.slack = slackResult;\n    } catch(e) {\n      result.slack = 'error';\n    }\n  } else {\n    result.slack = 'skipped (SLACK_WEBHOOK_URL not set)';\n  }\n} else {\n  result.slack = 'skipped (severity=' + severity + ')';\n}\n\nreturn [{ json: result }];"
            },
            "id": "classify-alert",
            "name": "é‡å¤§åº¦åˆ†é¡ + Slacké€šçŸ¥",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                450,
                300
            ]
        }
    ],
    "connections": {
        "Health Alert Webhook": {
            "main": [
                [
                    {
                        "node": "é‡å¤§åº¦åˆ†é¡ + Slacké€šçŸ¥",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "settings": {
        "executionOrder": "v1"
    },
    "tags": [
        {
            "name": "hegemonikon"
        },
        {
            "name": "health"
        },
        {
            "name": "alert"
        }
    ],
    "active": true,
    "versionId": "5.0.0"
}