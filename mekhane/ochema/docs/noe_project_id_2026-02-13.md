# /noe+*%/dia+ — Project ID 再検討

> **問い**: LS を介さず Cortex API を直叩きする方法は本当に存在しないのか？
> **結論**: 問いそのものを転換すべき。取得は可能だが、目的は耐障害性の確保。
> **確信度**: [推定: 75%] (TAINT: 前セッションの調査結果 + 本セッションの推論)

---

## Phase 3: Kalon — 普遍性検証

```
┌─[Kalon (普遍性検証)]─────────────────────────┐
│ V2 (LD_PRELOAD) ─→ V1: 特殊化              │
│ V3 (LS ログ) ─→ V1: 特殊化                 │
│ V4 (Vertex AI) ─⊥─ V1: 独立                │
│ 普遍的候補: V1 (MITM Proxy)                 │
│ Kalon: 0.65 — 仮定2つ (endpoint改ざん, pin) │
│ 美: 「一度見れば全て分かる」                 │
└──────────────────────────────────────────────┘
```

---

## Phase 5: Dokimasia — 候補評価

| 候補 | 実現可能性 | リスク | 実用性 | 推奨度 |
|:-----|:----------|:------|:------|:------|
| V1 MITM | ✅ | 中 | 高 | ⭐⭐⭐ |
| V3 ログ | ✅ | 低 | 中 | ⭐⭐⭐⭐ |
| V4 Vertex | ✅ | 低 | 低 | ⭐ (却下) |
| V5 LS堅牢化 | ✅ | 低 | 高 | ⭐⭐⭐⭐⭐ |

---

## CoVe 検証結果 (/dia+)

| Q# | 質問 | 整合性 |
|:---|:-----|:------|
| Q1 | LS堅牢化で直叩き不要になるか | ⚠️ Graceful Degradation 追加で修正 |
| Q2 | V3でProject IDが見つかるか | ⚠️ 保証なし、コスト最小なので試行価値あり |
| Q3 | V1でcert pinningにぶつかったら | ✅ eBPF (tls-trace) が代替 |
| Q4 | 現状維持バイアスでは？ | ⚠️ **有効な指摘** → V1をMUSTに昇格 |
| Q5 | Antigravity廃止時の保険 | ✅ MITM情報が保険になる |

**修正**: Q4 により V1 (MITM) を「保険として必ず実行」に昇格。

---

## 行動計画 (優先順)

1. **V3: LS ログ探査** — `GRPC_GO_LOG_SEVERITY_LEVEL=info` で起動 (今すぐ)
2. **V1: MITM Proxy** — mitmproxy で LS↔Cortex 通信キャプチャ (次セッション)
3. **V5: LS Graceful Degradation** — キャッシュフォールバック実装 (継続)
4. ❌ **V4: Vertex AI** — コスト不整合で却下

---

## 問いの転換

| Before | After |
|:-------|:------|
| Project ID をどう取得するか | LS 依存の耐障害性をどう確保するか |
| Cortex 直叩きは可能か | LS を使い倒し、LS なき日に備える |

> **Kalon**: 依存と独立の止揚 — 「LS を使い倒し、LS なき日に備える」

---

---

## V3 ログ探査結果 (追記)

### 発見した情報

| 発見 | ソース | 意味 |
|:-----|:-------|:-----|
| `cloudaicompanionProject` | extension.js proto定義 | Cortex API 呼び出しに必須のフィールド |
| `antigravity_project_id` | extension.js proto定義 | Antigravity 固有の Project ID |
| `user_defined_cloudaicompanion_project` | LS バイナリ strings | ユーザー定義の Project ID |
| `quota_project_id` | LS バイナリ strings (JSON) | Quota 管理用 Project ID |
| `g1-ultra-tier` | GetUserStatus API | ユーザーの tier ID |
| `Google AI Ultra` | state.vscdb protobuf | 課金プラン名 |

### 試行して失敗した手段

| 手段 | 結果 | 理由 |
|:-----|:-----|:-----|
| GetUserStatus | project なし | tier 情報のみ返却 |
| Cortex API 直叩き | 404 | ListCloudAICompanionProjects は公開エンドポイントではない |
| LS 内部 RPC (OnboardUser等) | 404 | ConnectRPC エンドポイントとして非公開 |
| /proc/PID/mem スキャン | 未発見 | Go GC による文字列断片化 + protobuf バイナリ形式 |
| gRPC ログ環境変数 | 未試行 | LS は IDE から起動、環境変数の注入が必要 |

### 次の突破口: V1 MITM

```bash
# 必要なインストール
pip install mitmproxy  # or apt install mitmproxy

# 手順:
# 1. mitmproxy を起動 (localhost:8080)
# 2. extension.js の --cloud_code_endpoint を https://127.0.0.1:8080 に変更
# 3. mitmproxy のルート CA を OS にインストール
# 4. LS を再起動 → 全通信がキャプチャされる
# 5. Project ID, リクエスト構造, 認証ヘッダーが一気に判明
```

---

*Generated by /noe+ Phase 0-6 + /dia+ CoVe + V3 ログ探査 — 2026-02-13*
