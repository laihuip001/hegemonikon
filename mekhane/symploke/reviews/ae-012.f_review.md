# 視覚リズムの指揮者 レビュー

## 対象ファイル
`mekhane/anamnesis/index.py`

## 判定
発言（要改善）

## 発見事項
- **関数サイズの不均一 (Medium)**
  - `Embedder.__init__` (約60行) と `GnosisIndex.add_papers` (約70行) が、他の小規模なメソッド（2-15行）と混在しており、リズムを乱しています。
  - 特に `Embedder.__init__` は初期化ロジックが長く、`GnosisIndex.add_papers` は重複排除と埋め込み生成のロジックが混在しています。
  - **提案**:
    - `Embedder.__init__` 内のデバイス検出ロジックを `_detect_device_and_model` のような独立したメソッドに抽出する。
    - `GnosisIndex.add_papers` 内の重複排除ロジック (L307-327) を `_deduplicate_papers` メソッドに、バッチ処理と埋め込み生成 (L334-348) を `_generate_embeddings` メソッドに分割する。

- **インデントの波形の乱れ (Low)**
  - `Embedder.__init__` 内の GPU/CPU 検出ロジック (L115-131) において、`if` -> `try` -> `if` -> `try` とネストが深くなり、視覚的なスパイク（急激な深浅変化）が発生しています。
  - **提案**: 上記のメソッド抽出により、ネストを浅く（フラットに）することができます。

## 重大度
Medium
