# シンプリシティの門番 レビュー

## 対象ファイル
`mekhane/anamnesis/session_indexer.py`

## 判定
発言（要改善）

## 発見事項
- (Medium) **コードの重複 (6回)**: `index_handoffs`, `index_conversations`, `index_steps`, `index_exports`, `index_roms`, `index_from_json` の全関数で、以下のロジックが完全に重複している。
    - LanceDB 既存レコードとの重複排除 (Dedup)
    - Embedder によるバッチベクトル化
    - LanceDB への挿入 (Schema filtering 含む)
    これらは共通の `_upsert_records(records, batch_size=32)` 関数に集約すべきである。これは "Reduced Complexity" (10倍→1/10に圧縮) の原則に反する。
- (Low) **不要なローカルimport**: `sessions_to_records` 内の `from datetime import datetime as _dt` は、モジュールレベルで `datetime` が import されているため冗長である。

## 重大度
Medium
