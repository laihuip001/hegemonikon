# シンプリシティの門番 レビュー

## 対象ファイル
`mekhane/mcp/hgk_gateway.py`

## 判定
発言（要改善）

## 発見事項
- **未使用変数**: `ALLOWED_REDIRECT_DOMAINS` が定義されていますが、コード内のどこからも参照されていません。「ドメインベースで許可する」というコメントがありますが、実装は `ALLOWED_CLIENT_IDS` と UUID チェックのみで行われています。(Medium)
- **コード重複**: `_load_policy` 関数内で、デフォルトのポリシー辞書（`{"version": "0.0", ...}`）が2箇所（ファイル不在時、例外発生時）にハードコードされています。(Low)
- **複雑性 (ネスト)**: `hgk_search` 関数が、ベクトル検索・KI検索・Doxa検索・Handoff検索を1つの関数内で手続き的に実装しており、ネストが深く（最大5階層）、可読性が低下しています。各検索ロジックを独立したヘルパー関数（`_search_ki`, `_search_doxa`, `_search_handoff`）に抽出することを推奨します。(Medium)

## 重大度
Medium
