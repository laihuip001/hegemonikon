# 比喩一貫性の詩人 レビュー

## 対象ファイル
`mekhane/anamnesis/index.py`

## 判定
発言（要改善）

## 発見事項
- **比喩の混在 (Medium)**:
  - モジュール全体として「Anamnesis (想起)」や「Gnosis (知識)」といった神秘的・哲学的メタファーを採用している一方で、`Embedder` や `add_papers`、`_get_vector_dimension` といった即物的・機械的な命名（Factoryメタファー）が混在しています。
  - 特に `GnosisIndex` (知識の索引/図書館) と `Embedder` (埋め込み機/工場) の対比が不自然です。「知識の庭」に「プレス機」が置かれているような違和感があります。

- **命名規則の不統一 (Low)**:
  - `GnosisIndex` はプロジェクト固有のプレフィックス (`Gnosis`) を持つのに対し、`Embedder` は一般的な機能名のみです。同一ファイル内で定義される主要クラスとして抽象度が揃っていません。本来 `Embedder` は `GnosisIndex` の内部表現（エンコーダー）であるべきです。

- **動詞の活用不統一 (Low)**:
  - `load_primary_keys` (状態変更を伴う読み込み) と `get_embedder` (取得/生成)、`get_by_primary_key` (検索/取得) の使い分けが曖昧です。特に `load` は副作用（キャッシュ更新）を示唆しますが、`get` 系メソッドとの整合性が取れていません。

## 修正提案
`Embedder` を `GnosisEncoder` または `SemanticEncoder` にリネームし、`GnosisIndex` との世界観を統一することを推奨します。また、機械的な処理（Embedding）とライブラリ的な管理（Index）のメタファーを分離するか、統一（例：全て「記憶の形成」として扱う）する必要があります。

```python
# 修正案: Embedder -> GnosisEncoder (知識のエンコーダーとして再定義)
class GnosisEncoder:
    """知識（テキスト）を意味ベクトルに変換するエンコーダー。"""
    # ... (内容は Embedder と同じ)

class GnosisIndex:
    """Gnōsis 知識ベースへの索引インターフェース。"""

    def _get_encoder(self) -> GnosisEncoder:
        if self.encoder is None:
            self.encoder = GnosisEncoder()
        return self.encoder

    # add_papers -> ingest_knowledge (知識の摂取/同化)
    def ingest_knowledge(self, papers: list[Paper], dedupe: bool = True) -> int:
        # ...
```

## 重大度
Medium
