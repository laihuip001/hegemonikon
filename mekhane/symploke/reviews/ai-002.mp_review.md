# ハルシネーション検出者 レビュー

## 対象ファイル
`mekhane/pks/pks_cli.py`

## 判定
発言（要改善）

## 発見事項

### Critical (存在しないモジュール)
- `mekhane.pks.self_advocate` はファイルシステム上に存在しませんが、`cmd_health` (L158) や `_print_advocacy` (L30) でインポートされています。
  - 特に `cmd_health` 内では `try-except ImportError` でガードされておらず、`check_advocate` 関数内で直接 `from ... import ...` しているため、実行時に `ImportError` が発生し、ヘルスチェックが失敗します（ただし `_check` 関数で `Exception` として捕捉されるためクラッシュはしませんが、機能不全です）。
  - `pks_engine.py` でもインポートされていますが、そちらは `try-except` でガードされています。しかし、CLI 側では `cmd_health` での呼び出しが顕在化しています。

### Medium (型ヒント違反)
- `EmbeddingAdapter.encode(texts: List[str])` の定義に対し、`str` 型の引数が渡されています。
  - `cmd_search` (L167): `query_vec = adapter.encode(query)` (query は str)
  - `cmd_rebuild` (L266): `vecs = np.array([adapter.encode(t) for t in texts], dtype=np.float32)` (t は str)
  - `sentence-transformers` の実装上は単一文字列も受け入れるため動作する可能性がありますが、`EmbeddingAdapter` の型定義 `List[str] -> np.ndarray` と矛盾しており、API 誤用です。正しくは `adapter.embed(query)` (単一文字列用) を使用するか、リスト `[query]` でラップすべきです。

## 重大度
Critical
