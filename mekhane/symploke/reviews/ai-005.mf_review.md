# コード/コメント矛盾検出者 レビュー

## 対象ファイル
`mekhane/anamnesis/index.py`

## 判定
発言（要改善）

## 発見事項
- `_get_embedder` メソッドの `# PURPOSE` コメント ("既存primary_keyとtitleをキャッシュ") が実装と乖離しています。直下の `_load_primary_keys` の PURPOSE をコピー＆ペーストした可能性があります。(Medium)
    - 提案: `# PURPOSE: Embedder インスタンスの取得 (シングルトン/遅延初期化)` に修正
- `Embedder.embed_batch` メソッドの `# PURPOSE` コメント ("GPU embedding via sentence-transformers.") が、CPUフォールバックやONNXフォールバックを含む実装の多様性を網羅していません。(Medium)
    - 提案: `# PURPOSE: Embedding via available backend (ST or ONNX).` などに修正
- 以下のメソッドで `docstring` の `Args` セクションが不足しています。(High)
    - `_get_vector_dimension` (引数: `table`)
    - `Embedder.__init__` (引数: `force_cpu`, `model_name`)
    - `Embedder.embed` (引数: `text`)
    - `Embedder.embed_batch` (引数: `texts`)
    - `GnosisIndex.__init__` (引数: `lance_dir`)
    - `GnosisIndex.get_by_primary_key` (引数: `primary_key`)
- 以下のメソッドで発生しうる例外が `docstring` の `Raises` に記載されていません。(High)
    - `GnosisIndex.__init__` (発生例外: `ImportError`)
    - `Embedder.__init__` (発生例外: `RuntimeError` ※OOM時以外, `FileNotFoundError` ※ONNX時)
    - `Embedder._init_onnx` (発生例外: `FileNotFoundError`)

## 重大度
High
