# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/mcp/sophia_mcp_server.py`

## 判定
発言（要改善）

## 発見事項
- [High] `call_tool("search")`: Kairosインデックスの結果に対して `metadata["primary_task"]` を無条件に参照しているが、`kairos_ingest.py` は `type="conversation"` の場合に `primary_task` を含まず `title` を使用する。会話ログが検索結果に含まれると `task: N/A` となり情報が欠落する。
- [Medium] `SOPHIA_INDEX`, `KAIROS_INDEX`: ハードコードされた絶対パス (`/home/makaron8426/...`) が `sophia_ingest.py` および `kairos_ingest.py` のデフォルト値と重複して定義されている。インジェスト側で環境変数やパスが変更された場合、サーバー側が追従できず不整合が発生する。
- [Low] `SophiaBacklinker` の利用: `build_graph()` を引数なしで呼び出しており、`sophia_backlinker.py` 内の `KNOWLEDGE_DIR` 定数に暗黙的に依存している。インデックス(`SOPHIA_INDEX`)の参照先とバックリンカーの参照先(`KNOWLEDGE_DIR`)が別々に定義されているため、データの不整合リスクがある。

## 重大度
High
