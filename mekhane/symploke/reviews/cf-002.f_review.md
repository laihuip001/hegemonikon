# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/api/routes/chat.py`

## 判定
発言（要改善）

## 発見事項
- **High**: `OchemaService` および `CortexClient` の非公開メンバ（`_`接頭辞）への直接依存がある。
  - `svc._get_cortex_client()`: `OchemaService` の内部キャッシュ機構への依存
  - `cortex._get_token()`: `CortexClient` の内部トークン管理への依存
  - `cortex._get_project(token)`: `CortexClient` の内部プロジェクト解決ロジックへの依存
  これらはクラスの内部実装（Private）であり、外部ファイルからのアクセスはカプセル化を破壊している。将来的なリファクタリング（例: トークン管理の変更）で `chat.py` が破損するリスクが高い。`OchemaService` または `CortexClient` に、必要な認証情報やクライアントを取得するための公開メソッド（Public API）を追加すべきである。

## 重大度
High
