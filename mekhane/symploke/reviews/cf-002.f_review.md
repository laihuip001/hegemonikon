# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/ochema/antigravity_client.py`

## 判定
発言（要改善）

## 発見事項
- **Private Method Access Violation**: `mekhane/anamnesis/session_indexer.py` (L258) が `AntigravityClient` のプライベートメソッド `_rpc` を直接呼び出している。
    - **詳細**: `fetch_all_conversations` 関数内で `client._rpc("exa.../GetAllCascadeTrajectories", {})` を実行している。
    - **原因**: 公開メソッド `session_info()` が結果を最新20件に制限しているため、全件取得のために内部実装をバイパスしている。
    - **リスク**: `AntigravityClient` の内部実装 (`_rpc` のシグネチャや RPC エンドポイント名) が変更された場合、即座に `session_indexer.py` が破損する。

- **Interface Divergence**: `mekhane/ochema/cortex_client.py` との `ask()` メソッドシグネチャの不一致。
    - **詳細**: `CortexClient` は `AntigravityClient` と同一インターフェースを謳っているが、`ask()` に `system_instruction`, `temperature`, `max_tokens` などの引数が追加されている。
    - **影響**: `OchemaService` (L158) が両者をラップしているが、`AntigravityClient` への呼び出しではこれらの引数が黙って無視される（`_ask_ls` でドロップされる）。これは「同じインターフェース」という契約に対する違反であり、利用者が `AntigravityClient` にも同等の制御能力があると誤認する原因となる。

- **Protocol Constant Duplication**: RPC エンドポイント文字列の重複定義。
    - **詳細**: `mekhane/ochema/proto.py` で定義された `RPC_GET_TRAJECTORIES` 定数を使用せず、`session_indexer.py` が文字列リテラルでエンドポイントをハードコードしている。
    - **影響**: プロトコル変更時の追従漏れリスク。

## 重大度
High
