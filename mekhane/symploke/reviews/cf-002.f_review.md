# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/anamnesis/session_indexer.py`

## 判定
発言（要改善）

## 発見事項
- **Schema Mismatch (High)**: `knowledge` テーブルのスキーマ定義（`Paper` モデル）に `content` フィールドが存在しないため、セッションや会話の本文（`content`）が保存時に `schema_fields` フィルタリングによって黙殺・破棄される恐れがある。これはセマンティック検索の有用性を著しく損なう。
- **Schema Mismatch (High)**: `Paper` モデルと異なり、`conversations_to_records` は `year` フィールドを使用している（`Paper` は `published`）。テーブル共有を前提とする場合、フィールド名の不一致はクエリ時の混乱を招く。
- **Constant Duplication (Medium)**: `fetch_all_conversations` 内で RPC エンドポイント文字列 `"exa.language_server_pb.LanguageServerService/GetAllCascadeTrajectories"` がハードコードされており、`mekhane/ochema/proto.py` の `RPC_GET_TRAJECTORIES` 定義と重複している。これは単一情報源（SSOT）の原則に反し、将来的な変更に脆弱である。
- **Internal Access (Medium)**: `GnosisIndex` の内部メソッド `_table_exists` および内部属性 `db` に直接アクセスしており、`GnosisIndex` の実装変更（カプセル化の強化など）に対して脆弱である。

## 重大度
High
