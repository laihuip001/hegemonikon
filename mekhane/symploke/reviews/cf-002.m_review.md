# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/mcp/sophia_mcp_server.py`

## 判定
発言（要改善）

## 発見事項
- **インポート時のプロセス終了リスク (Critical)**: `mekhane/symploke/sophia_backlinker.py` は `networkx` が不足している場合、トップレベルで `sys.exit(1)` を呼び出す。`sophia_mcp_server.py` は `Exception` を捕捉してインポートエラーをハンドリングしようとしているが、`SystemExit` は捕捉されないため、依存関係の問題でサーバープロセス全体が即座に終了する致命的な副作用がある。
- **Kairos インデックスのメタデータ不整合 (High)**: `Kairos` インデックスには `handoff` (メタデータに `primary_task` を持つ) と `conversation` (メタデータに `title` を持ち `primary_task` を持たない) の両方が含まれるが、サーバーの実装は `r.metadata.get("primary_task", "N/A")` のみを参照している。これにより、会話ログが検索結果に含まれた場合、タスク名が常に "N/A" となり、ユーザーにとって無意味な表示となる。
- **ハードコードされたパスへの依存 (Medium)**: `SOPHIA_INDEX` および `KAIROS_INDEX` のパスが `/home/makaron8426/...` という特定の絶対パスに固定されている。環境ごとの構成変更に対応できず、移植性を損なっている。

## 重大度
Critical
