# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/mcp/hgk_gateway.py`

## 判定
発言（要改善）

## 発見事項
- **Critical**: `DigestorPipeline.run()` の戻り値型変更への未対応
  - `DigestorPipeline.run()` は `DigestResult` (dataclass) を返すが、`hgk_digest_run` は `dict` を期待して分岐処理を行っている (`isinstance(report, dict)`)。
  - このため `dict` 用の整形ロジックがスキップされ、`str(report)` による生の文字列表現がユーザーに返される。
  - また、参照しようとしているキー (`fetched`, `deduplicated`) は `DigestResult` のフィールド (`total_papers`, `candidates_selected`) と一致しない。

- **High**: `AntigravityClient` の内部構造への依存
  - `hgk_ask` が `AntigravityClient` のプライベートメソッド `_send_message`, `_poll_response` を直接呼び出している。
  - 公開メソッド `ask` が既存セッション (`cascade_id`) の継続をサポートしていないため、内部実装に依存する形になっている。

## 重大度
Critical
