# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/ergasterion/digestor/pipeline.py`

## 判定
発言（要改善）

## 発見事項
- **[High] `EmbeddingAdapter` の内部構造への直接依存**: `_deduplicate_by_similarity` (および `_deduplicate_against_indices`) が `sophia.pkl` を直接 `pickle.load` し、辞書構造 (`vectors`, `metadata`) やベクトルデータ形式を仮定して操作している。`EmbeddingAdapter` クラスには `load()` および `search()` メソッドが存在するため、これらを使用すべきである。現状の実装は `EmbeddingAdapter` の内部保存フォーマット変更に極めて脆弱である。
- **[Medium] `DigestCandidate.suggested_templates` の契約不整合**: `_generate_eat_input` では `hasattr` による存在確認を行っているが、`_save_report` では属性が必ず存在することを前提 (`c.suggested_templates` への直接アクセス) としている。`DigestCandidate` の定義変更 (フィールド削除など) があった場合、`_save_report` がクラッシュする可能性がある。防御的プログラミングの方針を統一すべきである。

## 重大度
High
