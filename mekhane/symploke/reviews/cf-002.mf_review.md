# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/anamnesis/session_indexer.py`

## 判定
発言（要改善）

## 発見事項
- **(Critical) Schema Mismatch**: `session_indexer.py` inserts records into the shared `knowledge` table using ad-hoc fields (`content`, `year`) that are incompatible with the canonical `Paper` schema defined in `mekhane/anamnesis/models/paper.py`. It also omits mandatory fields (`id`, `source_id`, `published`, etc.). This violates the implicit contract that all records in `knowledge` table follow the `Paper` schema.
- **(High) Logic Duplication**: The file re-implements the embedding batch loop and schema filtering logic found in `GnosisIndex.add_papers`. It should use the provided abstraction (`GnosisIndex`) instead of duplicating logic.
- **(Medium) Internal Method Access**: The file calls the private method `AntigravityClient._rpc`, bypassing the public API. This creates a fragile dependency on the internal implementation of `AntigravityClient`.

## 重大度
Critical
