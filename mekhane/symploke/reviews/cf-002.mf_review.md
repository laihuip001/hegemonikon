# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/anamnesis/index.py`

## 判定
発言（要改善）

## 発見事項
- **MODELS_DIR Path Mismatch** (High): `MODELS_DIR` points to `mekhane/models/bge-small` (`../../models/bge-small`), but `setup_models.py` installs models to `mekhane/anamnesis/models/bge-small`. This breaks the ONNX fallback mechanism as `Embedder` will fail to find the model files.
- **Paper Schema Implicit Dependency** (Medium): `GnosisIndex.add_papers` filters fields based on the *existing* LanceDB schema. If `Paper` dataclass adds new fields, `add_papers` silently drops them for existing tables, leading to incomplete data. Furthermore, `search` returns `list[dict]` based on the stored data, meaning callers expecting the full `Paper` structure (as per current code definition) will receive incomplete dictionaries, potentially causing `KeyError` downstream.
- **LanceDB Type String Representation** (Medium): `_get_vector_dimension` relies on parsing `str(field.type)` with regex `r'\[(\d+)\]'`. This implicitly depends on the string representation of LanceDB types remaining constant, which is fragile and not part of the public API contract.

## 重大度
High
