# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/ergasterion/digestor/pipeline.py`

## 判定
発言（要改善）

## 発見事項

- **(High) `mekhane/api/routes/digestor.py` - `DigestCandidate` フィールドの欠落**
  - `pipeline.py` の `DigestCandidate` は `suggested_templates` フィールドを持つが、`api/routes/digestor.py` 内の Pydantic モデル変換ロジック (`run_pipeline` 関数) でこのフィールドが無視されている。
  - 結果として、API クライアントに `suggested_templates` が伝播されない契約違反が発生している。API 側のモデル定義には存在するが、値が常に空になる。

- **(Medium) `mekhane/mcp/hgk_gateway.py` - 返り値型の不一致 (Implicit Expectation)**
  - `hgk_gateway.py` の `hgk_digest_run` 関数は、`pipeline.run()` の返り値が `dict` または `str` であることを期待して分岐処理を行っている (`if isinstance(report, dict): ...`)。
  - しかし `pipeline.run()` は `DigestResult` オブジェクトを返すため、常に `else` 節に落ち、`str(report)` による生の文字列表現が返される。
  - これにより、利用側 (LLM/User) に意図した構造化データや整形されたメッセージが届かず、UX が低下している。

- **(Low) `mekhane/mcp/hgk_gateway.py` - `Paper` オブジェクトの属性依存**
  - `hgk_digest_list` 関数で `c.paper.authors` を参照しているが、`pipeline.py` が使用する `selector.py` の `Paper` 定義 (フォールバック時) には `authors` 属性がない。
  - `hasattr` チェックで防御されているものの、`Paper` クラスの定義場所によって属性が異なる不安定な状態にある。

## 重大度
High
