# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/ochema/cortex_client.py`

## 判定
発言（要改善）

## 発見事項
- `LLMResponse` フィールド未対応 (High): `CortexClient.ask` が返す `LLMResponse` は `cascade_id`, `trajectory_id` フィールドが空文字のままである。これは `antigravity_client` で定義された「セッション追跡可能な応答」という暗黙の契約に違反しており、呼び出し元がこれらの ID を期待して `session_info` 等を呼び出すと失敗する。
- 外部設定ファイルへの暗黙的依存 (High): `~/.config/cortex/oauth.json` および `~/.gemini/oauth_creds.json` の存在と特定キー (`client_id`, `client_secret`, `refresh_token`) を前提としており、これらが欠落した場合の回復手段やセットアップ誘導がコード内に明示されていない。
- デフォルトモデル定数の不一致 (Medium): `DEFAULT_MODEL = "gemini-2.0-flash"` と定義されており、`mekhane.ochema.proto.DEFAULT_MODEL` ("MODEL_CLAUDE_...") と乖離している。`OchemaService` 経由では上書きされるが、単体利用時に挙動の差異を生む。
- ロジック重複 (Medium): API レスポンスのパース処理 (`_parse_response`) が `mekhane.ochema.proto.extract_planner_response` と類似の構造を持つが、コード共有されておらず、将来的な仕様変更（例: thinking フィールドの表現）への追従漏れリスクがある。

## 重大度
High
