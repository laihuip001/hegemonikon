# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/ochema/antigravity_client.py`

## 判定
発言（要改善）

## 発見事項
- **Logic Duplication & Outdated Logic (High)**: `session_read` メソッド内で `PLANNER_RESPONSE` ステップを解析するロジックが `proto.py` の `extract_planner_response` と重複しており、かつ古い実装（`v8` 変更点の `step.metadata` 参照や `modifiedResponse` フォールバックが欠落）になっています。これは `proto.py` が持つプロトコル知識の隠蔽契約に違反しており、将来的な応答形式変更時に壊れるリスクが高いです。
- **Manual Payload Construction (High)**: `get_status`, `session_info`, `session_read`, `_poll_response` メソッド内で RPC ペイロードを辞書リテラルで手動構築しており、`proto.py` が提供するビルダー関数（`build_get_status`, `build_get_steps`）を使用していません。これにより `proto.py` との不整合が生じる可能性があります。
- **Hardcoded Constants (Medium)**: `session_read` メソッド内で `"CORTEX_STEP_TYPE_PLANNER_RESPONSE"` などの文字列リテラルを直接使用しており、`proto.py` から定数（`STEP_TYPE_PLANNER`）をインポートして使用する契約に違反しています。
- **Redundant Constants (Low)**: `AntigravityClient` クラス内で `SOURCE_INTERACTIVE_CASCADE` が定義されていますが、これは `proto.py` の定義と重複しており、かつクラス内では未使用のようです（`_start_cascade` は `proto.py` のビルダーを使用）。

## 重大度
High
