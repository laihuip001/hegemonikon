# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/fep/derivative_selector.py`

## 判定
発言（要改善）

## 発見事項
- **ハードコードされた絶対パスへの依存**: `SELECTION_LOG_PATH` が `/home/makaron8426/oikos/mneme/.hegemonikon/derivative_selections.yaml` に固定されている。特定のユーザー環境とディレクトリ構造を暗黙に仮定しており、ポータビリティを著しく損なう。 (Critical)
- **定理定義の重複**: `DerivativeStateSpace` クラス内で定義された派生（例: `O1_DERIVATIVES`）と、グローバル変数 `THEOREM_DERIVATIVES` の内容が重複している。片方の変更がもう片方に反映されないリスクがある（DRY原則違反かつ内部整合性の暗黙契約）。 (High)
- **型ヒントの保守性**: `select_derivative` 関数の `theorem` 引数の型ヒント `Literal["O1", ...]` が手動で列挙されている。新しい定理が追加された場合、ここも更新する必要があるという暗黙の契約が存在する。 (Medium)
- **外部ライブラリへの暗黙依存**: `google.genai` をインポートし、デフォルトで `LLM_FALLBACK_ENABLED = True` となっている。環境変数 `GEMINI_API_KEY` の存在を暗黙に期待している（エラーハンドリングはあるが、機能が環境に依存する）。 (Low)

## 重大度
Critical
