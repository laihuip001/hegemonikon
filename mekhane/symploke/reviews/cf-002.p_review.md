# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/anamnesis/session_indexer.py`

## 判定
発言（要改善）

## 発見事項
- **Critical**: `client._rpc("exa.language_server_pb.LanguageServerService/GetAllCascadeTrajectories", ...)` の呼び出しで RPC エンドポイント文字列がハードコードされている。`mekhane.ochema.proto.RPC_GET_TRAJECTORIES` 定数を使用すべきであり、単一の真実源 (SSOT) 原則に違反している。
- **High**: `AntigravityClient._rpc` (protected method) を外部から直接呼び出している。公開インターフェース (`session_info` 等) を経由すべきである。
- **High**: `GnosisIndex` の想定スキーマ (`Paper` モデル) と異なる構造の辞書を手動で構築している。特に `content` フィールドの追加や `id` フィールドの欠如があり、`Paper` モデルが定義する正準スキーマと乖離している。
- **High**: `GnosisIndex._table_exists` (protected method) を外部から直接呼び出している。
- **Medium**: `GnosisIndex.add_papers` 内のロジック (Embedding 生成、スキーマフィルタリング、DB 追加) を再実装しており、コードの重複が発生している。`GnosisIndex` 側のロジック変更に追従できないリスクがある。
- **Low**: `sys.path` の操作が相対パス (`Path(__file__).parent.parent.parent`) に依存しており、ファイル配置の変更に対して脆弱である。

## 重大度
Critical
