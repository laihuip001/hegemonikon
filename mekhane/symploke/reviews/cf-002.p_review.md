# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/ergasterion/digestor/pipeline.py`

## 判定
発言（要改善）

## 発見事項
- **Gnosis ストレージ形式の不一致**: `_load_existing_keys` メソッドが `~/.hegemonikon/gnosis/*.json` を参照し、JSON 形式での保存を仮定している。しかし `mekhane/gnosis/lancedb/` の存在は LanceDB への移行を示唆しており、この仮定が崩れている可能性が高い（重複排除が機能しない）。 (High)
- **Sophia ストレージ内部構造への依存**: `_load_existing_keys` および `_deduplicate_by_similarity` メソッドが `sophia.pkl` を直接 `pickle.load` し、`vectors`, `metadata` キーやその内部構造（`List[np.ndarray]`）を仮定している。これは `EmbeddingAdapter` の内部実装への暗黙的な依存であり、アダプタの実装変更（保存形式の変更など）により容易に破損する。 (High)
- **ファイルシステムパスへの暗黙的結合**: `/eat` ワークフロー連携において、`~/.oikos/mneme/.hegemonikon/incoming` などのハードコードされたパスや、`eat_{date}_{id}_{title}.md` というファイル名形式を仮定している。これらは設定や共有定数として管理されておらず、連携先の変更に弱い。 (Medium)
- **Paper モデル定義の重複と不一致リスク**: インポートされている `selector.py` 内で、`mekhane.anamnesis.models.paper` が見つからない場合のフォールバックとして簡易 `Paper` クラスが定義されている。この簡易クラスには `arxiv_id` 等のフィールドが欠けており、`pipeline.py` がこれに依存する処理（重複排除など）を行っている場合、環境によって挙動が変わる恐れがある。 (Medium)

## 重大度
High
