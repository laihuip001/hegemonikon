# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/mcp/hgk_gateway.py`

## 判定
発言（要改善）

## 発見事項
- **Critical**: Gnosis Index パスの不一致。`hgk_gateway.py` が使用する `GnosisIndex` (`mekhane/anamnesis/index.py`) はリポジトリ内の `gnosis_data/lancedb` を参照するが、ゲートウェイ内で使用される `DigestorPipeline` (`mekhane/ergasterion/digestor/pipeline.py`) は `~/.hegemonikon/gnosis` (ホームディレクトリ直下) にデータを書き込むハードコードされたパスを持っている。これにより、Digestor で取り込んだデータを検索できない「スプリットブレイン」状態が発生している。
- **High**: Mneme ディレクトリ定義の不整合。`hgk_gateway.py` 内で `_MNEME_DIR` (ログ・通知用) と `MNEME_DIR` (セッション・データ用) が別々に定義されている。`_MNEME_DIR` は `~/oikos/mneme/.hegemonikon` をデフォルトとする絶対パスだが、`MNEME_DIR` は `PROJECT_ROOT` からの相対パス (`../mneme/.hegemonikon`) である。環境変数 `HGK_MNEME` が未設定の場合、ログとデータが異なる場所に保存される。
- **Medium**: 内部メソッドへの直接依存。`hgk_ask` 関数において、既存セッションへのメッセージ追加のために `AntigravityClient._send_message` および `_poll_response` を直接呼び出している。これらは private メソッド (`_` prefix) であり、クライアントライブラリの内部実装変更により破損するリスクがある。
- **Low**: 引数の省略による暗黙的依存。`hgk_digest_run` が `pipeline.run` を呼び出す際、`max_candidates` 引数を省略しており、`pipeline.py` 側のデフォルト値 (10) に依存している。`hgk_digest_list` では明示的に指定しており、一貫性がない。

## 重大度
Critical
