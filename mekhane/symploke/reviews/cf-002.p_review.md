# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/ochema/cortex_client.py`

## 判定
発言（要改善）

## 発見事項
- **兄弟クラスへの構造的依存 (High)**:
  `LLMResponse` を `mekhane.ochema.antigravity_client` から直接インポートしている。
  `CortexClient` と `AntigravityClient` は対等な実装であるべきだが、片方が他方の内部定義に依存している。`AntigravityClient` の変更が `CortexClient` を破壊するリスクがある。
  推奨: `LLMResponse` を `mekhane/ochema/types.py` 等の共有モジュールに移動すべき。

- **インターフェースの乖離とサイレント失敗 (High)**:
  `ask` メソッドが `system_instruction`, `thinking_budget`, `temperature`, `max_tokens` を受け取るが、対となる `AntigravityClient.ask` はこれらを受け取らない。
  `OchemaService` (統合層) は `AntigravityClient` へのルーティング時にこれらの引数を**黙って破棄**している（暗黙の契約違反）。呼び出し側はパラメータが適用されることを期待するが、LS ルーティング時は無視される。

- **サービス層のバイパス強制 (Medium)**:
  `ask_batch`, `ask_batch_async`, `ask_stream` という独自メソッドを公開している。
  これらは `OchemaService` (統合層) に定義されていないため、`deep_engine.py` や `sweep_engine.py` などの利用側が `OchemaService` を介さず `CortexClient` を直接インスタンス化・依存することを強制している。統合サービスの抽象化を無効化している。

## 重大度
High
