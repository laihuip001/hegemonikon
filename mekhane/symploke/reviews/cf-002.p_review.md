# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/mcp/hgk_gateway.py`

## 判定
発言（要改善）

## 発見事項
- **戻り値型の不一致 (High)**: `hgk_digest_run` 関数内で `pipeline.run()` の戻り値を `dict` と仮定して処理している箇所 (`if isinstance(report, dict):`) があるが、`mekhane/ergasterion/digestor/pipeline.py` の実装では `DigestResult` データクラスを返しているため、この分岐はデッドコードとなっている。
- **フィールド名の不一致 (High)**: `hgk_digest_run` 関数内で `report.get('fetched', 0)` や `report.get('deduplicated', 0)` を参照しようとしているが、`DigestResult` データクラスには `fetched` や `deduplicated` フィールドが存在しない（`total_papers` 等に変更されている）。
- **フォールバック挙動の意図せぬ露出 (Medium)**: 上記の型不一致により `else` 節の `str(report)` が実行され、利用者に内部的なデータクラスの文字列表現 (`DigestResult(...)`) がそのまま露出している。

## 重大度
High
