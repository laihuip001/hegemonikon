# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/anamnesis/session_indexer.py`

## 判定
発言（要改善）

## 発見事項
- (Critical) **Schema Conflict**: `session_indexer.py` は `GnosisIndex.TABLE_NAME` ("knowledge") に `content`, `year` フィールドを含むレコードを保存しようとしているが、同テーブルのスキーマを管理する `Paper` モデル (`mekhane/anamnesis/models/paper.py`) にはこれらのフィールドが存在しない。`Paper` によってテーブルが作成された場合、`session_indexer.py` のスキーマフィルタリングにより `content` が欠落し、サイレントなデータ損失が発生する。逆に `session_indexer.py` がテーブルを作成した場合、`Paper` が必要とする `id`, `source_id` 等のフィールドが欠落する。
- (High) **Private Method Usage**: `AntigravityClient` のプライベートメソッド `_rpc` を直接呼び出している (`client._rpc(...)`)。これはカプセル化違反であり、将来的な内部変更により破損するリスクがある。
- (Medium) **Hardcoded RPC Endpoint**: RPC エンドポイント文字列 `"exa.language_server_pb.LanguageServerService/GetAllCascadeTrajectories"` がハードコードされている。これは `mekhane/ochema/proto.py` の `RPC_GET_TRAJECTORIES` と重複しており、一元管理の原則に反する。
- (Medium) **Implicit Semantic Conflict**: `source` フィールドに "session", "handoff", "conversation", "step", "export" といった値を使用しているが、`Paper` モデルは "arxiv", "semantic_scholar" 等の論文ソースを想定している。同一テーブル内で異なる意味論を持つデータが混在しており、ポリモーフィズムが適切に管理されていない。

## 重大度
Critical
