# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/anamnesis/index.py`

## 判定
発言（要改善）

## 発見事項
- (High) **スキーマ定義の暗黙的競合**: `GnosisIndex` は `knowledge` テーブルが `Paper` データクラスのスキーマに従うことを前提としているが、`mekhane/anamnesis/session_indexer.py` は異なるスキーマ（`id`, `published` 等が欠落、`content` が追加）で同一テーブルに書き込んでいる。テーブル作成順序により、相互にフィールドが欠落（Data Loss）する構造になっている。
- (Medium) **内部実装への依存 (Leaky Abstraction)**: `mekhane/anamnesis/session_indexer.py` が `GnosisIndex.add_papers` を使用せず、`index.db` や `index.TABLE_NAME` を直接参照し、`lancedb` の API を直接操作している。`GnosisIndex` の内部実装変更（DBライブラリ変更やテーブル名変更）に対して脆弱である。
- (Medium) **シングルトン初期化の暗黙的依存**: `Embedder` クラスは引数に基づくシングルトンだが、`session_indexer.py` は `Embedder()` (デフォルト引数) を呼び出すことで `GnosisIndex` 内部の `Embedder` インスタンスとの共有を期待している。`GnosisIndex` 側のデフォルト引数や初期化ロジックが変更されると、意図せず複数のモデルがメモリにロードされるリスクがある。

## 重大度
High
