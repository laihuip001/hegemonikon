# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/mcp/ochema_mcp_server.py`

## 判定
発言（要改善）

## 発見事項
- **カプセル化違反 (High)**: `call_tool` (session_info) にて、`OchemaService` の保護メソッド `_get_ls_client()` および `AntigravityClient` の保護メソッド `_rpc()` を直接呼び出している。これは `OchemaService` の抽象化レイヤーを無視した内部構造への依存であり、将来的な実装変更に対する脆弱性となる。
- **定数のハードコード (Medium)**: RPCエンドポイント文字列 `"exa.language_server_pb.LanguageServerService/GetAllCascadeTrajectories"` が直接記述されている。`mekhane.ochema.proto` で定義されている `RPC_GET_TRAJECTORIES` 定数を使用していないため、プロトコル定義の変更（サービス名やパスの変更）が発生した際に追従できない。
- **ロジックの重複 (Medium)**: セッション一覧の取得と要約ロジックが `AntigravityClient.session_info` と重複して実装されている。正規のクライアント実装が提供する `svc.session_info()` を使用すべきであり、現状はクライアント側のロジック変更（例: ステータス判定や要約生成の仕様変更）が反映されない状態にある。

## 重大度
High
