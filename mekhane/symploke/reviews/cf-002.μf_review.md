# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/mcp/hgk_gateway.py`

## 判定
発言（要改善）

## 発見事項
- **Metadata Mismatch (High)**: `hgk_digest_check` 関数は `eat_*.md` ファイルのフロントマターから `topics:` キーを読み取ろうとしていますが、`mekhane/ergasterion/digestor/pipeline.py` が生成するファイルには `matched_topics:` キーが使用されています。このため、トピック情報が表示されません。
- **Implicit File System Assumption (Medium)**: `hgk_gateway.py` は `MNEME_DIR` を `PROJECT_ROOT.parent / "mneme" / ".hegemonikon"` として計算していますが、`mekhane/ergasterion/digestor/pipeline.py` は `Path.home() / "oikos/mneme/.hegemonikon"` をハードコードしています。プロジェクトディレクトリが `~/oikos/hegemonikon` 以外にある場合、両者が参照するパスが不一致となり、連携が機能しません。
- **Redundant Code (Low)**: `hgk_paper_search` 関数において `authors` リストを結合する際、`isinstance(a, str)` チェックを行っていますが、`SemanticScholarClient` の `Paper` クラス定義では `authors` は常に `list[str]` であることが保証されています。

## 重大度
High

## 修正提案

### Metadata Mismatch の修正
`hgk_digest_check` 関数内のキー読み取りロジックを更新し、`matched_topics` に対応させます。

```python
<<<<<<< SEARCH
                    elif line.startswith("topics:"):
                        topics_str = line.split(":", 1)[1].strip()
=======
                    elif line.startswith("topics:") or line.startswith("matched_topics:"):
                        topics_str = line.split(":", 1)[1].strip()
>>>>>>> REPLACE
```

### Implicit File System Assumption の修正
`hgk_gateway.py` の `MNEME_DIR` 定義は `HGK_MNEME` 環境変数を参照しますが、デフォルト値の算出ロジックが `pipeline.py` と異なります。`pipeline.py` は `Path.home() / "oikos/..."` を使用しているため、整合性を取るために環境変数の明示的な設定を推奨するか、`pipeline.py` 側の修正を検討すべきです。
