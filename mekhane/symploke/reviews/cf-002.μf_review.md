# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/mcp/sophia_mcp_server.py`

## 判定
発言（要改善）

## 発見事項
- **Metadata Key Mismatch (High)**: `kairos_ingest.py` が生成する `conversation` タイプのドキュメントは `title` フィールドを持つが、`sophia_mcp_server.py` は Kairos の検索結果に対して常に `primary_task` フィールドを期待している。このため、会話ログが検索ヒットした場合、結果表示が "N/A" になる。
- **Hardcoded Absolute Paths (Medium)**: `SOPHIA_INDEX` および `KAIROS_INDEX` が特定のユーザー環境 (`/home/makaron8426/...`) に依存した絶対パスでハードコードされている。これは環境非依存という暗黙の契約に違反しており、他の環境（CI/CD、他ユーザー）での動作を保証しない。
- **Inconsistent Data Scope (Medium)**: `SophiaBacklinker`（バックリンク機能で使用）は `antigravity/knowledge` のみをスキャン対象としてハードコードしているが、`sophia_ingest.py`（検索機能で使用）は `mneme` や `kernel` も対象としている。これにより、検索で見つかった KI がバックリンク機能では認識されないという機能間の不整合（契約違反）が発生している。

## 重大度
High
