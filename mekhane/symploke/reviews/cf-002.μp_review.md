# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/anamnesis/session_indexer.py`

## 判定
発言（要改善）

## 発見事項
- **Critical (Schema Mismatch)**: `GnosisIndex.TABLE_NAME` ("knowledge") を共有しているにもかかわらず、`mekhane/anamnesis/models/paper.py` の `Paper` モデルと互換性のないスキーマ（`id`, `source_id`, `published`, `collected_at` 等の欠落、`content` の追加）でデータを投入しています。
  - これは `Paper` モデルが定義するテーブルスキーマとの暗黙の契約に違反しており、スキーマ不整合による検索エラーやデータ破損のリスクがあります。
- **High (Internal Access)**: `GnosisIndex` クラスの内部実装 (`db`, `_table_exists`) に直接依存し、`lancedb` の API を直接呼び出しています。
  - `GnosisIndex` が `add_papers` しか公開していないため、これ以外のデータを投入するために内部構造を仮定してハックしています。`GnosisIndex` の実装変更（DBバックエンド変更など）により容易に破損します。
- **Medium (Internal API)**: `AntigravityClient._rpc` (内部メソッド) を直接呼び出しています (`fetch_all_conversations` 内)。
  - `AntigravityClient` の内部実装が変更された場合、この呼び出しは失敗する可能性があります。

## 重大度
Critical
