# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/mcp/sophia_mcp_server.py`

## 判定
発言（要改善）

## 発見事項
- [High] 依存モジュールの副作用: `sophia_mcp_server.py` は `mekhane/symploke/sophia_backlinker.py` をインポートしているが、`sophia_backlinker.py` は `networkx` が欠如している場合に `sys.exit(1)` を実行する。これはライブラリとして振る舞うべきモジュールがプロセス全体を終了させるという重大な契約違反であり、MCPサーバーの可用性を損なう。
- [Medium] 環境への暗黙の依存: `SOPHIA_INDEX` および `KAIROS_INDEX` のパスが `/home/makaron8426/...` とハードコードされており、特定のユーザー環境を前提としている。これはポータビリティの契約に違反する。
- [Medium] 環境への暗黙の依存: `mekhane` モジュールのインポートパス設定において、`__file__` からの相対パス (`../../`) に依存しており、ファイル配置の変更に対して脆弱である。
- [Low] 非明示的なデータ構造への依存: `EmbeddingAdapter` の検索結果 `metadata` に対して、`ki_name`, `artifact`, `primary_task` などのキーが存在することを前提としている（`.get()` で回避しているが、型安全ではない）。

## 重大度
High
