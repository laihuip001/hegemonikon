# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/fep/attractor_advisor.py`

## 判定
発言（要改善）

## 発見事項
- **Critical (Domain Model Violation)**: K-series 定理定義の不一致 (Hallucination)
  - `_K_THEOREM_KEYWORDS` で定義されている K-series 定理 (K1-K12) は、プロジェクトのドメインモデル (`category.py`, `theorem_attractor.py`, `AGENTS.md`) で定義されている 4定理 (K1-K4) と矛盾しています。
  - 具体的には、K5以降の定理定義が存在しないため、これらに基づくロジックはシステム全体の整合性を破壊しています。
- **Critical (Broken Resource Dependency)**: 存在しないパスへの依存
  - `_retrieve_gnosis` で参照されているパス `gnosis_data/lancedb` はリポジトリルートに存在しません。
  - `mekhane/anamnesis/index.py` と同様のパスロジックを持っていますが、実在しないディレクトリへのハードコードされた依存は実行時エラー (またはサイレントな機能不全) を引き起こします。
- **High (Implicit Path Logic Duplication)**: パス構築ロジックの重複
  - `_retrieve_gnosis` は `Path(__file__).parent.parent.parent / "gnosis_data" / "lancedb"` というパス構築ロジックを独自に持っています。
  - これは `mekhane/anamnesis/index.py` の `LANCE_DIR` 定数と重複しており、保存場所の変更に対する耐性がありません。`mekhane.anamnesis.index.LANCE_DIR` をインポートすべきです。
- **High (Implicit Schema Violation)**: テーブルスキーマ不整合
  - `_retrieve_gnosis` は `knowledge` テーブルから `text` カラムを取得しようとしています (`r.get("text", "")`)。
  - しかし、`mekhane/anamnesis/index.py` の書き込みロジックでは `content` カラムとして保存されており、`text` カラムは存在しません。これにより要約が常に空になります。

## 重大度
Critical
