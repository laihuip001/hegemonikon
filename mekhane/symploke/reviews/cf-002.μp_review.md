# 暗黙契約違反検出者 レビュー

## 対象ファイル
`mekhane/mcp/hgk_gateway.py`

## 判定
発言（要改善）

## 発見事項
- [High] `hgk_ask`: 外部ライブラリ `AntigravityClient` のプライベートメソッド `_send_message`, `_poll_response` を直接呼び出している（カプセル化違反）。将来的にライブラリ内部実装が変更された際に破損するリスクが高い。
- [Medium] `hgk_digest_run`: `DigestorPipeline.run()` の戻り値が `dict` であることを前提としたコード（`isinstance(report, dict)`）が存在するが、実際には `DigestResult` (dataclass) が返却される。その結果、構造化出力処理がスキップされ、`str()` による簡易表示にフォールバックしており、出力品質が劣化している。
- [Medium] `hgk_digest_mark`: `mark_as_processed` の戻り値構造（dict keys: `count`, `moved`, `errors`）に依存している。明示的な型定義がないため、変更に脆弱である。
- [Low] `hermeneus` モジュールへの依存が `hermeneus.src.*` と内部構造を直接参照しており、パッケージ構成の変更に弱い。
- [Low] `GATEWAY_PORT` (8765) がハードコードされており、`digestor_mcp_server.py` 等の他コンポーネントと設定が重複・分散している（Single Source of Truth 違反）。

## 重大度
High
