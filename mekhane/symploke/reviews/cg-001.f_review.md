# ãƒã‚¹ãƒˆæ·±åº¦è­¦å ±è€… ãƒ¬ãƒ“ãƒ¥ãƒ¼

## å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
`mekhane/ochema/cli.py`

## åˆ¤å®š
ç™ºè¨€ï¼ˆè¦æ”¹å–„ï¼‰

## ç™ºè¦‹äº‹é …
- `cmd_chat` (depth 4): `while` > `try` > `if` (High)
- `cmd_ask` (depth 3): `try` > `if` (Medium)
- `cmd_sessions` (depth 3): `if` > `for` (Medium)
- `cmd_episodes` (depth 3): `if` > `for` (Medium)

## é‡å¤§åº¦
High

## ä¿®æ­£æ¡ˆ

### cmd_chat

```python
def cmd_chat(args: argparse.Namespace) -> None:
    """å¯¾è©±ãƒ¢ãƒ¼ãƒ‰ã€‚"""
    client = AntigravityClient(workspace=args.workspace)
    model = args.model
    print(f"ğŸ’¬ OchÄ“ma Chat (model: {model})")
    print(f"   Type 'quit' or Ctrl+C to exit")
    print()

    while True:
        try:
            if not _process_chat_turn(client, model, args.timeout):
                break
        except (KeyboardInterrupt, EOFError):
            print("\nğŸ‘‹ Bye!")
            break
        except Exception as e:
            print(f"âŒ Error: {e}")

def _process_chat_turn(client: AntigravityClient, model: str, timeout: float) -> bool:
    """1ã‚¿ãƒ¼ãƒ³åˆ†ã®ãƒãƒ£ãƒƒãƒˆå‡¦ç†ã€‚ç¶™ç¶šãªã‚‰ True ã‚’è¿”ã™ã€‚"""
    message = input("You> ").strip()
    if not message or message.lower() in ("quit", "exit", "q"):
        print("ğŸ‘‹ Bye!")
        return False

    response = client.ask(message, model=model, timeout=timeout)
    print(f"\nLLM> {response.text}\n")
    return True
```

### cmd_ask

```python
def cmd_ask(args: argparse.Namespace) -> None:
    """LLM ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã€å¿œç­”ã‚’è¡¨ç¤ºã€‚"""
    client = AntigravityClient(workspace=args.workspace)
    message = " ".join(args.message)
    model = args.model

    print(f"ğŸ“¤ Sending to {model}...")
    print(f"   Message: {message[:80]}{'...' if len(message) > 80 else ''}")
    print()

    try:
        response = client.ask(message, model=model, timeout=args.timeout)
    except TimeoutError as e:
        print(f"â° {e}", file=sys.stderr)
        sys.exit(1)
    except RuntimeError as e:
        print(f"âŒ {e}", file=sys.stderr)
        sys.exit(1)

    if response.thinking:
        print("ğŸ’­ Thinking:")
        print(f"   {response.thinking[:200]}...")
        print()
    print("ğŸ’¬ Response:")
    print(response.text)
    print()
    print(f"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")
    print(f"  Model: {response.model}")
    if response.token_usage:
        print(f"  Tokens: {response.token_usage}")
```

### cmd_sessions

```python
def cmd_sessions(args: argparse.Namespace) -> None:
    """ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§/è©³ç´°ã‚’è¡¨ç¤ºã€‚"""
    import json
    client = AntigravityClient(workspace=args.workspace)
    data = client.session_info(cascade_id=getattr(args, "cascade_id", None))

    if "error" in data:
        print(f"âŒ {data['error']}")
        return

    if "sessions" not in data:
        print(json.dumps(data, indent=2, ensure_ascii=False))
        return

    print(f"â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
    print(f"â”‚ ğŸ“‹ Sessions ({data['total']} total, showing latest 20)")
    print(f"â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
    for s in data["sessions"]:
        status_icon = "ğŸŸ¢" if "RUNNING" in s.get("status", "") else "âšª"
        summary = s.get("summary", "")[:40] or "(no summary)"
        print(f"â”‚ {status_icon} {s['cascade_id'][:8]}... steps={s['step_count']:<4} {summary}")
    print(f"â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
```

### cmd_episodes

```python
def cmd_episodes(args: argparse.Namespace) -> None:
    """ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰è¨˜æ†¶ä¸€è¦§/è©³ç´°ã‚’è¡¨ç¤ºã€‚"""
    client = AntigravityClient(workspace=args.workspace)
    data = client.session_episodes(brain_id=getattr(args, "brain_id", None))

    if "error" in data:
        print(f"âŒ {data['error']}")
        return

    if "brains" in data:
        print(f"â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
        print(f"â”‚ ğŸ§  Episode Memory ({data['total_brains']} brains with episodes)")
        print(f"â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
        for b in data["brains"]:
            title = b.get("title", "")[:40] or "(no title)"
            print(f"â”‚ {b['brain_id'][:8]}... episodes={b['episode_count']:<3} {title}")
        print(f"â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
        return

    print(f"Brain: {data.get('brain_id', '')}")
    print(f"Episodes: {data.get('total_episodes', 0)}")
    for ep in data.get("episodes", []):
        print(f"  Step {ep['step']}: {ep['size_bytes']} bytes")
        print(f"    {ep['preview'][:80]}...")
```
