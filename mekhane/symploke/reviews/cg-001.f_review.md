# ネスト深度警報者 レビュー

## 対象ファイル
`mekhane/anamnesis/session_monitor.py`

## 判定
発言（要改善）

## 発見事項
- `daemon_loop`: `while` -> `for` -> `if` のネスト (3段) [Medium]
- `monitor_once`: `for` -> `try` -> `if` のネスト (3段) [Medium]

## 修正提案
`daemon_loop` の内側ループ (`for`) を別関数 `wait_for_next_cycle` に抽出することでネストを削減できます。

```python
def wait_for_next_cycle(interval: int, check_running: callable) -> None:
    for _ in range(interval):
        if not check_running():
            break
        time.sleep(1)

def daemon_loop(client: AntigravityClient, interval: int) -> None:
    # ...
    while running:
        # ...
        wait_for_next_cycle(interval, lambda: running)
```

`monitor_once` の `for` ループ内処理を別関数 `process_single_session` に抽出することで `try-except` のネストを削減できます。

## 重大度
Medium
