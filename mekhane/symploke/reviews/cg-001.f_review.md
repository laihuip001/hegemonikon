# ネスト深度警報者 レビュー

## 対象ファイル
`mekhane/anamnesis/session_indexer.py`

## 判定
発言（要改善）

## 発見事項
- `parse_sessions_from_json` 内の `workspaces` 抽出ループがネスト深度4に達しています (High)
  - `for` -> `for` -> `if` -> `if`
  - 提案: ガード節 (`continue`) を使用してネストを浅くする
- `fetch_all_conversations` 内の会話ターン処理が `try` ブロックを含めると視覚的・認知的にネスト深度4に相当します (Medium)
  - `for` -> `try` -> `for` -> `if`
  - 提案: `try` ブロック内の処理を別関数に切り出す
- `index_handoffs`, `index_conversations`, `index_steps`, `index_exports`, `index_from_json` 内の `filtered_data` 生成におけるリスト内包表記がネストしています (Medium)
  - `[{k: v for ...} for ...]` (リスト内包の中に辞書内包)
  - 提案: 通常の `for` ループに展開するか、ヘルパー関数を使用する

## 重大度
High
