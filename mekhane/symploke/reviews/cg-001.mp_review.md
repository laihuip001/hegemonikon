# ネスト深度警報者 レビュー

## 対象ファイル
`mekhane/mcp/hgk_gateway.py`

## 判定
発言（要改善）

## 発見事項
- **if/for/while/with のネストが4段以上 (High)**:
    - `hgk_search` 関数 (行 301-318): `if mode` → `if ki_base.exists` → `for ki_dir` → `if ki_dir.is_dir` → `if metadata_path.exists` → `if query_lower` と深度6に達しており、認知負荷が高い状態です。
    - `hgk_search` 関数 (行 333-345): `if mode` → `if SESSIONS_DIR.exists` → `for hf` → `if query.lower` と深度4に達しています。
    - `hgk_paper_search` 関数 (行 716): `if len(abstract) > 200` が深度4に達しています。
    - `hgk_digest_check` 関数 (行 777-785): `for` → `if` → `if` の構造で深度4に達しています。
    - `hgk_health` 関数 (行 1152): アラート表示ループ `for a in reversed(recent)` が深度4です。
    - `hgk_health` 関数 (行 1167): Health Score 読み取り `if line.strip()` が深度5 (`if` → `try` → `with` → `for` → `if`) に達しています。
    - `hgk_notifications` 関数 (行 1205): 通知読み取り `if line` が深度4に達しています。

- **try-except 内のネストが3段以上 (Medium)**:
    - `hgk_paper_search`, `hgk_digest_check`, `hgk_health` 内の try ブロック内で、制御構造のネストが深くなっており、エラーハンドリングのスコープ内でロジックが複雑化しています。

## 重大度
High
