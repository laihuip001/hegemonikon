# 認知チャンク分析者 レビュー

## 対象ファイル
`mekhane/ergasterion/digestor/pipeline.py`

## 判定
発言（要改善）

## 発見事項
- **Line 206**: `pk = item.get("primary_key") or item.get("id", "")`
  - 演算子過多 (6 > 5): `.`, `()`, `or`, `.`, `()`, `=`
  - 提案: 変数抽出 `pk_primary = ...; pk_id = ...; pk = pk_primary or pk_id`
  - 重大度: Medium

- **Line 210**: `pk = data.get("primary_key") or data.get("id", "")`
  - 演算子過多 (6 > 5): 同上
  - 重大度: Medium

- **Line 274**: `text = f"{paper.title} {paper.abstract[:500]}"`
  - 演算子過多 (5): `=`, `f-string`, `.`, `.`, `[:]`
  - 提案: `title = paper.title; abstract = paper.abstract[:500]; text = f"{title} {abstract}"`
  - 重大度: Medium

- **Line 354**: `timestamp=datetime.now().isoformat(),`
  - 演算子過多 (5): `=`, `.`, `()`, `.`, `()`
  - 提案: 事前に `now_iso = datetime.now().isoformat()` を計算
  - 重大度: Medium

- **Line 399**: `batch_data = [self._generate_eat_input(c) for c in candidates]`
  - 演算子過多 (6): `=`, `[]`, `.`, `()`, `for`, `in`
  - 提案: 通常の for ループ展開または関数化
  - 重大度: Medium

- **Line 407**: `incoming_dir = Path.home() / "oikos" / "mneme" / ".hegemonikon" / "incoming"`
  - 演算子過多 (7): `/` 連結の多用
  - 提案: `base = Path.home() / "oikos/mneme/.hegemonikon"; incoming_dir = base / "incoming"`
  - 重大度: Medium

- **Line 410**: `timestamp = datetime.now().strftime("%Y%m%d")`
  - 演算子過多 (5): `=`, `.`, `()`, `.`, `()`
  - 重大度: Medium

- **Line 412**: `safe_title = "".join(ch if ch.isalnum() or ch in "-_ " else "" for ch in c.paper.title[:40]).strip().replace(" ", "_")`
  - **重大な認知負荷**: 演算子過多 (18+), 関数呼び出し過多 (4+), 複雑な内包表記
  - 提案: ヘルパー関数 `_sanitize_title(title)` に抽出
  - 重大度: Medium

- **Line 423**: `abstract = c.paper.abstract[:300] if c.paper.abstract else "(no abstract)"`
  - 演算子過多 (8): 条件演算子と属性アクセスの組み合わせ
  - 提案: if 文に展開
  - 重大度: Medium

- **Line 461**: `processed_dir = Path.home() / "oikos" / "mneme" / ".hegemonikon" / "processed"`
  - 演算子過多 (7): `/` 連結
  - 重大度: Medium

- **Line 466**: `targets = [incoming_dir / f for f in filenames if (incoming_dir / f).exists()]`
  - 演算子過多 (10): 内包表記内の条件とパス操作
  - 提案: for ループ展開
  - 重大度: Medium

## 重大度
Medium
