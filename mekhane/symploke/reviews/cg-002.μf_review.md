# 認知チャンク分析者 レビュー

## 対象ファイル
`mekhane/anamnesis/session_indexer.py`

## 判定
発言（要改善）

## 発見事項
- **Line 103, 104, 423**: 1行に5演算以上 (Medium)
  - `datetime.fromisoformat` と `str.replace` の連鎖により、認知負荷が高い。
  - **提案**: 変数抽出による分割
    ```python
    iso_created = created.replace("Z", "+00:00")
    t_created = _dt.fromisoformat(iso_created)
    ```

- **Line 197**: 1行に5演算以上 (Medium)
  - 3つの正規表現グループ抽出とf-string構築が混在しており、視認性が低い。
  - **提案**: グループ抽出を事前に行う
    ```python
    date_part = fname_match.group(1)
    hour = fname_match.group(2)
    minute = fname_match.group(3)
    date_str = f"{date_part} {hour}:{minute}"
    ```

- **Line 534**: 1行に5演算以上 (Medium)
  - Lambda内で属性アクセス、メソッド呼び出し、三項演算子が混在しており、非常に読みづらい。
  - **提案**: 補助関数の導入
    ```python
    def get_step_num(p: Path) -> int:
        return int(p.parent.name) if p.parent.name.isdigit() else 0

    # ...
    key=get_step_num,
    ```

## 重大度
Medium
