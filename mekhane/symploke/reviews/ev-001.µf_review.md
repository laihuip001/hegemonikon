# Series適所配置検査官 レビュー

## 対象ファイル
`mekhane/api/routes/chat.py`

## 判定
発言（要改善）

## 発見事項
- **(Medium) 責務の越境 (Ochema Logic in Route)**: `chat_send` 関数内に Gemini API (`generativelanguage.googleapis.com`) への直接的な HTTP クライアントロジック (URL構築, キー取得, SSE変換) が実装されています。これは「LLMへの接続・運搬」を担う `mekhane/ochema` (例: `GeminiClient` または `OchemaService`) に属すべきロジックであり、API ルート層にあるべきではありません。
- **(Medium) 抽象化の漏洩 (Cortex API Re-implementation)**: `cortex_chat` 関数および `_cortex_chat_from_gemini_format` 関数において、`OchemaService` や `CortexClient` をインポートしているにもかかわらず、それらを単なる認証情報の取得源として利用し、実際の API コール (`cloudcode-pa.googleapis.com`) をルート内で再実装しています。これは `CortexClient` のカプセル化を破壊しています。
- **(Low) 設定の漏洩**: `_get_api_key` 関数がルートモジュール内で直接環境変数を読み込んでいます。これは `mekhane/ochema` 以下の設定管理またはサービス層に隠蔽されるべきです。

## 重大度
Medium
