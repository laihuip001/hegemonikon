# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/api/server.py`

## 判定
発言（要改善）

## 発見事項
- **モジュールレベルの副作用 (重大度: High)**
  - ファイルのトップレベルで `sys.path.insert` を実行しており、このモジュールをインポートするだけでグローバルな環境（`sys.path`）が変更される。これはライブラリやテストからインポートされた場合に予測不能な副作用となる。
  - `app = create_app()` がモジュールレベルで実行されるため、インポート時にルーター登録処理やデータベース接続（依存関係による）が走る可能性がある。

- **例外の隠蔽と予測不能な状態 (重大度: Medium)**
  - `_register_routers` 内で広範な `try-except Exception` ブロックを使用しており、ルーターのインポートエラーや構文エラーを警告ログのみで握りつぶしている。これにより「サーバーは起動したが特定機能が死んでいる」という予測困難なゾンビ状態が発生する。起動時にエラーで落ちる方が予測誤差は小さい。

- **プロセス終了の副作用 (重大度: Medium)**
  - `_cleanup_stale_socket` 関数内で `sys.exit(1)` を直接呼び出している。この関数が将来的にライブラリとして再利用された場合、呼び出し元のプロセスを唐突に終了させるため予測不能性が高い。例外（`RuntimeError` 等）を送出するべきである。

## 重大度
High
