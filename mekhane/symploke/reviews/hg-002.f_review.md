# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/anamnesis/index.py`

## 判定
発言（要改善）

## 発見事項
- 副作用非明示: `Embedder.__init__` で標準出力への書き込みが行われている (High)
- 副作用非明示: `GnosisIndex.add_papers` で標準出力への書き込みが行われている (High)
- 副作用非明示: `GnosisIndex.search` で標準出力への書き込みが行われている (High)
- 副作用非明示: モジュールレベルで `sys.stdout.reconfigure` が実行されており、インポート時にグローバルな副作用がある (High)
- 型予測困難: `GnosisIndex.search` の戻り値が `list[dict]` であり、辞書の構造が不明確 (Medium)
- 型予測困難: `GnosisIndex.stats` の戻り値が `dict` であり、構造が不明確 (Medium)
- 型予測困難: `Embedder.embed` の戻り値が `list` であり、内部要素の型（float）が明示されていない (Medium)
- 暗黙状態変更: `Embedder` クラスが `_instances` を用いたシングルトンパターンを実装しており、グローバルな状態共有が隠蔽されている (Medium)

## 修正提案
- `print` 文を `logger.info` や `logger.debug` に置き換え、ログ出力の副作用を制御可能にする。
- `sys.stdout.reconfigure` を削除するか、アプリケーションのエントリーポイントでのみ実行するように変更する。
- `list[dict]` の代わりに `list[Paper]` や `list[SearchResult]` などの型付きオブジェクト（Pydanticモデルやdataclass）を返すように変更する。
- `embed` メソッドの戻り値型ヒントを `list[float]` に変更する。
- `Embedder` のシングルトン化を廃止するか、依存性注入を利用してインスタンス管理を明示化する。

## 重大度
High
