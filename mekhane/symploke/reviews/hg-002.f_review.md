# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/ochema/antigravity_client.py`

## 判定
発言（要改善）

## 発見事項

- **戻り値の多相性とエラー隠蔽 (Critical)**
  `session_info` メソッドは、引数 `cascade_id` の有無によって戻り値の構造が劇的に変化します（リスト vs 単一オブジェクト）。
  また、`session_info`, `session_read`, `session_episodes` は例外を発生させずに `{"error": "..."}` を返します。これは Python の標準的なエラーハンドリング（try-except）を無効化し、呼び出し元で `if "error" in result:` というチェックを強制するため、予測誤差が極めて高い実装です。

- **コンストラクタの重大な副作用 (High)**
  `__init__` メソッド内で `_detect_ls()` が実行され、システム全体のプロセススキャン (`ps aux`) とポートスキャンが行われます。
  クラスのインスタンス化は軽量であるべきという予測を裏切り、テスト時のモック化も困難にしています。明示的な `connect()` メソッドに分離すべきです。

- **`ask` メソッドの暗黙的状態生成 (Medium)**
  `ask` というメソッド名は単純な問い合わせを示唆しますが、内部で必ず `_start_cascade()` を呼び出し、毎回新しいセッション（Cascade）を作成しています。
  文脈を維持した会話ができない（維持するには非公開メソッドを使う必要がある）仕様は、メソッド名から予測できません。

- **戻り値の型定義不足 (Medium)**
  `get_status`, `list_models`, `quota_status` などが `dict` や `list[dict]` を返していますが、その構造がシグネチャから不明です。
  `TypedDict` や `dataclass` を導入し、IDE の補完や静的解析が効くようにすべきです。

## 重大度
High
