# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/ochema/tests/test_service.py`

## 判定
発言（要改善）

## 発見事項
- **High (Hidden Side Effects)**: `TestModelsRegistry` 内の `test_models_returns_dict` が `models()` メソッドを呼び出しているが、これは内部で `ls_available` プロパティを経由して `AntigravityClient` や `CortexClient` のインスタンス化（および接続試行）を引き起こす。ユニットテストでありながら外部通信（またはその失敗）という重大な副作用を含んでおり、モック化が不十分である。`unittest.mock.patch` を使用してクライアント生成部分をモックすべきである。
- **Medium (Hidden Dependencies)**: ほぼ全てのテストメソッド内で `from mekhane.ochema.service import OchemaService` という遅延インポートが行われている。これはモジュールレベルの依存関係を隠蔽し、テストファイルの依存関係を予測困難にしている。トップレベルでのインポートを使用すべきである。
- **Low (Test Coupling)**: `TestModelRouting` が `_is_claude_model` などの private メソッドを直接テストしている。公開インターフェース (`ask` 等) を通じた振る舞い検証に変更し、実装詳細への結合度を下げるべきである。

## 重大度
High
