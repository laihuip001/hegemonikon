# 予測誤差審問官 レビュー

## 対象ファイル
`hermeneus/src/executor.py`

## 判定
発言（要改善）

## 発見事項
- 副作用非明示 (High): `WorkflowExecutor.execute` (および `run_workflow*`) はデフォルト引数 `audit=True` により、ユーザーのホームディレクトリ (`~/.hermeneus/audit/audit.db`) にSQLiteデータベースを作成・書き込みを行う。関数名 `execute` から永続化の副作用は予測困難であり、驚きを引き起こす。
- 副作用非明示 (High): `execute_sync` は内部で `asyncio.run()` を呼び出すため、既存のイベントループ内で実行すると `RuntimeError` を引き起こす副作用がある。関数シグネチャからはこの制約は読み取れず、環境を変更する副作用として機能する。
- 暗黙状態変更 (Medium): `WorkflowExecutor.registry` プロパティは遅延初期化により `self._registry` を書き換える。プロパティアクセスによる状態変更とモジュールインポートは予測しにくい。
- 暗黙状態変更 (Medium): `get_executor` 関数はグローバル変数 `_default_executor` を変更する。
- 型予測困難 (Medium): `PhaseResult.output` の型が `Any` であり、フェーズごとに異なる（文字列、オブジェクト、IDなど）。呼び出し元は `ExecutionPipeline` の各フィールドの中身を予測するために実装詳細を知る必要がある。

## 重大度
High
