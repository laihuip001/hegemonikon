# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/anamnesis/index.py`

## 判定
発言（要改善）

## 発見事項

### 1. グローバルな副作用 (High)
モジュールレベルで `sys.stdout.reconfigure(encoding="utf-8")` が実行されています。
これは `import mekhane.anamnesis.index` を行っただけで、プロセス全体の `stdout` のエンコーディングを変更してしまうため、予測不能な副作用です。

* **修正提案**: この行を削除するか、`if __name__ == "__main__":` ガード内に移動すべきです。

### 2. 例外の隠蔽 (High)
`get_by_primary_key` メソッドにおいて、`except Exception:` で全ての例外を捕捉し `None` を返しています。
これにより、データベース接続エラーやバグによるクラッシュも「データなし」として扱われてしまい、呼び出し元がエラーの原因を特定できません。

* **修正提案**: `try-except` ブロックを削除するか、特定の例外（`lancedb` のエラーなど）のみを捕捉するように変更すべきです。

### 3. 戻り値の曖昧さ (Medium)
`search` メソッドにおいて、テーブルが存在しない場合や次元数が不一致の場合に、空リスト `[]` を返しています。
これは「検索結果が0件」という正常な状態と区別がつかず、呼び出し元がシステム異常を検知できません。

* **修正提案**: エラー時は `ValueError` などの適切な例外を送出するように変更すべきです。

### 4. 副作用としての出力 (Low)
クラスメソッド内 (`Embedder.__init__`, `GnosisIndex.add_papers` 等) で `print()` 関数が多用されています。
ライブラリコードとしては、標準出力への書き込みは制御できない副作用となります。

* **修正提案**: `logging` モジュールを使用し、`logger.info()` や `logger.warning()` に置き換えるべきです。

## 重大度
High
