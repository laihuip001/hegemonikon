# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/mcp/hgk_gateway.py`

## 判定
発言（要改善）

## 発見事項
- **副作用非明示 (High)**: `hgk_paper_search` 内で `signal.signal(signal.SIGALRM, ...)` を使用しており、プロセス全体のシグナルハンドラを書き換えています。これは関数名から予測できない重大な副作用であり、他の非同期タスクやスレッドに影響を与える可能性があります。
- **例外の予測困難 (Medium)**: エラーハンドリングの方針が一貫していません。多くのツール（例: `hgk_search`, `hgk_ask`）は例外を捕捉してエラーメッセージ（文字列）を返しますが、`hgk_sop_generate` や `hgk_idea_capture` は例外を捕捉せず（あるいは `_traced` で再送出）、呼び出し元に伝播させます。予測可能性の原則（驚きは設計の失敗）に違反しています。
- **暗黙状態変更 (Medium)**: `_check_rate_limit` がグローバル変数 `_ask_timestamps` を直接変更し、`_get_pks_engine` がグローバル変数 `_pks_engine` を初期化・変更しています。これらの状態変更は関数シグネチャからは読み取れず、暗黙的です。
- **型予測困難 (Low)**: `_get_policy` 関数に戻り値の型アノテーションがありません。また `_traced` デコレータが内部関数の型情報を隠蔽（`Any` を返す）しており、静的解析の効果を低下させています。

## 重大度
High
