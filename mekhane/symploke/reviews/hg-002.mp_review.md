# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/symploke/run_specialists.py`

## 判定
発言（要改善）

## 発見事項
- **(High) 関数の副作用が名前から予測不能**: `select_targets` は名前から「既存のリストからの選択」を想起させるが、実際には `git` コマンドの実行 (`subprocess.run`) やファイルシステムへのアクセス (`open`) といった外部副作用を伴う。`detect_targets` や `resolve_targets` が適切。
- **(High) 例外の発生が関数シグネチャから不明**: `create_session` が広範な `Exception` を捕捉し、戻り値の辞書にエラー情報を埋め込んでいるため、呼び出し元は例外処理機構を使えず、戻り値の `error` キーを検査する必要がある。これはPythonの標準的なエラーハンドリングから逸脱しており、驚きをもたらす。
- **(Medium) 戻り値の型が呼び出し元で予測困難**: `create_session` および `run_batch` の戻り値が非構造化された `dict` (`list[dict]`) であり、成功時と失敗時でキー構成が異なる（成功時は `session_id`, 失敗時は `error`）。TypedDict や dataclass を使用すべき。
- **(Medium) 状態変更が暗黙的**: `run_batch` 内の `dispatch_count = [0]` は、クロージャ内での再代入を避けるためのハックであり、可変状態の管理が暗黙的である。`nonlocal` を使用するか、クラス化して状態を明示すべき。
- **(Low) モジュールレベルの副作用**: モジュールトップレベルでの `sys.path.insert` は、このファイルをインポートした際に予期せぬパス変更を引き起こす。

## 重大度
High
