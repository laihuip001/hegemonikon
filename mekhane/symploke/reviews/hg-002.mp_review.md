# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/mcp/hgk_gateway.py`

## 判定
発言（要改善）

## 発見事項
- **(High)** グローバルな `sys.path` の変更: モジュールレベルで `sys.path.insert(0, str(PROJECT_ROOT))` を実行しており、インポート時に予測不能な副作用（パス汚染）を引き起こす。
- **(High)** `get_client` メソッドの副作用: 名前は取得（`get`）を示唆するが、内部で `self._clients` への登録（状態変更）を暗黙的に行っている（`get_or_create` 的な振る舞い）。呼び出し元にとって驚きとなる。
- **(Medium)** 暗黙のグローバル状態管理: `_pks_engine`, `_ask_timestamps`, `POLICY` などがグローバル変数として管理されており、ステートフルな振る舞いが関数の引数/戻り値から予測困難。
- **(Medium)** 例外の隠蔽と戻り値の曖昧さ: 多くのツール関数（`hgk_search`, `hgk_pks_stats` 等）が `try-except` で全例外を捕捉し、エラーメッセージ（文字列）を返している。シグネチャ上は常に正常終了に見え、呼び出し元がエラーハンドリングを予測できない。
- **(Low)** 予防ルールの欠如: `.pre-commit-config.yaml` において `ruff` 等の静的解析ツールが無効化（コメントアウト）されており、副作用や複雑さを検知する仕組みが働いていない。

## 重大度
High
