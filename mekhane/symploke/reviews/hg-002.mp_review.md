# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/ochema/antigravity_client.py`

## 判定
発言（要改善）

## 発見事項
- **__init__ コンストラクタでの重い副作用 (High)**
  `AntigravityClient()` の初期化時に `ps aux` や `ss` などの外部プロセス実行コマンドが走るほか、ローカルポートへのネットワークスキャンとリクエストが発生します。コンストラクタは軽量であるべきという予測を裏切り、初期化だけで失敗や遅延のリスクがあります。

- **戻り値の多義性と予測困難性 (Medium)**
  `session_info` や `session_read` の戻り値が `dict` とされていますが、成功時はデータ構造、失敗時は `{"error": ...}` を返す設計となっており、呼び出し元で型安全に扱うことが困難です。Union型やResult型、あるいは例外送出を使うべきです。

- **暗黙的な外部状態への依存 (Medium)**
  `_detect_ls` メソッドにおいて、明示的な設定値ではなく、実行中のプロセスリストという隠れた外部状態に依存して接続先を決定しています。これにより、環境による挙動の差異が予測しづらくなっています。

- **シグネチャに現れない例外 (Low)**
  `ask` メソッドが `TimeoutError` を、`__init__` が `RuntimeError` を送出する可能性がありますが、これらがドキュメントやシグネチャ（Raises）に明記されていません。

- **予防ルールの不備 (Low)**
  `.pre-commit-config.yaml` において `ruff` 等の静的解析・フォーマッタが無効化されており、コードの予測可能性を担保するガードレールが機能していません。

## 重大度
High
