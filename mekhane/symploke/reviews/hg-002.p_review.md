# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/anamnesis/index.py`

## 判定
発言（要改善）

## 発見事項
- **副作用非明示 (High)**: `Embedder.__init__`, `GnosisIndex.add_papers`, `GnosisIndex.search` 内で `print()` 関数による標準出力への書き込みが多用されています。ライブラリコード内での直接的な print 出力は予測困難な副作用です。ロガーを使用すべきです。
- **副作用非明示 (High)**: モジュールレベルでの `sys.stdout.reconfigure(encoding="utf-8")` は、インポートするだけでグローバルな標準出力の設定を変更してしまいます。
- **型予測困難 (Medium)**: `GnosisIndex.search`, `GnosisIndex.stats`, `GnosisIndex.get_by_primary_key` の戻り値が `dict` や `list[dict]` となっており、具体的な構造（キーや値の型）がシグネチャから予測できません。TypedDict や Pydantic モデルの使用が推奨されます。
- **型予測困難 (Medium)**: `Embedder.embed` の戻り値が `list` となっていますが、`list[float]` と明示すべきです。
- **暗黙状態変更 (Medium)**: `Embedder` クラスが `__new__` メソッドでシングルトンパターンを実装しており、グローバルな状態を共有しています。明示的な依存性の注入や管理が望まれます。
- **例外の隠蔽 (Medium)**: `GnosisIndex.get_by_primary_key` や `_load_primary_keys` などで `except Exception: pass` (または `return None`) が行われており、エラーの原因（バグなのか想定内の欠損なのか）が呼び出し元から区別・予測できません。

## 重大度
High
