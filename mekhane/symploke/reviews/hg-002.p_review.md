# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/anamnesis/session_indexer.py`

## 判定
発言（要改善）

## 発見事項
- **副作用非明示 (High)**: `sys.path.insert(0, ...)` がモジュールレベルで実行されており、インポート時にグローバルな副作用を引き起こす。
- **副作用非明示 (High)**: `fetch_all_conversations`, `index_handoffs`, `index_steps` など、ロジック関数内で `print()` が多用されており、呼び出し元が制御できない標準出力への副作用がある。
- **副作用非明示 (High)**: `index_from_api` 内で `subprocess.run` により外部スクリプト (`agq-sessions.sh`) を実行しており、Pythonコード外への隠れた依存と副作用がある。
- **型予測困難 (Medium)**: `parse_sessions_from_json`, `fetch_all_conversations`, `parse_step_outputs` 等の戻り値が `list[dict]` や `dict` であり、キーや値の構造が明示されていない（TypedDictやデータクラスが未使用）。
- **暗黙状態変更 (Medium)**: `Path.home() / "oikos" / ...` や `Path.home() / ".gemini" / ...` のように、ユーザーのホームディレクトリへのハードコードされた依存があり、実行環境への暗黙的な仮定がある。
- **暗黙状態変更 (Medium)**: 日付パースや `index._table_exists()` 後の処理などで `except Exception: pass` が使われており、エラー発生時に静かに失敗するため、振る舞いが予測困難である。

## 重大度
High
