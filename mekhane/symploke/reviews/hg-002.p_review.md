# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/anamnesis/session_indexer.py`

## 判定
発言（要改善）

## 発見事項
- **戻り値の型が予測困難 (Medium)**
  `parse_sessions_from_json`, `sessions_to_records`, `parse_handoff_md` 等で `list[dict]` や `dict` が多用されている。辞書のキーや値の型がシグネチャから予測できず、呼び出し元での驚き（実行時エラー）の原因となる。`TypedDict` や `dataclass` の使用が望ましい。

- **暗黙の状態依存 (Medium)**
  `_HANDOFF_DIR`, `_BRAIN_DIR` 等で `Path.home()` を含む絶対パスがモジュールレベル定数として定義されている。これにより、特定のディレクトリ構成を持つ環境への暗黙的な依存が生じている。

- **例外の隠蔽による驚き (Low)**
  `fetch_all_conversations` で `except Exception` ブロックによりエラーがログ出力のみで握りつぶされている。呼び出し元は処理が部分的または完全に失敗したことを検知できず、期待したデータが存在しないという驚きに直面する可能性がある。

- **隠れた外部プロセス依存 (Low)**
  `index_from_api` 関数内で `subprocess.run` を使用して `agq-sessions.sh` を実行している。Python 関数としてのインターフェースからは、外部シェルスクリプトへの依存やサブプロセス実行という副作用が予測しにくい。

## 重大度
Medium
