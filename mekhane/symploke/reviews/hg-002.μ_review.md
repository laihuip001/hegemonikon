# PROOF: [L2/品質] <- mekhane/symploke/reviews/ HG-002.μ
# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/symploke/run_specialists.py`

## 判定
発言（要改善）

## 発見事項

### 1. `select_targets` における暗黙のフォールバック (High)
**分類**: 副作用非明示
**説明**: `git-diff` モード指定時に `subprocess` が失敗（タイムアウトやコマンド不在）すると、例外を送出せず、警告を出した上で `fixed_target`（デフォルト値など）を返却します。
ユーザーが明示的に動的選択を意図したにもかかわらず、静的なデフォルト動作に切り替わるのは「驚き」であり、意図しないファイルを処理するリスクがあります。失敗は明示的であるべきです。

### 2. `create_session` における広範な例外捕捉 (High)
**分類**: 例外の発生が関数シグネチャから不明（逆パターン：捕捉しすぎ）
**説明**: `try...except Exception` ブロックにより、ネットワークエラーだけでなく、関数内のロジックエラー（`AttributeError` 等）や `generate_prompt` のバグも全て「セッション作成エラー」として処理され、辞書の `error` キーに格納されます。
これにより、本来修正すべきバグがランタイムエラーとして隠蔽され、デバッグが困難になります。

### 3. `create_session` の戻り値構造の不確定性 (Medium)
**分類**: 戻り値の型が呼び出し元で予測困難
**説明**: 戻り値が `dict` ですが、成功時は `{ "session_id": ..., "url": ... }`、失敗時は `{ "error": ... }` とキー構成が完全に異なります。
呼び出し元でキーの有無を確認する分岐が必要となり、型安全性と予測可能性が低下しています。`TypedDict` や `dataclass`、あるいは `Result` パターンの導入が望ましいです。

### 4. `run_batch` のグローバル状態依存 (Medium)
**分類**: 暗黙状態変更 / 依存
**説明**: 関数引数として受け取らずに、モジュールレベルのグローバル変数 `API_KEYS` を直接参照しています。
関数の振る舞いが外部環境（環境変数の読み込み状態）に暗黙的に依存しており、テストや再利用が困難です。引数として `api_keys` を受け取る設計にすべきです。

## 重大度
High
