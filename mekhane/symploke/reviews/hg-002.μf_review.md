# PROOF: [L2/品質] <- mekhane/anamnesis/index.py

# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/anamnesis/index.py`

## 判定
発言（要改善）

## 発見事項
- **例外の握りつぶし (High)**: `GnosisIndex.get_by_primary_key` および `_load_primary_keys` 内で `except Exception:` を使用し、すべての例外を捕捉して `None` を返すか `pass` しています。これにより、データベース接続エラーやクエリ構築エラーなどの予期せぬ障害が発生しても、呼び出し元はその理由を知ることができず、システムの挙動が予測不能になります。特定の例外を捕捉するか、エラーをログ出力しつつ再送出するべきです。
- **エラー状態の曖昧化 (High)**: `GnosisIndex.search` において、ベクトル次元の不一致が発生した場合に、例外を送出せず `print` 文で警告を出して空リスト `[]` を返しています。これにより、呼び出し元は「検索結果が0件だった」のか「検索設定エラーが発生した」のかを区別できず、予測誤差が生じます。明確なエラー（`ValueError` など）を送出すべきです。
- **暗黙の副作用（標準出力） (Medium)**: `Embedder` クラスおよび `GnosisIndex` クラスのメソッド内で `print()` 文が多用されています（例: `Embedder.__init__`, `GnosisIndex.add_papers`）。ライブラリコードとして、呼び出し元の標準出力を汚染する副作用は予測困難です。`logging` モジュールを使用して、ログレベルに応じた出力を行うべきです。
- **戻り値の予測困難 (Medium)**: `GnosisIndex.search` が次元不一致時に `[]` を返し、`get_by_primary_key` が例外発生時に `None` を返す挙動は、シグネチャからは読み取れません（型ヒントはありますが、エラーケースの予測可能性が低いです）。

## 重大度
High
