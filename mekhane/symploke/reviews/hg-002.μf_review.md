# 予測誤差審問官 レビュー

## 対象ファイル
`mekhane/anamnesis/cli.py`

## 判定
発言（要改善）

## 発見事項

### 1. モジュールレベルでの `sys.path` 書き換え (High)
トップレベルで `sys.path.insert` を行っている。
これはモジュールをインポートしただけで実行環境のパスが変わるという「驚き」をもたらす重大な副作用であり、設計上の失敗である。
`python -m mekhane.anamnesis.cli` として実行すればこのハックは不要である。

### 2. `update_state` の不透明な副作用と例外の握りつぶし (Medium)
関数名が一般的すぎる上、以下の予測困難な挙動を含む：
- グローバル定数 `DATA_DIR` `STATE_FILE` への依存
- ファイルシステムへの書き込み（ディレクトリ作成含む）
- `except Exception: pass` による完全なエラー隠蔽

これは「関数を呼んだが何も起きなかった（実は失敗していた）」という予測誤差を生む。
`update_last_collected_at(path: Path) -> None` のように明示的にすべきである。

### 3. 関数内インポートによる依存関係の隠蔽 (Medium)
`cmd_collect` 等で `ArxivCollector` などを関数内でインポートしている。
起動速度への配慮と思われるが、モジュールの依存関係が静的解析から隠蔽され、
「この関数が何に依存しているか」がシグネチャやファイル先頭から予測できない。
依存関係はトップレベルで宣言するか、明示的な遅延ロード機構を使うべきである。

### 4. 戻り値の型アノテーション欠如 (Low)
`cmd_*` 関数群に戻り値の型（`-> int`）が明示されていない。
呼び出し元は終了コードが返ってくることをコードを読まなければ確信できない。

## 重大度
High
