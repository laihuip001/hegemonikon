# ストア派制御審判 レビュー

## 対象ファイル
`mekhane/fep/derivative_selector.py`

## 判定
発言（要改善）

## 発見事項
- **外部API呼び出しのタイムアウト未設定 (High)**: `_select_with_llm` 関数内の `GEMINI_CLIENT.models.generate_content` 呼び出しにおいて、タイムアウトが設定されていません。外部サービスの応答遅延により、プロセスが無期限にブロックされるリスクがあります。`config` パラメータ等を使用して明示的なタイムアウトを設定すべきです。
- **外部サービス依存の再試行メカニズム欠如 (Medium)**: LLM呼び出しが一発勝負となっており、一時的なネットワークエラーやサーバー過負荷（503等）に対する再試行（リトライ）ロジックが存在しません。フォールバックは存在しますが、過渡的な障害に対する堅牢性を高めるために、バックオフ付きのリトライを導入することが望ましいです。
- **ログファイル破損時のリカバリ戦略不足 (Medium)**: `_log_selection` 関数において、YAMLファイルの読み込みに失敗した場合（破損など）、空のリストとして初期化され、その後上書き保存されます。これにより過去のログデータが消失する可能性があります。破損ファイルを退避（リネーム）して新規作成する等のリカバリ戦略を追加すべきです。

## 重大度
High
