# ストア派制御審判 レビュー

## 対象ファイル
`mekhane/ergasterion/digestor/pipeline.py`

## 判定
発言（要改善）

## 発見事項
- **外部API呼び出しのタイムアウト欠如 (High)**: `_fetch_from_gnosis` 内の `collector.search` 呼び出しにおいて、タイムアウトが設定されていません。`ArxivCollector` 側で制御されていない場合、ネットワーク遅延によりプロセスが無限にハングするリスクがあります。
  - *修正提案*: `collector.search` に `timeout` 引数を追加し、`requests.get(..., timeout=10)` のように明示的なタイムアウトを設定してください。
- **ネットワーク障害時のフォールバック欠如 (Medium)**: `_fetch_from_gnosis` で取得に失敗した場合、単にそのクエリをスキップし、結果として空または不完全なリストを返します。
  - *修正提案*: 取得失敗時にローカルキャッシュ（過去の成功レスポンス）を読み込む、あるいは代替ソース（Semantic Scholar等）へ切り替えるロジックを追加してください。
- **ファイルI/O失敗時のリカバリ戦略なし (Medium)**: `_save_report` および `_generate_eat_batch` において、ファイル書き込み（`open`, `json.dump`）が例外処理で保護されていません。
  - *修正提案*: `try-except` ブロックで囲み、書き込み失敗時には一時ディレクトリへの退避やエラーログへの記録を行い、プロセスがクラッシュしないようにしてください。
- **Circuit Breakerの欠如 (Medium)**: 外部サービス（arXiv）への依存がありますが、連続失敗時にリクエストを遮断する Circuit Breaker パターンが実装されていません。障害時にリトライを繰り返すことで、外部サービスへの負荷増大や自身の応答遅延を招く恐れがあります。
  - *修正提案*: 連続エラー回数をカウントし、閾値を超えた場合は一定時間 `collector.search` を呼び出さずに即座にエラーを返す仕組み（Circuit Breaker）を導入してください。

## 重大度
High
