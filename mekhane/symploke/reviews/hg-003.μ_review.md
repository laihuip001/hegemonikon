# ストア派制御審判 レビュー

## 対象ファイル
`mekhane/anamnesis/session_monitor.py`

## 判定
発言（要改善）

## 発見事項
- **外部API呼び出しにタイムアウト設定なし (High)**: `monitor_once` 関数内で `client.session_info()` および `client.session_read()` を呼び出す際、明示的な `timeout` 引数が指定されていません。`AntigravityClient` のデフォルト値に依存しており、制御不能な遅延に対する防御が不十分です。
- **外部サービス依存で retry/circuit breaker なし (Medium)**: `daemon_loop` は `client` インスタンスを再利用し続けますが、LS（Language Server）プロセスが再起動した場合（PID/ポート変更時）に再接続するロジックが含まれていません。ネットワークやプロセス接続障害時の再試行（Retry）やサーキットブレーカー機能が欠如しており、一度接続が切れると永続的にエラーとなります。
- **ファイルI/O失敗時のリカバリ戦略なし (Medium)**: `save_state` 関数には `try...except` ブロックやリカバリ処理（例：一時ファイルへの書き込み、リトライ）が存在しません。書き込み失敗時にデータが失われるリスクがあり、制御不能なディスクエラーに対する備えが不足しています。
- **ネットワーク障害時のフォールバック欠如 (Medium)**: `monitor_once` 関数において、`client.session_info()` がエラーを返した場合、単に現状維持（`return state`）するのみで、代替手段（例：キャッシュからの復元や別手段でのセッション確認）といったフォールバック策が講じられていません。

## 重大度
High
