# ストア派制御審判 レビュー

## 対象ファイル
`mekhane/anamnesis/session_monitor.py`

## 判定
発言（要改善）

## 発見事項
- **外部API呼び出しのタイムアウト制御欠如 (High)**
  - `monitor_once` 冒頭の `client.session_info()` 呼び出しは、`AntigravityClient` の内部タイムアウト設定（10秒）に依存しているものの、呼び出し元としての例外ハンドリングがなく、ネットワーク遅延やハングアップ時にプロセスがクラッシュする（特に `--once` モード）。
  - **改善案**: `try-except` ブロックで囲み、タイムアウトや接続エラー時は空の結果を返すか、適切にエラーログを出力して続行する。
- **ファイルI/Oのリカバリ戦略欠如 (Medium)**
  - `save_state` 関数において、ファイルシステムエラー（容量不足、権限エラーなど）に対する例外処理がない。特に `signal_handler` 内での呼び出し時にクラッシュすると、正常な終了処理が阻害される。
  - **改善案**: `save_state` 内で `OSError` をキャッチし、エラーログを出力する（クリティカルなパスではないため、ログのみで十分な場合が多い）。
- **フォールバック/サーキットブレーカーの欠如 (Medium)**
  - LSサーバーへの接続が連続して失敗する場合のバックオフ戦略がなく、定間隔（30秒）でリトライし続けるため、ログがスパム化する可能性がある。
  - **改善案**: エラーが連続した場合に待機時間を指数関数的に延ばす（例: 30s -> 60s -> 120s...）バックオフロジックを導入する。

## 重大度
High
