# ストア派制御審判 レビュー

## 対象ファイル
`mekhane/anamnesis/session_indexer.py`

## 判定
発言（要改善）

## 発見事項
- (High) `index_from_api` 関数内の `subprocess.run` に `timeout` 引数が設定されていません。外部スクリプトの無限待機を防ぐため、適切なタイムアウト値（例: 300秒）を設定してください。
- (High) `fetch_all_conversations` 関数内の `client._rpc` 呼び出しが `try-except` で保護されておらず、通信エラー時にプロセス全体がクラッシュします。`AntigravityClient` の呼び出しを `try-except` で囲み、適切なエラーハンドリング（ログ出力とリトライまたはスキップ）を追加してください。
- (Medium) `index_handoffs` および `index_exports` 関数での `[parse_...(f) for f in md_files]` による一括処理は、単一ファイルの読み込みエラーで全体を停止させます。ループ内で個別に `try-except` を行い、失敗したファイルをスキップする構造に変更してください。
- (Medium) `index_from_json` 関数内の `json.load(f)` が `try-except` で保護されていません。破損したJSONファイルによるクラッシュを防ぐため、`json.JSONDecodeError` を捕捉してください。
- (Medium) `GnosisIndex` (LanceDB) への書き込みや `Embedder` の呼び出しが保護されていません。これらは外部要因（ディスクフル、メモリ不足、モデルロード失敗）で失敗する可能性があります。バッチ処理のループ内で `try-except` を使用し、部分的な失敗を許容するか、安全に終了するようにしてください。

## 重大度
High
