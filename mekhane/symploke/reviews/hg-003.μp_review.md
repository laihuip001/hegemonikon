# ストア派制御審判 レビュー

## 対象ファイル
`mekhane/api/routes/chat.py`

## 判定
発言（要改善）

## 発見事項
- **External service dependency without retry/circuit breaker (High)**:
  - `stream_proxy` (Gemini) と `stream_cortex` (Cortex) は `httpx` を直接使用しており、一時的なエラー（5xx やネットワーク瞬断）に対するリトライロジックが欠如しています。`CortexClient` が実装している指数バックオフのような回復機構がありません。
- **External API call without timeout setting (High)**:
  - `cortex_chat` 内で同期メソッド `cortex._get_token()` および `cortex._get_project()` を直接呼び出しています。これらは asyncio イベントループをブロックするため、他の並行リクエストのタイムアウト制御不能を引き起こします。
- **Lack of fallback during network failure (Medium)**:
  - 全てのエンドポイントにおいて、主要なモデル/プロバイダがダウンした際のフォールバック（代替モデルへの切り替えや縮退運転）が実装されていません。
- **External API call without timeout setting (Low)**:
  - `_claude_chat_from_gemini_format` は `svc.ask_async` を呼び出す際に明示的な `timeout` を指定しておらず、サービス層のデフォルト値に依存しています。

## 重大度
High
