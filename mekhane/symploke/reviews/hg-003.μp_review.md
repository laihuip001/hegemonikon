# ストア派制御審判 レビュー

## 対象ファイル
`mekhane/ochema/cortex_client.py`

## 判定
発言（要改善）

## 発見事項
- (Medium) `ask_stream`メソッドにリトライロジックが欠如している。`ask`メソッドは`_call_api`経由でネットワーク障害時のリトライ（制御不能な外部要素への対策）を行っているが、ストリーミング接続時は初回接続失敗で即座に例外を送出する。
- (Medium) `_get_token`メソッドにおけるキャッシュファイル（`_TOKEN_CACHE`）の読み書き操作に例外処理がない。ファイルシステムの状態（権限、ディスク容量など）は制御不能な要素であり、キャッシュ読み書きの失敗がトークン取得全体の失敗（クラッシュ）につながる構造になっている。キャッシュは最適化手段であり、失敗時はAPI経由の取得にフォールバックすべきである。

## 重大度
Medium
