# ストア派制御審判 レビュー

## 対象ファイル
`mekhane/anamnesis/session_indexer.py`

## 判定
発言（要改善）

## 発見事項
- **subprocess.run のタイムアウト欠如 (High)**: `index_from_api` 内の `subprocess.run` に `timeout` 引数が指定されておらず、外部スクリプトがハングした場合に復帰できません。
- **一括処理におけるファイルI/Oのリカバリ欠如 (Medium)**: `index_handoffs` や `index_exports` において、`[parse_...(f) for f in md_files]` というリスト内包表記を使用しているため、1つのファイル読み込みに失敗すると処理全体がクラッシュします。個別の `try-except` でスキップする構造が必要です。
- **外部API呼び出し(Embedder)の例外処理欠如 (Medium)**: `index_handoffs`, `index_conversations` などで `embedder.embed_batch` を呼び出していますが、ネットワークエラーやAPI制限に対する `try-except` ブロックやリトライロジックがありません。
- **RPC呼び出しの例外処理欠如 (Medium)**: `fetch_all_conversations` の冒頭で `client._rpc` を呼び出していますが、ここが失敗すると関数全体がクラッシュします。
- **JSON読み込みの例外処理欠如 (Medium)**: `index_from_json` 内の `json.load` に `try-except` がなく、破損したJSONファイルでクラッシュします。

## 重大度
High
