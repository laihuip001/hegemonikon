# 定理整合性監査官 レビュー

## 対象ファイル
`mekhane/ergasterion/digestor/pipeline.py`

## 判定
発言（要改善）

## 発見事項
- **(Medium) 定理逸脱**: ファイル冒頭に `PROOF` 行（定理参照）が欠如しています。`PROOF.md` に従い `[L2]` または適切な O/H/A/S/P/K 座標を明記すべきです。
- **(Medium) スキルが定理参照を持たない**: 各メソッド（スキル）の `# PURPOSE` 行に定理参照（例: `[A0]`）が含まれていません。
- **(Low) フロントマター欠如**: `_generate_eat_batch` 内で生成される `.md` ファイルのフロントマターに `hegemonikon` フィールドが欠如しています。

## 修正提案

```python
<<<<<<< SEARCH
from .selector import DigestorSelector, DigestCandidate


# PURPOSE: の統一的インターフェースを実現する
@dataclass
# PURPOSE: 消化パイプライン実行結果
class DigestResult:
=======
# PROOF: [A0] <- mekhane/ergasterion/digestor/pipeline.py

from .selector import DigestorSelector, DigestCandidate


# PURPOSE: [A0] の統一的インターフェースを実現する
@dataclass
# PURPOSE: [A0] 消化パイプライン実行結果
class DigestResult:
>>>>>>> REPLACE
<<<<<<< SEARCH
    # PURPOSE: Args:
    def __init__(
        self,
        output_dir: Optional[Path] = None,
        selector: Optional[DigestorSelector] = None,
    ):
=======
    # PURPOSE: [A0] Args:
    def __init__(
        self,
        output_dir: Optional[Path] = None,
        selector: Optional[DigestorSelector] = None,
    ):
>>>>>>> REPLACE
<<<<<<< SEARCH
    # PURPOSE: デフォルトの出力ディレクトリ
    def _default_output_dir(self) -> Path:
=======
    # PURPOSE: [A0] デフォルトの出力ディレクトリ
    def _default_output_dir(self) -> Path:
>>>>>>> REPLACE
<<<<<<< SEARCH
    # PURPOSE: Gnosis から論文を取得
    def _fetch_from_gnosis(
        self, topics: Optional[list[str]] = None, max_papers: int = 50
    ) -> list:
=======
    # PURPOSE: [A0] Gnosis から論文を取得
    def _fetch_from_gnosis(
        self, topics: Optional[list[str]] = None, max_papers: int = 50
    ) -> list:
>>>>>>> REPLACE
<<<<<<< SEARCH
    # PURPOSE: 既存インデックスとの重複排除
    def _deduplicate_against_indices(self, papers: list) -> list:
=======
    # PURPOSE: [A0] 既存インデックスとの重複排除
    def _deduplicate_against_indices(self, papers: list) -> list:
>>>>>>> REPLACE
<<<<<<< SEARCH
    # PURPOSE: 既存インデックスから primary_key を収集
    def _load_existing_keys(self) -> set[str]:
=======
    # PURPOSE: [A0] 既存インデックスから primary_key を収集
    def _load_existing_keys(self) -> set[str]:
>>>>>>> REPLACE
<<<<<<< SEARCH
    # PURPOSE: ベクトル類似度による重複検出
    def _deduplicate_by_similarity(self, papers: list) -> list:
=======
    # PURPOSE: [A0] ベクトル類似度による重複検出
    def _deduplicate_by_similarity(self, papers: list) -> list:
>>>>>>> REPLACE
<<<<<<< SEARCH
    # PURPOSE: /eat ワークフロー用の入力を生成
    def _generate_eat_input(self, candidate: DigestCandidate) -> dict:
=======
    # PURPOSE: [A0] /eat ワークフロー用の入力を生成
    def _generate_eat_input(self, candidate: DigestCandidate) -> dict:
>>>>>>> REPLACE
<<<<<<< SEARCH
    # PURPOSE: 消化先ワークフローを推薦
    def _suggest_digest_targets(self, candidate: DigestCandidate) -> list[str]:
=======
    # PURPOSE: [A0] 消化先ワークフローを推薦
    def _suggest_digest_targets(self, candidate: DigestCandidate) -> list[str]:
>>>>>>> REPLACE
<<<<<<< SEARCH
    # PURPOSE: 消化パイプライン実行
    def run(
=======
    # PURPOSE: [A0] 消化パイプライン実行
    def run(
>>>>>>> REPLACE
<<<<<<< SEARCH
    # PURPOSE: 消化レポートを保存
    def _save_report(self, result: DigestResult) -> Path:
=======
    # PURPOSE: [A0] 消化レポートを保存
    def _save_report(self, result: DigestResult) -> Path:
>>>>>>> REPLACE
<<<<<<< SEARCH
    # PURPOSE: /eat 用のバッチ入力を生成
    def _generate_eat_batch(self, candidates: list[DigestCandidate]) -> None:
=======
    # PURPOSE: [A0] /eat 用のバッチ入力を生成
    def _generate_eat_batch(self, candidates: list[DigestCandidate]) -> None:
>>>>>>> REPLACE
<<<<<<< SEARCH
            # D: /eat Phase 0 対応の強化テンプレート
            content = f"""---
title: "{c.paper.title}"
source: {c.paper.source}
url: {c.paper.url or 'N/A'}
score: {c.score:.2f}
matched_topics: [{', '.join(c.matched_topics)}]
digest_to: [{targets_str}]
generated: {timestamp}
---
=======
            # D: /eat Phase 0 対応の強化テンプレート
            content = f"""---
hegemonikon:
  ver: 1.0
  type: digest
title: "{c.paper.title}"
source: {c.paper.source}
url: {c.paper.url or 'N/A'}
score: {c.score:.2f}
matched_topics: [{', '.join(c.matched_topics)}]
digest_to: [{targets_str}]
generated: {timestamp}
---
>>>>>>> REPLACE
<<<<<<< SEARCH
# PURPOSE: 消化完了ファイルを processed/ に移動
def mark_as_processed(filenames: list[str] | None = None) -> dict:
=======
# PURPOSE: [A0] 消化完了ファイルを processed/ に移動
def mark_as_processed(filenames: list[str] | None = None) -> dict:
>>>>>>> REPLACE
<<<<<<< SEARCH
# PURPOSE: CLI エントリポイント
def main():
=======
# PURPOSE: [A0] CLI エントリポイント
def main():
>>>>>>> REPLACE
```

## 重大度
Medium
