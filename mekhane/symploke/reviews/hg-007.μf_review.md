# å…¬ç†åº§æ¨™æ•´åˆæ¤œæŸ»å®˜ ãƒ¬ãƒ“ãƒ¥ãƒ¼

## å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
`mekhane/periskope/cli.py`

## åˆ¤å®š
ç™ºè¨€ï¼ˆè¦æ”¹å–„ï¼‰

## ç™ºè¦‹äº‹é …
- **Critical**: Coordinate Mismatch (Documentation vs Implementation)
    - `.agent/workflows/sop.md` (Workflow) relies on `mekhane/periskope/cli.py` as the default execution path ("v8.0"), but the file does not exist.
    - `mekhane/periskope/PROOF.md` acknowledges that the CLI (S5) is "Not Started".
    - This breaks the "Form Follows Function" principle: The form (code) is missing for the function (workflow) defined in documentation.

- **High**: Missing Implementation
    - The `S5` milestone (PeriskopÄ“ Engine/CLI) is marked as "Not started", yet the system behaves as if it exists.

## ä¿®æ­£ã‚³ãƒ¼ãƒ‰ææ¡ˆ

ä»¥ä¸‹ã¯ã€`sop.md` ã®è¦æ±‚ã‚’æº€ãŸã™ `mekhane/periskope/cli.py` ã®å®Ÿè£…æ¡ˆã§ã™ã€‚
`SearXNGSearcher` ã‚’çµ±åˆã—ã€ä»–ã®ã‚½ãƒ¼ã‚¹ã¯ã‚¹ã‚¿ãƒ–åŒ–ã—ã¦ã„ã¾ã™ã€‚

```python
# PROOF: [L2/MekhanÄ“] <- mekhane/periskope/cli.py
"""
PROOF: [L2/MekhanÄ“] PeriskopÄ“ CLI â€” Deep Research Engine Interface

A0 (FEP) â†’ Active Inference (Action) â†’ Search & Synthesis â†’ PeriskopÄ“ CLI

# PURPOSE: PeriskopÄ“ CLI â€” Deep Research Engine Interface
"""

import argparse
import asyncio
import sys
from pathlib import Path

# Adjust path to include project root
_PERISKOPE_DIR = Path(__file__).resolve().parent
_MEKHANE_DIR = _PERISKOPE_DIR.parent
_HEGEMONIKON_ROOT = _MEKHANE_DIR.parent
if str(_HEGEMONIKON_ROOT) not in sys.path:
    sys.path.insert(0, str(_HEGEMONIKON_ROOT))

from mekhane.periskope.models import PeriskopeConfig, SearchSource
from mekhane.periskope.searchers.searxng import SearXNGSearcher


async def run_periskope(query: str, sources: list[str], max_results: int = 10):
    """Run PeriskopÄ“ pipeline (Phase 1: Search only for now)."""
    print(f"## ğŸ” PeriskopÄ“: \"{query}\"")
    print(f"Sources: {', '.join(sources)}")
    print()

    results = []

    # 1. SearXNG
    if "searxng" in sources:
        try:
            print("[SearXNG] Searching...")
            searcher = SearXNGSearcher()
            searx_results = await searcher.search(query, max_results=max_results)
            results.extend(searx_results)
            await searcher.close()
        except Exception as e:
            print(f"âš ï¸ SearXNG Error: {e}")

    # 2. GnÅsis (Stub)
    if "gnosis" in sources:
        print("[GnÅsis] (Not implemented in CLI yet)")

    # 3. Sophia (Stub)
    if "sophia" in sources:
        print("[Sophia] (Not implemented in CLI yet)")

    # Display results
    if not results:
        print("ğŸ“­ No results found.")
        return

    print(f"\nFound {len(results)} results:\n")
    for i, res in enumerate(results[:max_results], 1):
        print(f"{i}. [{res.source}] {res.title}")
        print(f"   {res.url}")
        print(f"   {res.snippet[:100]}...")
        print()


def main():
    parser = argparse.ArgumentParser(description="PeriskopÄ“ CLI")
    parser.add_argument("query", help="Search query")
    parser.add_argument("--sources", default="searxng", help="Comma-separated sources (searxng,gnosis,sophia)")
    parser.add_argument("--max", type=int, default=10, help="Max results per source")

    args = parser.parse_args()

    sources = [s.strip().lower() for s in args.sources.split(",")]

    asyncio.run(run_periskope(args.query, sources, args.max))


if __name__ == "__main__":
    main()
```

## é‡å¤§åº¦
Critical
