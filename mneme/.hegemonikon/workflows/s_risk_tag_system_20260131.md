# /s- リスクタグシステム設計

> **Date**: 2026-01-31
> **Mode**: /s- (最小計画)
> **Origin**: Recoverable Autonomy パターン (/noe+ 2026-01-31)

---

## STAGE 0: Scale Determination

```
📊 Scale 宣言: 🔭 Meso
   → 強制レベル: L2-std
   → 理由: 複数ワークフローに影響する設計
           新規概念の導入（リスクタグ）
```

### Blindspot Check

| カテゴリ | リスク | 理由 |
|:---------|:-------|:-----|
| Framing | 低 | Recoverable Autonomy からの直接派生 |
| Scope | 中 | 全操作にタグ付けは過剰の可能性 |
| Dependencies | 中 | 既存ワークフローとの整合性 |

---

## STAGE 1: Strategy Selection

```
⚖️ Explore/Exploit: Exploit (確実なパス)
📋 Plans: B (Robust) — 最小実装 + 拡張性

📅 Y-1 評価:
  Fast:    ✅ 即座に高リスク操作を識別可能
  Slow:    ✅ 6ヶ月でパターン蓄積、自動分類へ
  Eternal: ✅ FEP と整合的な設計

🌊 D-1 評価:
  T+0:     リスクタグ定義ファイル作成
  T+1:     /ene, /mek がタグを参照
  T+2:     Doxa がリスク判断を学習
```

---

## STAGE 2: Success Criteria

| 軸 | Must | Should | Could |
|:---|:-----|:-------|:------|
| 機能 | 3レベルのリスク分類 | タグ自動提案 | FEP 連携 |
| 品質 | 既存 WF との整合 | 使用例提示 | 学習機能 |
| 性能 | オーバーヘッド < 1秒 | — | — |

---

## STAGE 3: Blueprint

### リスクタグ体系

```yaml
# risk_tags.yaml
levels:
  low:    # 🟢 自律実行
    symbol: "🟢"
    approval: none
    rollback: optional
    logging: minimal
    
  medium: # 🟡 自律 + Doxa記録
    symbol: "🟡"
    approval: none
    rollback: recommended
    logging: full
    
  high:   # 🔴 事前承認必須
    symbol: "🔴"
    approval: required
    rollback: mandatory
    logging: full + audit

operations:
  # 低リスク操作
  low:
    - file_read
    - search
    - analysis
    - view_code
    - list_dir
    
  # 中リスク操作
  medium:
    - file_edit
    - file_create
    - git_commit
    - run_command_readonly
    
  # 高リスク操作
  high:
    - file_delete
    - git_push
    - external_api_call
    - deploy
    - database_write
    - send_email
```

### ワークフロー統合

```markdown
## /ene (O4 Energeia) への統合

[STEP 0.5] リスク評価
  ┌───────────────────────────────────────────────────┐
  │ 🏷️ リスクタグ評価                                │
  │                                                   │
  │ 操作: {operation}                                 │
  │ リスク: {🟢/🟡/🔴}                                 │
  │                                                   │
  │ 🟢 低 → 自律実行                                  │
  │ 🟡 中 → 実行 + Doxa 記録                          │
  │ 🔴 高 → 事前承認を要求                            │
  └───────────────────────────────────────────────────┘
```

### CCL 拡張

```text
# リスクタグ演算子（提案）
/ene!  → 🔴 高リスク操作であることを明示
/ene   → 🟡 中リスク（デフォルト）
/ene?  → 🟢 低リスク操作であることを明示
```

---

## STAGE 4: Devil's Advocate

| 視点 | 質問 | 回答 |
|:-----|:-----|:-----|
| Feasibility | 全操作のタグ付けは現実的？ | 主要操作のみ初期対象、拡張可能 |
| Necessity | Epochē (/epo) で十分では？ | /epo は判断停止、リスクタグは事前分類 |
| Alternatives | LLM にリスク判断させる？ | 構造的強制の方が確実 |
| Risks | 誤分類のリスク？ | Doxa で学習、人間がオーバーライド可能 |

---

## STAGE 5: SE振り返り

```
🔄 KPT
  Keep:    Recoverable Autonomy からの一貫した派生
  Problem: CCL 演算子の優先度が不明確
  Try:     3レベルで開始、運用後に調整

⏱️ 時間検証
  所要時間: 5分 / 45分 (11%)
```

---

## 実装計画

| Phase | 内容 | 成果物 |
|:------|:-----|:-------|
| P1 | risk_tags.yaml 作成 | 定義ファイル |
| P2 | /ene に STEP 0.5 追加 | ワークフロー更新 |
| P3 | Doxa 連携 | リスク判断学習 |

---

*Generated by /s- v5.6 — 2026-01-31*
