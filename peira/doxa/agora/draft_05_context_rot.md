# AI との長い会話が壊れる理由 — Context Rot とその対策

> **想定媒体**: Zenn / Note（実用的な技術 tips）
> **想定読者**: Claude/GPT のヘビーユーザー
> **フック**: 「なんで AI は途中から変なことを言い始めるのか」

---

## リード文（案）

Claude や GPT と長い会話をしていると、こんなことが起きないだろうか。

- さっき決めたことを忘れる
- 同じファイルを何度も読み直す
- 命名規則が途中から崩壊する
- 応答が遅くなる

これは **Context Rot（コンテキスト腐敗）** と呼ばれる現象だ。
コンテキストウィンドウの有限性に起因する、避けられない劣化。

本記事では、2ヶ月の実運用で確立した Context Rot 対策を紹介する。

---

## 本文構成（案）

### 1. Context Rot とは

- LLM のコンテキストは**有限の燃料**
- 100K トークンでも、30K トークンでも、いつか尽きる
- 「まだ大丈夫」と思った時には手遅れ — 潜在的に品質が低下している

### 2. 兆候ベース検知

| 兆候 | 意味 | 危険度 |
|:-----|:-----|:-------|
| 同じファイルを2回以上読む | 前回の内容がコンテキスト外 | 🟡 |
| 命名や構造の一貫性崩壊 | 初回の設計判断がコンテキスト外 | 🔴 |
| 「さっき言った」ことを忘れる | トークン上限に接近 | 🔴 |

### 3. 実運用で確立したルール

**N chat messages 閾値**（実際のセッションログから算出）:

| N | 状態 | アクション |
|:--|:-----|:----------|
| ≤30 | 🟢 | 通常運用 |
| 31-40 | 🟡 | 中間セーブ（現状の要約を作成） |
| 41-50 | 🟠 | 新規タスク受付停止 |
| >50 | 🔴 | セッション終了、引き継ぎ文書作成 |

**事例**: N=171 まで膨張したセッションで、AI が自作ファイルの名前を忘れた

### 4. 対策1: Handoff（引き継ぎパターン）

- セッション終了時に「引き継ぎ文書」を生成
- 次のセッション開始時に読み込む
- **コンテキストのリセット + 知識の継承**

```markdown
# Handoff: プロジェクト名

## 達成事項
- ...

## 未完了タスク
- ...

## 技術的判断（なぜそうしたか）
- ...
```

### 5. 対策2: 設計判断の外部化

- 重要な判断は**ファイルに書く**（会話に留めない）
- task.md: チェックリスト
- implementation_plan.md: 設計計画
- → コンテキストから消えても、ファイルを再読すれば復元できる

### 6. 対策3: Savepoint（中間セーブ）

🟡 に達したら自動で現状をセーブ:

```
📍 Savepoint @ N=35
- 現在の作業: Digestor パイプライン改修
- 完了: フィルタ条件修正、テスト通過
- 残り: API 表示修正
- 重要な判断: top_k=15 に拡大した理由 → (...)
```

### 7. 読者が今日から試せること

1. **長い会話を避ける** — 30 メッセージで区切る
2. **要約を定期的に作る** — 「今までの会話を要約して」と言う
3. **設計判断はファイルに書く** — 会話に頼らない

---

## まとめ

コンテキストは有限の燃料。残量を知らない飛行は墜落する。

「AI がおかしくなった」のは AI のせいではなく、
コンテキスト管理をしなかった人間の責任。

---

*ステータス: たたき台 / 未完成*
