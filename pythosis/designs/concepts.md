# Python Concepts Import: 概念拡張設計書

> **Date**: 2026-01-31 | **CCL**: `/s+*^/noe+`
> **Phase**: B (概念拡張)

---

## B1: 定理継承 (Theorem Inheritance)

### 設計

Python の継承を定理に適用し、公理からの導出チェーンを明示化。

```yaml
# 現在の定理定義
theorem: O1 Noēsis
description: 深い認識

# 拡張案: extends フィールド追加
theorem: O1 Noēsis
extends: FEP.Flow.Inference  # L0 → L1(I) → O1
axiom_path: [L0, L1.Flow, L1.I, O1]
description: 深い認識
```

### 実装場所

- `kernel/series/ousia.md` 等の定理定義ファイル
- WF frontmatter に `theorem_extends` フィールド

### 効果

| Before | After |
|:-------|:------|
| 定理はフラットに列挙 | 公理からの演繹パスが明確 |
| 根拠が暗黙 | `@proof` マクロで検証可能 |

---

## B2: Mixin 定理 (Composition over Inheritance)

### 設計

複数の機能を合成する「Mixin 定理」を定義。

```yaml
# Mixin 定義
mixin: Tracing
capability: 実行過程を記録
outputs: [trace_log]

mixin: Caching
capability: 結果をキャッシュ
parameters: [ttl]

# 定理への適用
theorem: O1 Noēsis
with: [Tracing]  # Mixin 適用
```

### 候補 Mixin

| Mixin | 機能 | 適用例 |
|:------|:-----|:-------|
| `Tracing` | 過程記録 | `/noe+` の CoT |
| `Caching` | 結果保存 | `/sop+` の API 結果 |
| `Validation` | 事後検証 | 全 WF に `/dia-` 自動付与 |
| `Timeout` | 時間制限 | 長時間 WF の制御 |

### CCL 構文案

```ccl
# Mixin 適用
/noe+ with:Tracing
/sop+ with:Caching(ttl=1h)

# 短縮形
/noe+:trace
/sop+:cache
```

---

## B3: デコレータマクロ (Decorator Macros)

### 設計

Python の `@decorator` パターンをマクロに適用。

```python
# Python デコレータ
@functools.cache
def expensive_function():
    pass

# CCL デコレータマクロ
@memoize(ttl=1h)
/sop+
```

### 新規マクロ提案

| マクロ | Python 対応 | 機能 |
|:-------|:------------|:-----|
| `@memoize` | `@functools.cache` | 結果キャッシュ |
| `@scoped` | `@contextmanager` | スコープ限定実行 |
| `@retry` | `@retry_on_exception` | 失敗時リトライ |
| `@log` | `@logging.decorator` | 実行ログ |
| `@validate` | `@validator` | 事前/事後検証 |
| `@async` | `@asyncio.coroutine` | 非同期実行 |

### 実装

```yaml
# ccl/macros/memoize.md
macro: @memoize
parameters:
  ttl: duration (default: session)
definition: |
  結果を ttl 期間キャッシュする
  同一入力に対して再計算を省略
ccl_expansion: |
  /dox{persist=true, ttl=$ttl} _ $target
```

---

## B4: KI 依存関係 (Dependencies)

### 設計

KI の `metadata.json` に依存関係を明示。

```json
{
  "name": "cognitive_algebra_system",
  "summary": "CCL 仕様",
  "dependencies": [
    "hegemonikon_system",
    "active_inference_implementation"
  ],
  "public_artifacts": [
    "overview.md",
    "operators_and_layers.md"
  ],
  "internal_artifacts": [
    "draft_ideas.md"
  ]
}
```

### 効果

- KI 間の依存グラフ可視化
- 影響範囲分析 (`@proof` 対象)
- `import` 的な知識参照

---

## B5: エラーハンドリング構文

### 設計

CCL に `try/except` 相当を導入。

```ccl
# 提案構文 1: パイプ記法
/noe+ | fallback=/dia^

# 提案構文 2: try ブロック
try: /noe+
except LowConfidence: /dia^
finally: /bye-

# 提案構文 3: 条件付き継続
/noe+ ?h2>0.7 _/ene
#       ↑ 確信度が 0.7 以上なら実行継続
```

### エラー型 (Error Types)

| エラー | 条件 | リカバリ |
|:-------|:-----|:---------|
| `LowConfidence` | `?h2 < 0.5` | メタ分析 (`^`) |
| `Timeout` | 時間超過 | 縮約 (`-`) |
| `Ambiguity` | 複数解釈 | 照会 (`/u`) |
| `Contradiction` | 矛盾検出 | 反転 (`\`) |

### 実装優先度

⚠️ **長期検討**: 現状の CCL はシンプルさを優先。エラーハンドリングは複雑化リスクあり。

---

## サマリー

| タスク | 状態 | 優先度 | 備考 |
|:-------|:----:|:------:|:-----|
| B1: 定理継承 | 設計完了 | ★★★ | kernel/*.md への適用が必要 |
| B2: Mixin | 設計完了 | ★★☆ | CCL 構文拡張要検討 |
| B3: デコレータマクロ | 設計完了 | ★★☆ | macros/ に追加可能 |
| B4: KI 依存 | 設計完了 | ★☆☆ | metadata.json 拡張 |
| B5: エラー構文 | 検討のみ | ★☆☆ | 長期課題として保留 |

---

## 次のステップ

```ccl
# 実装に進む場合
I: B1 実装 → kernel/series/*.md に extends 追加
I: B3 実装 → ccl/macros/ に新規マクロ追加
```

---

*Generated by `/s+*^/noe+` | Python Concepts Import*
